var SECOND_DELAY=0;var PROFIT_INDEX=6;var PAGES=40;var UPDATING_TIMEOUT=25000;var UPDATING_CHECK=[];var length;var stations=[];var created=false;var dt;var station_buy,stations;function getData(e,d,b,g){var a=[];var f;if(typeof(e)=="string"){f=[e]}else{if(e!=null){f=getPrice(e,d,b,g)}}if(f){for(var c=0;c<f.length;c++){if(f[c][0]>0){a.push(f[c])}}}return a}var buy_orders,sell_orders,increment,total_progress;function beginRoute(c,d){station_buy=c;buy_orders={};buy_orders.complete=false;buy_orders.region=station_buy[0];buy_orders.station=station_buy[1];buy_orders.complete_pages=0;increment=100/(d.length+1)/PAGES;total_progress=0;for(var a=1;a<=PAGES;a++){getOrders(a,station_buy[0],station_buy[1],buy_orders)}stations=d;sell_orders=[];for(var b=0;b<d.length;b++){sell_orders[b]={};sell_orders[b]["complete"]=false;var f=d[b][0];var e=d[b][1];sell_orders[b]["region"]=f;sell_orders[b]["station"]=e;sell_orders[b]["complete_pages"]=0;for(var a=1;a<=PAGES;a++){getOrders(a,f,e,sell_orders[b])}}$("#selection").hide()}var itemids=[];var executingGet=false;function next(b){var a=[];a=getData(buy_orders[b],buy_orders.station,"sell",b);if(a.length>0){executeRowCompute(b,a)}else{if(itemids.length==0&&!executingGet&&!created){$(".loading").text("No trades found for your filters.")}}}function getOrders(c,d,b,e){d=parseInt(d);b=parseInt(b);var a="https://esi.tech.ccp.is/latest/markets/"+d+"/orders/?datasource=tranquility&page="+c;$.ajax({type:"get",url:a,dataType:"json",contentType:"application/json",success:function(h){e.complete_pages+=1;total_progress+=increment;$(".loading").html("<b>Getting orders: "+total_progress.toFixed(2)+"% complete</b>");if(e.complete_pages==PAGES){var j=true;for(var f=0;f<sell_orders.length;f++){if(sell_orders[f]["complete_pages"]!==PAGES){j=false}else{sell_orders[f]["complete"]=true}}if(buy_orders.complete_pages===PAGES){buy_orders.complete=true}if(buy_orders.complete===true&&j){total_progress=100;$(".loading").text("Getting orders: "+total_progress.toFixed(2)+"% complete");for(g in buy_orders){itemids.push(g)}while(itemids.length!=0){var g=itemids.splice(0,1)[0];next(g)}return}}else{for(var f=0;f<h.length;f++){if(h[f]["location_id"]===b){var k=h[f]["type_id"];if(!e[k]){e[k]=[]}e[k].push(h[f])}}}},error:function(){getOrders(c,d,b,e)}})}function executeRowCompute(d,a){if(d!=="complete"||d!=="station"||d!=="region"||d!="complete_pages"){for(var b=0;b<sell_orders.length;b++){if(sell_orders[b][d]!==undefined){var c=getData(sell_orders[b][d],sell_orders[b]["station"],"buy",d);if(c.length>0){var e=[sell_orders[b]["region"],sell_orders[b]["station"]];getItemInfo(d,a,c,e)}}}}}function getItemInfo(h,a,f,d){var e=[];for(var c=0;c<a.length;c++){for(var b=0;b<f.length;b++){var g=calculateRow(h,a[c][0],a[c][1],f[b][0],f[b][1],d);if(g.length>0){e.push(g)}}}if(e.length>0){e=e.sort(rowComparator);getItemWeight(h,e)}}var itemWeightCache={};function getItemWeight(e,c){if(itemWeightCache[e]){var a=itemWeightCache[e][0];var b=itemWeightCache[e][1];var d=c[0];addRow(d[0],a,d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],b)}else{executingGet=true;$.ajax({type:"get",url:"https://esi.tech.ccp.is/latest/universe/types/"+e+"/?datasource=tranquility&language=en-us",dataType:"json",async:true,contentType:"application/json",success:function(i){executingGet=false;var f=i.name;var g=i.volume;itemWeightCache[e]=[];itemWeightCache[e][0]=f;itemWeightCache[e][1]=g;var h=c[0];addRow(h[0],f,h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8],h[9],g)},error:function(g,f){console.log(f)}})}}function rowComparator(d,c){if(d[PROFIT_INDEX]<c[PROFIT_INDEX]){return 1}if(d[PROFIT_INDEX]>c[PROFIT_INDEX]){return -1}return 0}function calculateRow(g,h,d,m,f,j){if(h<m&&m>0){var e=m-h;var a;var b;var c;var l;if(d>=f){c=numberWithCommas(d.toFixed())+"-<span class='selected_volume'>"+numberWithCommas(f.toFixed())+"</span>";a=f*e;b=h*f}else{c="<span class='selected_volume'>"+numberWithCommas(d.toFixed())+"</span>-"+numberWithCommas(f.toFixed());a=d*e;b=h*d}var i=getLocation(j[1]);var k=(m-h)/h;if(a>=threshold_profit&&(k.toFixed(3)*100).toFixed(1)>=threshold_roi&&b<=threshold_cost){return[g,h,c,b,i,a,k,m,e,j,l]}else{return[]}}return[]}function getLocation(a){if(isCustom){return getCustomEnd(a)}else{return(a===JITA[1]?"Jita":a===AMARR[1]?"Amarr":a===DODIXIE[1]?"Dodixie":a===RENS[1]?"Rens":a===HEK[1]?"Hek":getCustomEnd(a))}}function getCustomEnd(a){for(var b=0;b<stations.length;b++){if(a===stations[b][1]){return customEnd[b]}}return"nil"}function checkRow(a){var b=UPDATING_CHECK[UPDATING_CHECK.length-1];if($("#"+b).hasClass("updating")){$("#"+b).remove()}}function addRow(o,t,d,v,e,c,h,r,x,i,n,w){var f=c+"";while(c.indexOf("(")!=-1){c=c.replace("(","")}while(c.indexOf(")")!=-1){c=c.replace(")","")}var p=o+"_"+c+"_"+n[1];if(w){var s=v.split("-")[0];var q=v.split("-")[1];var b;if(s.indexOf("span")>=0){b=s}else{b=q}var m=b.substring(b.indexOf(">")+1,b.indexOf("</"));var k=m.replace(",","");while(k.indexOf(",")>=0){k=k.replace(",","")}var u=w*parseFloat(k);if(u<=threshold_weight){w=u}else{return}}else{w=0}if(!created){created=true;dt=$("#dataTable").DataTable({order:[[PROFIT_INDEX,"desc"]],lengthMenu:[[-1],["All"]],responsive:true,dom:"Bfrtip",buttons:["copy","csv","excel","pdf","print"]});var a=0;$("#dataTable thead th").each(function(A){var z=dt.column(A).header();var C=document.createElement("button");C.innerHTML=z.innerHTML;$(C).addClass("colvistoggle");$(C).addClass("btn");$(C).addClass("btn-default");$(C).attr("colidx",A);$(C).addClass("is-true");var B=dt.column($(C).attr("colidx"));B.visible(true);$(C).on("click",function(E){E.preventDefault();var D=dt.column($(this).attr("colidx"));$(this).removeClass("is-"+D.visible());D.visible(!D.visible());$(this).addClass("is-"+D.visible())});var y=document.createElement("li");$(y).append($(C));$("#colvis").append($(y))});$("#show-hide").show();$(".dropdown").on("show.bs.dropdown",function(y){$(this).find(".dropdown-menu").first().stop(true,true).slideDown()});$(".dropdown").on("hide.bs.dropdown",function(y){$(this).find(".dropdown-menu").first().stop(true,true).slideUp()});$("#dataTable tbody").on("mousedown","tr",function(z){if(z.which===1){if(z.ctrlKey){var y=$(this).attr("id").split("_")[0]+"_"+$(this).attr("id").split("_")[1]+"_"+$(this).attr("id").split("_")[2];if(!$(this).hasClass("row-selected")){$.each($("."+y),function(){$(this).addClass("row-selected")})}else{$.each($("."+y),function(){$(this).removeClass("row-selected")})}}else{if(z.shiftKey){open_popup($(this).attr("id").split("_")[0],$(this).children()[0].textContent,$(this).attr("id").split("_")[1],parseInt($(this).attr("id").split("_")[2]))}else{if(!$(this).hasClass("row-selected")){$(this).addClass("row-selected")}else{$(this).removeClass("row-selected")}}}}else{if(z.which===3){}}});$("label > input").addClass("form-control").addClass("minor-text");$("label > input").attr("placeholder","Search Results...");$(".loading").hide();$("#dataTable").show();$(".data_options").append($("#dataTable_filter"));$(".data_options").append($(".dt-buttons"));$(".dt-button").addClass("btn");$(".dt-button").addClass("btn-default")}var l=[t,numberWithCommas(d.toFixed(2)),numberWithCommas(e.toFixed(2)),v.split("-")[0],f,v.split("-")[1],numberWithCommas(h.toFixed(2)),(r.toFixed(3)*100).toFixed(1)+"%",numberWithCommas(x.toFixed(2)),numberWithCommas(i.toFixed(2)),numberWithCommas(w.toFixed(2))];var j=$("#dataTable").dataTable().fnAddData(l);var g=$("#dataTable").dataTable().fnGetNodes(j);$(g).attr("id",p+"_"+$("."+p).length);$(g).addClass(p)}function buyComparator(d,c){if(d[0]<c[0]){return -1}if(d[0]>c[0]){return 1}return 0}function sellComparator(d,c){if(d[0]<c[0]){return 1}if(d[0]>c[0]){return -1}return 0}function getPrice(e,d,j,i){var h=[];var k=[];for(var b=0;b<e.length;b++){var c=e[b];var a=false;if(c.is_buy_order===true&&j==="buy"){a=true}else{if(c.is_buy_order===false&&j==="sell"){a=true}}if(d==c.location_id&&c.min_volume===1&&a){var g=c.price;var f=c.volume_remain;h.push([g,f])}}if(j=="sell"){saveBuyData(d,i,$.extend(true,[],h));h=h.sort(buyComparator)}else{saveSellData(d,i,$.extend(true,[],h));h=h.sort(sellComparator)}return h}function saveBuyData(b,c,a){if(customBuy[b]){customBuy[b][c]=a}else{customBuy[b]=[];customBuy[b][c]=a}}function saveSellData(b,c,a){if(customSell[b]){customSell[b][c]=a}else{customSell[b]=[];customSell[b][c]=a}};