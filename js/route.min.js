var thiz;var BUY_ORDER="buy";var SELL_ORDER="sell";function Route(b,a){this.startLocation=b;this.endLocations=a;this.buyOrders={};this.buyOrders.completedPages=0;this.sellOrders={};this.totalProgress=0;this.pages=20;this.itemIds=[];thiz=this}Route.prototype.startRoute=function(){var c;var d=parseInt(this.startLocation.region);var b=parseInt(this.startLocation.station);for(c=1;c<=this.pages;c++){this.getBuyOrders(d,b,c,this.buyOrders)}for(var a=0;a<this.endLocations.length;a++){this.sellOrders[a]={};this.sellOrders[a].completedPages=0;d=parseInt(this.endLocations[a].region);b=parseInt(this.endLocations[a].station);for(c=1;c<=this.pages;c++){this.getSellOrders(d,b,c,this.sellOrders[a])}}$("#selection").hide()};Route.prototype.marketEndpointBuilder=function(d,c,a){var b="https://esi.tech.ccp.is/latest/markets/"+d+"/orders/?datasource=tranquility&page="+c+"&order_type="+a+"&language=en-us";return b.replace(/\s/g,"")};Route.prototype.incrementProgress=function(a){this.totalProgress+=(100/(this.endLocations.length+1)/this.pages);this.totalProgress=this.totalProgress>100?100:this.totalProgress;$(".loading").html("<b>Getting orders: "+this.totalProgress.toFixed(2)+"% complete</b>");a.completedPages+=1};Route.prototype.getBuyOrders=function(c,a,b,d){this.getOrders(c,a,b,d,BUY_ORDER)};Route.prototype.getSellOrders=function(c,a,b,d){this.getOrders(c,a,b,d,SELL_ORDER)};Route.prototype.getOrders=function(e,c,d,f,a){var b=this.marketEndpointBuilder(e,d,a);$.ajax({type:"get",url:b,dataType:"json",contentType:"application/json",async:true,cache:false,success:function(h){thiz.incrementProgress(f);if(f.completedPages==thiz.pages){thiz.executeOrders(f)}else{for(var g=0;g<h.length;g++){if(h[g]["location_id"]===c){var j=h[g]["type_id"];if(!f[j]){f[j]=[]}f[j].push(h[g])}}}},error:function(g,i,h){console.log(h);displayError();thiz.incrementProgress(f);if(f.completedPages==thiz.pages){executeOrders()}}})};Route.prototype.checkOrdersComplete=function(){var b=(this.buyOrders.completedPages===this.pages);for(var a=0;a<this.sellOrders.length;a++){b=b&&(this.sellOrders[a].completedPages===this.pages)}return b};Route.prototype.executeOrders=function(){if(this.checkOrdersComplete()){hideError();this.totalProgress=100;$(".loading").text("Getting orders: "+this.totalProgress.toFixed(2)+"% complete");for(itemid in this.buyOrders){this.itemIds.push(itemid)}console.log("finished")}};