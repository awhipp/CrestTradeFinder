function Route(b,a){this.startLocation=b;this.endLocations=a;this.buyOrders={};this.buyOrders.completePages=[];this.buyOrders.complete=false;this.buyOrders.pageBookend=PAGE_MULTIPLE;this.sellOrders={};this.itemCache={};this.iteration=1;this.totalProgress=0;this.itemIds=[];this.executingCount=0;this.secondsToRefresh=60;this.tableCreated=false;this.asyncChecker=null;this.asyncCalculator=null}Route.prototype.className=function(){return"Route"};Route.prototype.startRoute=function(){thiz=this;var c;var d=parseInt(this.startLocation.region);var b=parseInt(this.startLocation.station);for(c=1;c<=PAGE_MULTIPLE;c++){this.getSellOrders(d,b,c,this.buyOrders)}for(var a=0;a<this.endLocations.length;a++){this.sellOrders[a]={};this.sellOrders[a].completePages=[];this.sellOrders[a].complete=false;this.sellOrders[a].pageBookend=PAGE_MULTIPLE;d=parseInt(this.endLocations[a].region);b=parseInt(this.endLocations[a].station);for(c=1;c<=PAGE_MULTIPLE;c++){this.getBuyOrders(d,b,c,this.sellOrders[a])}}$("#selection").hide();this.asyncCheck()};Route.prototype.asyncCheck=function(){this.asyncChecker=setInterval(function(){thiz.executeOrders()},1000)};Route.prototype.marketEndpointBuilder=function(d,c,a){var b=ESI_ENDPOINT+"/latest/markets/"+d+"/orders/?datasource=tranquility&page="+c+"&order_type="+a+"&language=en-us&iteration="+iteration;return b.replace(/\s/g,"")};Route.prototype.recalculateProgress=function(){var a=this.getNumberOfCompletePages(this.buyOrders);for(var b=0;b<this.endLocations.length;b++){a+=this.getNumberOfCompletePages(this.sellOrders[b])}return a===0?1:a};Route.prototype.incrementProgress=function(b,a){if(this.totalProgress!==100){this.totalProgress=35*Math.log10(this.recalculateProgress());this.totalProgress=this.totalProgress>100?100:this.totalProgress;$(".loading").html("<b>Getting orders: "+this.totalProgress.toFixed(2)+"% complete</b>")}b.completePages[a]=true};Route.prototype.getBuyOrders=function(c,a,b,d){this.getOrders(c,a,b,d,BUY_ORDER)};Route.prototype.getSellOrders=function(c,a,b,d){this.getOrders(c,a,b,d,SELL_ORDER)};Route.prototype.getOrders=function(e,c,d,f,a){var b=this.marketEndpointBuilder(e,d,a);if(!f.completePages[d]){$.ajax({type:"get",url:b,dataType:"json",contentType:"application/json",async:true,success:function(k){thiz.incrementProgress(f,d);if(k.length===0&&!f.complete){f.complete=true;console.log("Completed "+c+" order fetch at "+d)}else{for(var h=0;h<k.length;h++){if(k[h]["location_id"]===c){var l=k[h]["type_id"];if(!f[l]){f[l]=[]}f[l].push(k[h])}}if(!f.complete&&thiz.getNumberOfCompletePages(f)===f.pageBookend){var j=d+1;f.pageBookend=(f.pageBookend+PAGE_MULTIPLE);for(var g=f.pageBookend;j<=g;j++){thiz.getOrders(e,c,j,f,a)}}}},error:function(g,i,h){displayError();thiz.incrementProgress(f,d)}})}};Route.prototype.getNumberOfCompletePages=function(a){var c=0;for(var b=0;b<a.completePages.length;b++){if(a.completePages[b]){c++}}return c};Route.prototype.checkOrdersComplete=function(){var a=(this.getNumberOfCompletePages(this.buyOrders)===this.buyOrders.pageBookend);var c=this.buyOrders.complete;for(var b=0;b<this.endLocations.length;b++){a=a&&(this.getNumberOfCompletePages(this.sellOrders[b])===this.sellOrders[b].pageBookend);c=c&&this.sellOrders[b].complete}return(a&&c)};Route.prototype.executeOrders=function(){if(this.checkOrdersComplete()){clearInterval(this.asyncChecker);hideError();for(itemId in this.buyOrders){if(itemId!=="completePages"&&itemId!=="complete"&&itemId!=="pageBookend"){this.itemIds.push(itemId)}}this.totalProgress=100;$(".loading").text("Getting orders: "+this.totalProgress.toFixed(2)+"% complete");console.log("finished");this.asyncCalculate()}};Route.prototype.refresh=function(){$("#noselect-object").html('<table id="dataTable" class="display"></table>');$(".dataTables_filter").remove();$(".dt-buttons").remove();$("#refresh-button").remove();init()};Route.prototype.asyncRefresh=function(){this.asyncRefresher=setInterval(function(){if(thiz.secondsToRefresh<=0){clearInterval(thiz.asyncRefresher);$("#refresh-timer").remove();$("#buyingFooter").append('<div id="refresh-button"><br><input type="button" class="btn btn-default" onclick="thiz.refresh()" value="Refresh Table with Last Query"/></div>')}else{$("#refresh-timer").html("<br><p>Refresh allowed in: "+thiz.secondsToRefresh+" seconds.");thiz.secondsToRefresh--}},1000)};Route.prototype.asyncCalculate=function(){this.asyncCalculator=setInterval(function(){while(thiz.itemIds.length!=0&&thiz.executingCount<1500){thiz.executingCount++;var a=thiz.itemIds.splice(0,1)[0];thiz.calculateNext(a)}if(thiz.itemIds.length==0&&thiz.executingCount<=0){clearInterval(thiz.asyncCalculator);$(".loading").text("No trades found for your filters.");$("#buyingFooter").append('<div id="refresh-timer"></div>');thiz.asyncRefresh();thiz.iteration++}},1000)};Route.prototype.calculateNext=function(h){var a=getMarketData(this.buyOrders[h],this.startLocation.station,SELL_ORDER,h);if(a.length>0){var d=false;for(var c=0;c<this.endLocations.length;c++){var b=this.sellOrders[c];var g=this.endLocations[c];if(b[h]){var e=getData(b[h],g.station,BUY_ORDER,h);if(e.length>0){var f={};f.region=g.region;f.station=g.station;d=true;this.getItemInfo(h,a,e,f)}}}if(!d){executingCount--}}else{this.executingCount--}};Route.prototype.getItemInfo=function(h,a,e,g){var d=[];for(var c=0;c<a.length;c++){for(var b=0;b<e.length;b++){var f=this.calculateRow(h,a[c][0],a[c][1],e[b][0],e[b][1],g);if(f.length>0){d.push(f)}}}if(d.length>0){d=d.sort(bestRowComparator);this.getItemWeight(h,this.createRowObject(d[0]))}else{executingCount--}};Route.prototype.calculateRow=function(j,d,g,h,i,c){if(d<h&&h>0){var f=h-d;var a;var b;var e;if(g>=i){e=i;a=i*f;b=d*i}else{e=g;a=g*f;b=d*g}var k=(h-d)/d;if(a>=threshold_profit&&(k.toFixed(3)*100).toFixed(1)>=threshold_roi&&b<=threshold_cost){return[j,d,e,b,c,a,k,h,f]}else{return[]}}return[]};Route.prototype.getItemWeight=function(d,c){if(this.itemCache[d]){var a=this.itemCache[d].name;var b=this.itemCache[d].weight;c.itemName=a;c.itemWeight=b;this.addRow(c);executingCount--}else{$.ajax({type:"get",url:"https://esi.tech.ccp.is/latest/universe/types/"+d+"/?datasource=tranquility&language=en-us&iteration="+iteration,dataType:"json",async:true,cache:false,contentType:"application/json",success:function(g){executingCount--;var e=g.name;var f=g.packaged_volume;thiz.itemCache[d]={};thiz.itemCache[d].name=e;thiz.itemCache[d].weight=f;c.itemName=e;c.itemWeight=f;thiz.addRow(c)},error:function(f,e){if(f.status!=404&&f.statusText!=="parsererror"){thiz.getItemWeight(d,c)}else{executingCount--}}})}};Route.prototype.createRowObject=function(b){var a={};a.itemId=b[0];a.buyPrice=b[1];a.quantity=b[2];a.buyCost=b[3];a.sellToStation=b[4];a.totalProfit=b[5];a.roi=b[6];a.sellPrice=b[7];a.perItemProfit=b[8];return a};Route.prototype.addRow=function(e){var d=e.itemWeight*e.quantity;if(d>threshold_weight){return}var c=itemId+"_"+e.sellToStation.station;if(!this.tableCreated){this.createTable()}var b=[e.itemName,numberWithCommas(e.quantity),numberWithCommas(e.buyPrice.toFixed(2)),numberWithCommas(e.buyCost.toFixed(2)),getStationName(e.sellToStation.station),numberWithCommas(e.sellPrice.toFixed(2)),numberWithCommas(e.totalProfit.toFixed(2)),numberWithCommas(e.perItemProfit.toFixed(2)),(e.roi.toFixed(3)*100).toFixed(1)+"%",numberWithCommas(d.toFixed(2))];var f=$("#dataTable").dataTable().fnAddData(b);var a=$("#dataTable").dataTable().fnGetNodes(f);$(a).attr("id",c+"_"+$("."+c).length);$(a).addClass(c)};Route.prototype.createTable=function(){this.tableCreated=true;dt=$("#dataTable").DataTable({order:[[6,"desc"]],lengthMenu:[[-1],["All"]],responsive:true,dom:"Bfrtip",buttons:["copy","csv","excel","pdf","print"]});var a=0;$("#dataTable thead th").each(function(d){var c=dt.column(d).header();var f=document.createElement("button");f.innerHTML=c.innerHTML;$(f).addClass("colvistoggle");$(f).addClass("btn");$(f).addClass("btn-default");$(f).attr("colidx",d);$(f).addClass("is-true");var e=dt.column($(f).attr("colidx"));e.visible(true);$(f).on("click",function(h){h.preventDefault();var g=dt.column($(this).attr("colidx"));$(this).removeClass("is-"+g.visible());g.visible(!g.visible());$(this).addClass("is-"+g.visible())});var b=document.createElement("li");$(b).append($(f));$("#colvis").append($(b))});$("#show-hide").show();$(".dropdown").on("show.bs.dropdown",function(b){$(this).find(".dropdown-menu").first().stop(true,true).slideDown()});$(".dropdown").on("hide.bs.dropdown",function(b){$(this).find(".dropdown-menu").first().stop(true,true).slideUp()});$("#dataTable tbody").on("mousedown","tr",function(c){if(c.which===1){if(c.ctrlKey){var b=$(this).attr("id").split("_")[0]+"_"+$(this).attr("id").split("_")[1]+"_"+$(this).attr("id").split("_")[2];if(!$(this).hasClass("row-selected")){$.each($("."+b),function(){$(this).addClass("row-selected")})}else{$.each($("."+b),function(){$(this).removeClass("row-selected")})}}else{if(c.shiftKey){open_popup($(this).attr("id").split("_")[0],$(this).children()[0].textContent,$(this).attr("id").split("_")[1],parseInt($(this).attr("id").split("_")[2]))}else{if(!$(this).hasClass("row-selected")){$(this).addClass("row-selected")}else{$(this).removeClass("row-selected")}}}}});$("label > input").addClass("form-control").addClass("minor-text");$("label > input").attr("placeholder","Search Results...");$(".loading").hide();$("#dataTable").show();$(".data_options").append($("#dataTable_filter"));$(".data_options").append($(".dt-buttons"));$(".dt-button").addClass("btn");$(".dt-button").addClass("btn-default");$("#core").css("display","block")};