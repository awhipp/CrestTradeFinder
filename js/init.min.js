var threshold_margin_lower=20;var threshold_margin_upper=40;var volume_threshold=1000;var threshold_profit=500000;var threshold_roi=4;var threshold_cost=1000000000000000000;var threshold_weight=1000000000000000000;var tradingStyle=null;var errorShown=false;var addedToStartList=[];var addedToEndList=[];var stationsReady=false;var regionsReady=false;var popup_table_buy;var popup_table_sell;var universeList={};var stationIdToName={};var startCoordinates=[];var endCoordinates=[];var startLocations=[];var endLocations=[];$(document).ready(function(){popup_table_buy=$("#popup-table-buy").DataTable({order:[[0,"asc"]],lengthMenu:[[10],["10"]]});popup_table_sell=$("#popup-table-sell").DataTable({order:[[0,"desc"]],lengthMenu:[[10],["10"]]});onClickListeners();$('input[type="number"]').keypress(function(c){var d=c||window.event;var a=d.keyCode||d.which;a=String.fromCharCode(a);var b=/[0-9]|\./;if(!b.test(a)&&d.charCode!==8&&d.charCode!==0){d.returnValue=false;if(d.preventDefault){d.preventDefault()}}});setAbout();setupCookies();setupCustomDropdown()});function getTradeHubName(a){if(a=="Jita IV - Moon 4 - Caldari Navy Assembly Plant"){return"Jita"}else{if(a=="Amarr VIII (Oris) - Emperor Family Academy"){return"Amarr"}else{if(a=="Rens VI - Moon 8 - Brutor Tribe Treasury"){return"Rens"}else{if(a=="Dodixie IX - Moon 20 - Federation Navy Assembly Plant"){return"Dodixie"}else{if(a=="Hek VIII - Moon 12 - Boundless Creation Factory"){return"Hek"}}}}}return a}function initCompletely(b,c){var a=completely(document.getElementById(b),{fontSize:"18px",fontFamily:"Roboto",color:"#333",ignoreCase:true});a.options=c;a.repaint();if(b=="start_station"){$($("#"+b+" input")[1]).on("keydown",function(d){if(d.keyCode==13){newStartStation()}})}if(b=="end_station"){$($("#"+b+" input")[1]).on("keydown",function(d){if(d.keyCode==13){newEndStation()}})}}function setupCustomDropdown(){var a=setInterval(function(){if(station_ids!==undefined){clearInterval(a);var g=[""];for(var e=0;e<station_ids.length;e++){var f=station_ids[e][2];var h=getTradeHubName(f);if(f!==h){var d=h.toLowerCase();universeList[d]={};universeList[d].region=station_ids[e][1];universeList[d].station=station_ids[e][0];universeList[d].name=h;g.push(h)}var d=f.toLowerCase();universeList[d]={};universeList[d].region=station_ids[e][1];universeList[d].station=station_ids[e][0];universeList[d].name=f;g.push(f);stationIdToName[station_ids[e][0]]=f}g.sort();initCompletely("custom_station",g);initCompletely("start_station",g);initCompletely("end_station",g);stationsReady=true}},1000);var b=setInterval(function(){if(region_ids!==undefined){clearInterval(b);var d=[""];for(var e=0;e<region_ids.length;e++){var g=region_ids[e][1];var f=g.toLowerCase();universeList[f]={};universeList[f].name=region_ids[e][1];universeList[f].id=region_ids[e][0];d.push(g)}d.sort();initCompletely("start_region",d);initCompletely("end_region",d);regionsReady=true}},1000);var c=setInterval(function(){if(stationsReady&&regionsReady){clearInterval(c);$(function(){var d=1;$("input").each(function(){if(this.type!="hidden"){var e=$(this);e.attr("tabindex",d);d++}})});$(".location-input").keyup(function(e){if(e.keyCode=="9"){var d=parseInt(e.target.id.charAt(e.target.id.length-1));if(d==1){$("#volume-threshold").focus()}else{if(d==2||d==4){$("#location-input-"+(d+1)).focus()}else{if(d==3){$("#profit-threshold").focus()}else{if(d==5){$("#region-profit-threshold").focus()}}}}}});$(".loadingIcon").remove();$("header").css("opacity",1)}},1000)}function newStartStation(){var c=document.createElement("li");var b=($("#start_station input")[0].value&&universeList[$("#start_station input")[0].value.toLowerCase()].name)||($("#start_station input")[1].value&&universeList[$("#start_station input")[1].value.toLowerCase()].name);var e=document.createTextNode(b);if(addedToStartList.indexOf(b)==-1){addedToStartList.push(b);c.appendChild(e);if(b===""){alert("You must choose a station!")}else{document.getElementById("custom_route_start").style.display="block";document.getElementById("custom_route_start").appendChild(c)}$("#start_station input")[0].value="";$("#start_station input")[1].value="";var f=document.createElement("SPAN");var a=document.createTextNode(" \u00D7");f.className="closeStation";f.title="Remove: "+b;f.appendChild(a);c.appendChild(f)}var g=document.getElementsByClassName("closeStation");var d;for(d=0;d<g.length;d++){g[d].onclick=function(){var h=$(this)[0].previousSibling.data;addedToStartList[addedToStartList.indexOf(h)]="";$(this.parentElement).remove()}}}function newEndStation(){var c=document.createElement("li");var b=($("#end_station input")[0].value&&universeList[$("#end_station input")[0].value.toLowerCase()].name)||($("#end_station input")[0].value&&universeList[$("#end_station input")[1].value.toLowerCase()].name);var e=document.createTextNode(b);if(addedToEndList.indexOf(b)==-1){addedToEndList.push(b);c.appendChild(e);if(b===""){alert("You must choose a station!")}else{document.getElementById("custom_route_end").style.display="block";document.getElementById("custom_route_end").appendChild(c)}$("#end_station input")[0].value="";$("#end_station input")[1].value="";var f=document.createElement("SPAN");var a=document.createTextNode(" \u00D7");f.className="closeStation";f.title="Remove: "+b;f.appendChild(a);c.appendChild(f)}var g=document.getElementsByClassName("closeStation");var d;for(d=0;d<g.length;d++){g[d].onclick=function(){var h=$(this)[0].previousSibling.data;addedToEndList[addedToEndList.indexOf(h)]="";$(this.parentElement).remove()}}}function onClickListeners(){$(".end").on("click",function(){$(this).hasClass("end-selected")?$(this).removeClass("end-selected"):$(this).addClass("end-selected")});$(".hauling-region-trader").on("click",function(){setupTradeOptions(2)});$(".hauling-station-trader").on("click",function(){setupTradeOptions(1)});$(".station-trader").on("click",function(){setupTradeOptions(0)});$(".station-start").on("click",function(){$(".station-start").removeClass("station-selected");$(this).addClass("station-selected")})}function setAbout(){if(tradingStyle==null){$("#about")[0].onclick=function(){$("#howto").modal("show")}}else{if(tradingStyle>=1){$("#about")[0].onclick=function(){$("#howto-route").modal("show")}}else{if(tradingStyle==0){$("#about")[0].onclick=function(){$("#howto-station").modal("show")}}else{if(tradingStyle==2){$("#about")[0].onclick=function(){$("#howto-route").modal("show")}}}}}}function setupCookies(){$("#lower-margin-threshold").val(getCookie("lower-margin-threshold"));$("#upper-margin-threshold").val(getCookie("upper-margin-threshold"));$("#volume-threshold").val(getCookie("volume-threshold"));$("#profit-threshold").val(getCookie("profit-threshold"));$("#roi-threshold").val(getCookie("roi-threshold"));$("#buy-threshold").val(getCookie("buy-threshold"));$("#weight-threshold").val(getCookie("weight-threshold"));$("#region-profit-threshold").val(getCookie("profit-threshold"));$("#region-roi-threshold").val(getCookie("roi-threshold"));$("#region-buy-threshold").val(getCookie("buy-threshold"));$("#region-weight-threshold").val(getCookie("weight-threshold"))}function updateCookies(){if(tradingStyle==1){if($("#profit-threshold").val().length>0&&!isNaN($("#profit-threshold").val())){threshold_profit=parseFloat($("#profit-threshold").val());setCookie("profit-threshold",threshold_profit,7)}else{setCookie("profit-threshold","")}if($("#roi-threshold").val().length>0&&!isNaN($("#roi-threshold").val())){threshold_roi=parseFloat($("#roi-threshold").val());setCookie("roi-threshold",threshold_roi,7)}else{setCookie("roi-threshold","")}if($("#buy-threshold").val().length>0&&!isNaN($("#buy-threshold").val())){threshold_cost=parseFloat($("#buy-threshold").val());setCookie("buy-threshold",threshold_cost,7)}else{setCookie("buy-threshold","")}if($("#weight-threshold").val().length>0&&!isNaN($("#weight-threshold").val())){threshold_weight=parseFloat($("#weight-threshold").val());setCookie("weight-threshold",threshold_weight,7)}else{setCookie("weight-threshold","")}}else{if(tradingStyle==0){if($("#lower-margin-threshold").val().length>0&&!isNaN($("#lower-margin-threshold").val())){threshold_margin_lower=parseFloat($("#lower-margin-threshold").val());setCookie("lower-margin-threshold",threshold_margin_lower,7)}else{setCookie("lower-margin-threshold","")}if($("#upper-margin-threshold").val().length>0&&!isNaN($("#upper-margin-threshold").val())){threshold_margin_upper=parseFloat($("#upper-margin-threshold").val());setCookie("upper-margin-threshold",threshold_margin_upper,7)}else{setCookie("upper-margin-threshold","")}if($("#volume-threshold").val().length>0&&!isNaN($("#volume-threshold").val())){volume_threshold=parseFloat($("#volume-threshold").val());setCookie("volume-threshold",volume_threshold,7)}else{setCookie("volume-threshold","")}}else{if(tradingStyle==2){if($("#region-profit-threshold").val().length>0&&!isNaN($("#region-profit-threshold").val())){threshold_profit=parseFloat($("#region-profit-threshold").val());setCookie("profit-threshold",threshold_profit,7)}else{setCookie("profit-threshold","")}if($("#region-roi-threshold").val().length>0&&!isNaN($("#region-roi-threshold").val())){threshold_roi=parseFloat($("#region-roi-threshold").val());setCookie("roi-threshold",threshold_roi,7)}else{setCookie("roi-threshold","")}if($("#region-buy-threshold").val().length>0&&!isNaN($("#region-buy-threshold").val())){threshold_cost=parseFloat($("#region-buy-threshold").val());setCookie("buy-threshold",threshold_cost,7)}else{setCookie("buy-threshold","")}if($("#region-weight-threshold").val().length>0&&!isNaN($("#region-weight-threshold").val())){threshold_weight=parseFloat($("#region-weight-threshold").val());setCookie("weight-threshold",threshold_weight,7)}else{setCookie("weight-threshold","")}}}}}function setupTradeOptions(a){tradingStyle=a;$(".howto").toggle(false);$("#initial_choice").hide();setAbout();if(tradingStyle==1){$("#route_trade").slideToggle();ga("send","event","Trade Style","Hauler - Station","User Preference Campaign")}else{if(tradingStyle==0){$("#station_trade").slideToggle();ga("send","event","Trade Style","Station Trader","User Preference Campaign")}else{if(tradingStyle==2){$("#region_trade").slideToggle();ga("send","event","Trade Style","Hauler - Region","User Preference Campaign")}}}}function open_popup(h,b,a,g){popup_table_buy.clear();popup_table_sell.clear();var f=getStationName(g)||g.name;var e=g.station||g;$("#popup_itemName").text("Trade info for "+b);$("#buyLocation").text("Buy at "+a.name);$("#sellLocation").text("Sell at "+f);var j=customBuy[a.station][h];var c=customSell[e][h];for(var d=0;d<j.length;d++){if(j[d]){$("#popup-table-buy").dataTable().fnAddData([numberWithCommas(j[d][0].toFixed(2)),numberWithCommas(j[d][1].toFixed())])}}for(var d=0;d<c.length;d++){if(c[d]){$("#popup-table-sell").dataTable().fnAddData([numberWithCommas(c[d][0].toFixed(2)),numberWithCommas(c[d][1].toFixed())])}}$("#popup").modal("show");popup_table_buy.draw();popup_table_sell.draw()}function setCookie(b,f,c){var e=new Date();e.setTime(e.getTime()+(c*24*60*60*1000));var a="expires="+e.toUTCString();document.cookie=b+"="+f+";"+a+";path=/"}function getCookie(d){var b=d+"=";var f=decodeURIComponent(document.cookie);var a=f.split(";");for(var e=0;e<a.length;e++){var g=a[e];while(g.charAt(0)==" "){g=g.substring(1)}if(g.indexOf(b)==0){return g.substring(b.length,g.length)}}return""}function setStationTradingLocations(){var a=$("#custom_station input")[0].value||$("#custom_station input")[1].value;startLocations=a.toLowerCase();var b=universeList[startLocations].region;var c=universeList[startLocations].station;startLocations=universeList[startLocations].name;startCoordinates.region=b;startCoordinates.station=c}function setRouteRegionTradingLocations(){var a=$("#start_region input")[0].value||$("#start_region input")[1].value;startLocations=a.toLowerCase();startCoordinates=universeList[startLocations];startLocations=startCoordinates.name;a=$("#end_region input")[0].value||$("#end_region input")[1].value;endLocations=a.toLowerCase();endCoordinates=universeList[endLocations];endLocations=endCoordinates.name}function getCoordinatesFor(d,c){var f=[];var b=[];var e;$.each($(d+" > li"),function(){var j={};var h=$(this).text();var i=h.substring(0,h.length-2).toLowerCase();e=universeList[i];j.region=e.region;j.station=e.station;j.name=e.name;if(b.indexOf(j.station)==-1){f.push(j);b.push(j.station)}});if($(c+" input")[0].value){var a=$(c+" input")[0].value||$(c+" input")[1].value;e=universeList[a.toLowerCase()];if(e){var g={};g.region=e.region;g.station=e.station;g.name=e.name;if(b.indexOf(g.station)==-1){f.push(g)}}}return f}function setRouteStationTradingLocations(){startCoordinates=getCoordinatesFor("#custom_route_start","#start_station");if(startCoordinates.length>0){startLocations=[];for(var a=0;a<startCoordinates.length;a++){startLocations.push(startCoordinates[a].name)}endCoordinates=getCoordinatesFor("#custom_route_end","#end_station");for(a=0;a<endCoordinates.length;a++){endLocations.push(endCoordinates[a].name)}}}function createDataTable(){var f;var d=$("#buyingHeader");var b=$("#buyingFooter");var g=$("#core");var h=$("#dataTable");if(tradingStyle==1||tradingStyle==2){h.append("<thead><tr><th></th><th>Buy Item</th><th>From</th><th>Quantity</th><th>At Sell Price</th><th>Total Cost</th><th>Take To</th><th>At Buy Price</th><th>Total Profit</th><th>Profit Per Item</th><th>R.O.I.</th><th>Total Volume (m3)</th></tr></thead><tbody id='tableBody'></tbody>");var a="";var j="";if(tradingStyle==1){$.each(startLocations,function(){a+=this+", "});a=a.substring(0,a.length-2);$.each(endLocations,function(){j+=this+", "});j=j.substring(0,j.length-2)}else{a=startLocations;j=endLocations}d.text("Buying Sell Orders from "+a);var e="<div id='route-to'>Selling to the Buy Orders at "+j+"</div> ROI&nbsp;Greater&nbsp;Than&nbsp;"+threshold_roi+"% |&nbsp;Profits&nbsp;Greater&nbsp;Than&nbsp;"+numberWithCommas(threshold_profit)+"&nbsp;ISK";if(threshold_cost!==1000000000000000000){e+=" |&nbsp;Buy&nbsp;Costs&nbsp;Less&nbsp;Than&nbsp;"+numberWithCommas(threshold_cost)+"&nbsp;ISK"}if(threshold_weight!==1000000000000000000){e+=" |&nbsp;Total&nbsp;Volume&nbsp;Under&nbsp;"+numberWithCommas(threshold_weight)+"&nbsp;m3"}d.show();f=e+"<br/><div class='loading'></div>";b.html(f);b.show();g.show();$(".deal_note").show();$("#core input").css("display","none");$("#core a").css("display","none");$("#show-hide").hide();var c=h.DataTable({order:[[8,"desc"]],lengthMenu:[[-1],["All"]],responsive:true,dom:"Bfrtip",buttons:["copy","csv","excel","pdf"],columnDefs:[{targets:0,orderable:false}]});var i=0;$("#dataTable thead th").each(function(n){var l=c.column(n).header();var p=document.createElement("button");var m=[];p.innerHTML=l.innerHTML;$(p).addClass("colvistoggle");$(p).addClass("btn");$(p).addClass("btn-default");$(p).attr("colidx",n);$(p).addClass("is-true");var o=c.column($(p).attr("colidx"));o.visible(true);for(var n=0;n<m.length;n++){if(p.innerHTML===m[n]){$(p).addClass("is-false");var o=c.column($(p).attr("colidx"));o.visible(false);break}}$(p).on("click",function(r){r.preventDefault();var q=c.column($(this).attr("colidx"));$(this).removeClass("is-"+q.visible());q.visible(!q.visible());$(this).addClass("is-"+q.visible())});var k=document.createElement("li");$(k).append($(p));$("#colvis").append($(k))});$(".dropdown").on("show.bs.dropdown",function(k){$(this).find(".dropdown-menu").first().stop(true,true).slideDown()});$(".dropdown").on("hide.bs.dropdown",function(k){$(this).find(".dropdown-menu").first().stop(true,true).slideUp()});$("#dataTable tbody").on("mousedown","tr",function(l){var k=(l.target.id.indexOf("investigate")>=0||(l.target.children[0]&&l.target.children[0].id.indexOf("investigate")>=0)||(l.target.classList.contains("fa")));if(l.which===1&&!k){if(!$(this).hasClass("row-selected")){$(this).addClass("row-selected")}else{$(this).removeClass("row-selected")}}});$("label > input").addClass("form-control").addClass("minor-text");$("label > input").attr("placeholder","Filter by Station/Name...")}else{if(tradingStyle==0){d.text("Station Trading at "+startLocations);d.show();f="Volume greater than: "+numberWithCommas(volume_threshold)+" | Margins between "+threshold_margin_lower+"% and "+threshold_margin_upper+"%<div class='loading'>Loading. Please wait...</div>";b.html(f);b.show();g.show();$(".deal_note").show();$("#show-hide").hide();h.append("<thead><tr><th>Item</th><th>Buy Order</th><th>Sell Order</th><th>Profit Per Item</th><th>Margin</th><th>Volume</th></tr></thead><tbody id='tableBody'></tbody>")}}}function execute(){if(tradingStyle==1){routes=[];for(var a=0;a<startCoordinates.length;a++){new Route(startCoordinates[a],endCoordinates).startRoute()}}else{if(tradingStyle==0){new Station(startCoordinates).startStation()}else{if(tradingStyle==2){new Region(startCoordinates,endCoordinates).startRoute()}}}}function init(){updateCookies();if(tradingStyle==1){setRouteStationTradingLocations()}else{if(tradingStyle==0){setStationTradingLocations()}else{setRouteRegionTradingLocations()}}var a=(startLocations&&startLocations.length>0);var b=(tradingStyle>=1&&endLocations.length>0)||tradingStyle==0;if(a&&b){$(".error").hide();$("#selection").hide()}else{$(".error").show();return}createDataTable();execute()}function displayError(){if(!errorShown){$("#connectEVE").slideToggle(true);errorShown=true}}function hideError(){if(errorShown){$("#connectEVE").slideToggle();errorShown=false}};