var threshold_margin_lower=20;var threshold_margin_upper=40;var volume_threshold=1000;var threshold_profit=100000;var threshold_roi=1;var threshold_cost=1000000000000000000;var threshold_weight=1000000000000000000;var routeTrading=null;var errorShown=false;var addedToList=[];var popup_table_buy;var popup_table_sell;var stations_checked=0;var MAX_STATIONS=25;var universeList={};var startCoordinates;var endCoordinates;var startLocation;var endLocations;$(document).ready(function(){$("#stations_remaining").text(MAX_STATIONS);popup_table_buy=$("#popup-table-buy").DataTable({order:[[0,"asc"]],lengthMenu:[[10],["10"]]});popup_table_sell=$("#popup-table-sell").DataTable({order:[[0,"desc"]],lengthMenu:[[10],["10"]]});onClickListeners();$('input[type="number"]').keypress(function(c){var d=c||window.event;var a=d.keyCode||d.which;a=String.fromCharCode(a);var b=/[0-9]|\./;if(!b.test(a)&&d.charCode!==8&&d.charCode!==0){d.returnValue=false;if(d.preventDefault){d.preventDefault()}}});setAbout();setupCookies();setupCustomDropdown()});function getTradeHubName(a){if(a=="Jita IV - Moon 4 - Caldari Navy Assembly Plant"){return"Jita"}else{if(a=="Amarr VIII (Oris) - Emperor Family Academy"){return"Amarr"}else{if(a=="Rens VI - Moon 8 - Brutor Tribe Treasury"){return"Rens"}else{if(a=="Dodixie IX - Moon 20 - Federation Navy Assembly Plant"){return"Dodixie"}else{if(a=="Hek VIII - Moon 12 - Boundless Creation Factory"){return"Hek"}}}}}return a}function initCompletely(b,c){var a=completely(document.getElementById(b),{fontSize:"18px",fontFamily:"Roboto",color:"#333",ignoreCase:true});a.options=c;a.repaint();if(b=="end_station"){$($("#"+b+" input")[1]).on("keydown",function(d){if(d.keyCode==13){newStationToList()}})}}function setupCustomDropdown(){var a=setInterval(function(){if(station_ids){clearInterval(a);var e=[""];for(var c=0;c<station_ids.length;c++){var d=station_ids[c][2];var f=getTradeHubName(d);if(d!==f){var b=f.toLowerCase();universeList[b]={};universeList[b].region=station_ids[c][1];universeList[b].station=station_ids[c][0];universeList[b].name=f;e.push(f)}var b=d.toLowerCase();universeList[b]={};universeList[b].region=station_ids[c][1];universeList[b].station=station_ids[c][0];universeList[b].name=d;e.push(d)}e.sort();initCompletely("custom_station",e);initCompletely("start_station",e);initCompletely("end_station",e);$(".end-selection").on("click",function(){stations_checked=$(".end-selection:checked").length;if(stations_checked>MAX_STATIONS){$(this).prop("checked",false);stations_checked=$(".end-selection:checked").length}$("#stations_remaining").text(MAX_STATIONS-stations_checked)});$(function(){var g=1;$("input").each(function(){if(this.type!="hidden"){var h=$(this);h.attr("tabindex",g);g++}})});$(".location-input").keyup(function(h){if(h.keyCode=="9"){var g=parseInt(h.target.id.charAt(h.target.id.length-1));if(g==1){$("#volume-threshold").focus()}else{if(g==2){$("#location-input-"+(g+1)).focus()}else{if(g==3){$("#profit-threshold").focus()}}}}});$(".loadingIcon").remove();$("header").css("opacity",1)}},1000)}function newStationToList(){var c=document.createElement("li");var b=universeList[$("#end_station input")[0].value.toLowerCase()].name;var e=document.createTextNode(b);if(addedToList.indexOf(b)==-1){addedToList.push(b);c.appendChild(e);if(b===""){alert("You must choose a station!")}else{document.getElementById("custom_route_end").style.display="block";document.getElementById("custom_route_end").appendChild(c)}$("#end_station input")[0].value="";$("#end_station input")[1].value="";var f=document.createElement("SPAN");var a=document.createTextNode(" \u00D7");f.className="closeStation";f.title="Remove: "+b;f.appendChild(a);c.appendChild(f)}var g=document.getElementsByClassName("closeStation");var d;for(d=0;d<g.length;d++){g[d].onclick=function(){var h=$(this)[0].previousSibling.data;addedToList[addedToList.indexOf(h)]="";$(this.parentElement).remove()}}}function onClickListeners(){$(".end").on("click",function(){$(this).hasClass("end-selected")?$(this).removeClass("end-selected"):$(this).addClass("end-selected")});$(".route-trader").on("click",function(){setupTradeOptions(true)});$(".station-trader").on("click",function(){setupTradeOptions(false)});$(".station-start").on("click",function(){$(".station-start").removeClass("station-selected");$(this).addClass("station-selected")})}function setAbout(){if(routeTrading==null){$("#about")[0].onclick=function(){$("#howto").modal("show")}}else{if(routeTrading){$("#about")[0].onclick=function(){$("#howto-route").modal("show")}}else{$("#about")[0].onclick=function(){$("#howto-station").modal("show")}}}}function setupCookies(){$("#lower-margin-threshold").val(getCookie("lower-margin-threshold"));$("#upper-margin-threshold").val(getCookie("upper-margin-threshold"));$("#volume-threshold").val(getCookie("volume-threshold"));$("#profit-threshold").val(getCookie("profit-threshold"));$("#roi-threshold").val(getCookie("roi-threshold"));$("#buy-threshold").val(getCookie("buy-threshold"));$("#weight-threshold").val(getCookie("weight-threshold"))}function updateCookies(){if(routeTrading){if($("#profit-threshold").val().length>0&&!isNaN($("#profit-threshold").val())){threshold_profit=parseFloat($("#profit-threshold").val());setCookie("profit-threshold",threshold_profit,7)}else{setCookie("profit-threshold","")}if($("#roi-threshold").val().length>0&&!isNaN($("#roi-threshold").val())){threshold_roi=parseFloat($("#roi-threshold").val());setCookie("roi-threshold",threshold_roi,7)}else{setCookie("roi-threshold","")}if($("#buy-threshold").val().length>0&&!isNaN($("#buy-threshold").val())){threshold_cost=parseFloat($("#buy-threshold").val());setCookie("buy-threshold",threshold_cost,7)}else{setCookie("buy-threshold","")}if($("#weight-threshold").val().length>0&&!isNaN($("#weight-threshold").val())){threshold_weight=parseFloat($("#weight-threshold").val());setCookie("weight-threshold",threshold_weight,7)}else{setCookie("weight-threshold","")}}else{if($("#lower-margin-threshold").val().length>0&&!isNaN($("#lower-margin-threshold").val())){threshold_margin_lower=parseFloat($("#lower-margin-threshold").val());setCookie("lower-margin-threshold",threshold_margin_lower,7)}else{setCookie("lower-margin-threshold","")}if($("#upper-margin-threshold").val().length>0&&!isNaN($("#upper-margin-threshold").val())){threshold_margin_upper=parseFloat($("#upper-margin-threshold").val());setCookie("upper-margin-threshold",threshold_margin_upper,7)}else{setCookie("upper-margin-threshold","")}if($("#volume-threshold").val().length>0&&!isNaN($("#volume-threshold").val())){volume_threshold=parseFloat($("#volume-threshold").val());setCookie("volume-threshold",volume_threshold,7)}else{setCookie("volume-threshold","")}}}function setupTradeOptions(a){routeTrading=a;$(".howto").toggle(false);$("#initial_choice").hide();setAbout();if(routeTrading){$("#route_trade").slideToggle();ga("send","event","Trade Style","Hauler","User Preference Campaign")}else{$("#station_trade").slideToggle();ga("send","event","Trade Style","Station Trader","User Preference Campaign")}}function open_popup(f,a,d){popup_table_buy.clear();popup_table_sell.clear();$("#popup_itemName").text("Trade info for "+a);$("#buyLocation").text("Buy at "+startLocation);$("#sellLocation").text("Sell at "+getStationName(d));var e=customBuy[thiz.startLocation.station][f];var c=customSell[d][f];for(var b=0;b<e.length;b++){if(e[b]){$("#popup-table-buy").dataTable().fnAddData([numberWithCommas(e[b][0].toFixed(2)),numberWithCommas(e[b][1].toFixed())])}}for(var b=0;b<c.length;b++){if(c[b]){$("#popup-table-sell").dataTable().fnAddData([numberWithCommas(c[b][0].toFixed(2)),numberWithCommas(c[b][1].toFixed())])}}$("#popup").modal("show");popup_table_buy.draw();popup_table_sell.draw()}function setCookie(b,f,c){var e=new Date();e.setTime(e.getTime()+(c*24*60*60*1000));var a="expires="+e.toUTCString();document.cookie=b+"="+f+";"+a+";path=/"}function getCookie(d){var b=d+"=";var f=decodeURIComponent(document.cookie);var a=f.split(";");for(var e=0;e<a.length;e++){var g=a[e];while(g.charAt(0)==" "){g=g.substring(1)}if(g.indexOf(b)==0){return g.substring(b.length,g.length)}}return""}function setStationTradingLocations(){startLocation=$("#custom_station input")[0].value.toLowerCase();var a=universeList[startLocation].region;var b=universeList[startLocation].station;startLocation=universeList[startLocation].name;startCoordinates.region=a;startCoordinates.station=b}function setRouteTradingLocations(){var a,c;var f=$("#start_station input")[0].value.toLowerCase();if(f){a=universeList[f].region;c=universeList[f].station;startLocation=universeList[f].name;var e=[];$.each($("#custom_route_end > li"),function(){var i={};var h=$(this).text();var j=h.substring(0,h.length-2).toLowerCase();var g=universeList[j];i.region=g.region;i.station=g.station;i.name=g.name;if(i.station!=c&&e.indexOf(i.station)==-1){endLocations.push(i.name);endCoordinates.push(i);e.push(i.station)}});var b=universeList[$("#end_station input")[0].value.toLowerCase()];var d={};d.region=b.region;d.station=b.station;d.name=b.name;if(d.station!=c&&e.indexOf(d.station)==-1){endLocations.push(d.name);endCoordinates.push(d);e.push(d.station)}}startCoordinates.region=a;startCoordinates.station=c}function createDataTable(){var a;var g=$("#buyingHeader");var f=$("#buyingFooter");var e=$("#core");var d=$("#dataTable");if(routeTrading){d.append("<thead><tr><th></th><th>Buy Item</th><th>Quantity</th><th>At Sell Price</th><th>Total Cost</th><th>Take To</th><th>At Buy Price</th><th>Total Profit</th><th>Profit Per Item</th><th>R.O.I.</th><th>Total Volume (m3)</th></tr></thead><tbody id='tableBody'></tbody>");g.text("Buying Sell Orders from "+startLocation);var c="";$.each(endLocations,function(){c+=this+", "});c=c.substring(0,c.length-2);var b="<div id='route-to'>Selling to the Buy Orders at "+c+"</div> ROI&nbsp;Greater&nbsp;Than&nbsp;"+threshold_roi+"% |&nbsp;Profits&nbsp;Greater&nbsp;Than&nbsp;"+numberWithCommas(threshold_profit)+"&nbsp;ISK";if(threshold_cost!==1000000000000000000){b+=" |&nbsp;Buy&nbsp;Costs&nbsp;Less&nbsp;Than&nbsp;"+numberWithCommas(threshold_cost)+"&nbsp;ISK"}if(threshold_weight!==1000000000000000000){b+=" |&nbsp;Total&nbsp;Volume&nbsp;Under&nbsp;"+numberWithCommas(threshold_weight)+"&nbsp;m3"}g.show();a=b+"<br/>*Profit is not guaranteed. <span class='avoidwrap'>Use at your own risk. <span class='avoidwrap'>Verify in game that prices are accurate.</span></span><div class='loading'></div>";f.html(a);f.show();e.slideToggle()}else{g.text("Station Trading at "+startLocation);g.show();a="Volume greater than: "+numberWithCommas(volume_threshold)+" | Margins between "+threshold_margin_lower+"% and "+threshold_margin_upper+"%<div class='loading'>Loading. Please wait...</div>";f.html(a);f.show();e.slideToggle();d.append("<thead><tr><th>Item</th><th>Buy Order</th><th>Sell Order</th><th>Profit Per Item</th><th>Margin</th><th>Volume</th></tr></thead><tbody id='tableBody'></tbody>")}}function execute(){if(routeTrading){new Route(startCoordinates,endCoordinates).startRoute()}else{new Station(startCoordinates).startStation()}}function init(){customBuy=[];customSell=[];startCoordinates={};endCoordinates=[];startLocation;endLocations=[];page=1;updateCookies();if(routeTrading){setRouteTradingLocations()}else{setStationTradingLocations()}var a=(startLocation&&startLocation.length>0);var b=(routeTrading&&endLocations.length>0)||!routeTrading;if(a&&b){$(".error").hide();$("#selection").hide()}else{$(".error").show();return}createDataTable();execute()}function displayError(){if(!errorShown){$("#connectEVE").slideToggle(true);errorShown=true}}function hideError(){if(errorShown){$("#connectEVE").slideToggle();errorShown=false}};