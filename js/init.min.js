var customStart,customEnd,popup_table_buy,popup_table_sell,curr,JITA=[10000002,60003760],AMARR=[10000043,60008494],DODIXIE=[10000032,60011866],RENS=[10000030,60004588],HEK=[10000042,60005686],IGNORE=null,stopped=!1,NUMBER_RETURNED=1,threshold_margin_lower=20,threshold_margin_upper=70,volume_threshold=1e3,threshold_profit=1e5,threshold_roi=1,threshold_cost=1e18,threshold_weight=1e18,customBuy=[],customSell=[],start_location="",isCustom=!1,routeTrading=null,init_itemIds=0,page=1,has_shown=!1,requestItemWeight=!0,stations_checked=0,MAX_STATIONS=25;function numberWithCommas(t){for(;/(\d+)(\d{3})/.test(t.toString());)t=t.toString().replace(/(\d+)(\d{3})/,"$1,$2");return t}function showAbout(){null==routeTrading?$("#howto").slideToggle():routeTrading?$("#howto-route").slideToggle():$("#howto-station").slideToggle()}function setup(t){routeTrading=t,$(".howto").toggle(!1),1==routeTrading?($("#about")[0].onclick=function(){$("#howto-route").modal("show")},$("#initial_choice").hide(),$("#route_trade").slideToggle()):($("#about")[0].onclick=function(){$("#howto-station").modal("show")},$("#initial_choice").hide(),$("#station_trade").slideToggle())}function shuffle(t){for(var e,o,s=t.length;0!==s;)o=Math.floor(Math.random()*s),e=t[s-=1],t[s]=t[o],t[o]=e;return t}function open_popup(t,e,o,s){popup_table_buy.clear(),popup_table_sell.clear(),$("#popup_itemName").text("Trade info for "+e),isCustom?($("#buyLocation").text("Buy at "+customStart),$("#sellLocation").text("Sell at "+o)):($("#buyLocation").text("Buy at "+start_location),$("#sellLocation").text("Sell at "+o));for(var a=customBuy[station_buy[1]][t],i=customSell[s][t],l=0;l<a.length;l++)a[l]&&$("#popup-table-buy").dataTable().fnAddData([numberWithCommas(a[l][0].toFixed(2)),numberWithCommas(a[l][1].toFixed())]);for(l=0;l<i.length;l++)i[l]&&$("#popup-table-sell").dataTable().fnAddData([numberWithCommas(i[l][0].toFixed(2)),numberWithCommas(i[l][1].toFixed())]);$("#popup").modal("show"),popup_table_buy.draw(),popup_table_sell.draw()}function unreachable(t,e){!has_shown&&$("#unreachable").is(":hidden")&&($("#unreachable").hide(),$("#unreachable").slideToggle(),has_shown=!0),t===e&&goAgain()}function setCookie(t,e,o){var s=new Date;s.setTime(s.getTime()+24*o*60*60*1e3);var a="expires="+s.toUTCString();document.cookie=t+"="+e+";"+a+";path=/"}function getCookie(t){for(var e=t+"=",o=decodeURIComponent(document.cookie).split(";"),s=0;s<o.length;s++){for(var a=o[s];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(e))return a.substring(e.length,a.length)}return""}function init(){var t=start_location,e=[];0==routeTrading?(isCustom?(e.push($("#custom_station option[value='"+$("#custom_station").val()+"']").text()),start_location="Nil",customStart=t,customEnd=e[0]):$.each($(".station-selected"),function(){start_location="Nil",t=$(this).val(),e.push($(this).val())}),$("#lower-margin-threshold").val().length>0&&!isNaN($("#lower-margin-threshold").val())?setCookie("lower-margin-threshold",threshold_margin_lower=parseFloat($("#lower-margin-threshold").val()),7):setCookie("lower-margin-threshold",""),$("#upper-margin-threshold").val().length>0&&!isNaN($("#upper-margin-threshold").val())?setCookie("upper-margin-threshold",threshold_margin_upper=parseFloat($("#upper-margin-threshold").val()),7):setCookie("upper-margin-threshold",""),$("#volume-threshold").val().length>0&&!isNaN($("#volume-threshold").val())?setCookie("volume-threshold",volume_threshold=parseFloat($("#volume-threshold").val()),7):setCookie("volume-threshold","")):(isCustom?(0==$(".end-selection:checked").length&&e.push("None"),$.each($(".end-selection:checked"),function(){e.length<MAX_STATIONS&&e.push($("[for='"+$(this).attr("id")+"']").text())}),customStart=t,customEnd=e):$.each($(".end-selected"),function(){e.push($(this).val())}),$("#profit-threshold").val().length>0&&!isNaN($("#profit-threshold").val())?setCookie("profit-threshold",threshold_profit=parseFloat($("#profit-threshold").val()),7):setCookie("profit-threshold",""),$("#roi-threshold").val().length>0&&!isNaN($("#roi-threshold").val())?setCookie("roi-threshold",threshold_roi=parseFloat($("#roi-threshold").val()),7):setCookie("roi-threshold",""),$("#buy-threshold").val().length>0&&!isNaN($("#buy-threshold").val())?setCookie("buy-threshold",threshold_cost=parseFloat($("#buy-threshold").val()),7):setCookie("buy-threshold",""),$("#weight-threshold").val().length>0&&!isNaN($("#weight-threshold").val())?setCookie("weight-threshold",threshold_weight=parseFloat($("#weight-threshold").val()),7):setCookie("weight-threshold",""));var o=e.indexOf("Jita")>-1,s=e.indexOf("Amarr")>-1,a=e.indexOf("Dodixie")>-1,i=e.indexOf("Rens")>-1,l=e.indexOf("Hek")>-1;if(e.indexOf(start_location)>-1&&1==e.length||0==e.length||""===start_location)$(".error").show();else{if($(".error").hide(),$("#selection").hide(),isCustom&&("None"===e[0]||"None"===start_location))return $(".error").show(),void $("#selection").show();$(".error").hide(),$("#selection").hide();var r=[];if(isCustom)n=$("#custom_route_start").val().split(","),$.each($(".end-selection:checked"),function(){r.length<MAX_STATIONS&&r.push($(this).val().split(","))});else{var n,h,d,u,c;o=e.indexOf("Jita")>-1,s=e.indexOf("Amarr")>-1,a=e.indexOf("Dodixie")>-1,i=e.indexOf("Rens")>-1,l=e.indexOf("Hek")>-1;"Jita"===t?(n=JITA,h=s?AMARR:IGNORE,d=a?DODIXIE:IGNORE,u=i?RENS:IGNORE,c=l?HEK:IGNORE):"Amarr"===t?(n=AMARR,h=o?JITA:IGNORE,d=a?DODIXIE:IGNORE,u=i?RENS:IGNORE,c=l?HEK:IGNORE):"Dodixie"===t?(n=DODIXIE,h=s?AMARR:IGNORE,d=o?JITA:IGNORE,u=i?RENS:IGNORE,c=l?HEK:IGNORE):"Rens"===t?(n=RENS,h=s?AMARR:IGNORE,d=a?DODIXIE:IGNORE,u=o?JITA:IGNORE,c=l?HEK:IGNORE):(n=HEK,h=s?AMARR:IGNORE,d=a?DODIXIE:IGNORE,u=i?RENS:IGNORE,c=o?JITA:IGNORE)}if($("#title-banner").slideToggle(),routeTrading){$("#dataTable").append("<thead><tr><th>Item</th><th>Sell Order</th><th>Quantity</th><th>Total Cost</th><th>Take To</th><th>Buy Order</th><th>Quantity</th><th>Total Profit</th><th>Profit Per Item</th><th>R.O.I.</th><th>Total Volume (m3)</th></tr></thead>"),$("#dataTable thead:last").after("<tbody id='tableBody'></tbody>"),$("#buyingHeader").text("Buying Sell Orders from "+t);var p="";isCustom?$.each(e,function(){p+=this+", "}):(o&&"Jita"!==t&&(p+="Jita, "),s&&"Amarr"!==t&&(p+="Amarr, "),a&&"Dodixie"!==t&&(p+="Dodixie, "),i&&"Rens"!==t&&(p+="Rens, "),l&&"Hek"!==t&&(p+="Hek, ")),p.length>0&&(p="<div id='route-to'>Selling to the Buy Orders at "+p.substring(0,p.length-2)+"</div>"),p+="ROI&nbsp;Greater&nbsp;Than&nbsp;"+threshold_roi+"% |&nbsp;Profits&nbsp;Greater&nbsp;Than&nbsp;"+numberWithCommas(threshold_profit)+"&nbsp;ISK",1e18!==threshold_cost&&(p+=" |&nbsp;Buy&nbsp;Costs&nbsp;Less&nbsp;Than&nbsp;"+numberWithCommas(threshold_cost)+"&nbsp;ISK"),1e18!==threshold_weight&&(p+=" |&nbsp;Total&nbsp;Volume&nbsp;Under&nbsp;"+numberWithCommas(threshold_weight)+"&nbsp;m3"),$("#buyingFooter").html(p+"<br/>*Profit is not guaranteed. <span class='avoidwrap'>Use at your own risk. <span class='avoidwrap'>Verify in game that prices are accurate.</span></span><div class='loading'></div>"),$("#buyingFooter").show(),$("#buyingHeader").show(),$("#core").slideToggle(),null!=h&&r.push(h),null!=d&&r.push(d),null!=u&&r.push(u),null!=c&&r.push(c);for(var m=0;m<r.length;m++)for(var g=0;g<r[m].length;g++)r[m][g]=parseInt(r[m][g]);beginRoute(n,r)}else $("#buyingHeader").text("Station Trading at "+t),$("#buyingFooter").html("Volume greater than: "+numberWithCommas(volume_threshold)+" | Margins between "+threshold_margin_lower+"% and "+threshold_margin_upper+"%<div class='loading'>Loading. Please wait...</div>"),$("#buyingFooter").show(),$("#buyingHeader").show(),$("#core").slideToggle(),isCustom&&(n=$("#custom_station").val().split(",")),$("#dataTable").append("<thead><tr><th>Item</th><th>Buy Order</th><th>Sell Order</th><th>Profit Per Item</th><th>Margin</th><th>Volume</th></tr></thead>"),$("#dataTable thead:last").after("<tbody id='tableBody'></tbody>"),beginRoute(n,n)}}$(document).ready(function(){$("#stations_remaining").text(MAX_STATIONS),popup_table_buy=$("#popup-table-buy").DataTable({order:[[0,"asc"]],lengthMenu:[[10],["10"]]}),popup_table_sell=$("#popup-table-sell").DataTable({order:[[0,"desc"]],lengthMenu:[[10],["10"]]}),$(".start").on("click",function(){start_location=$(this).val(),$(".start").removeClass("start-selected"),$(this).addClass("start-selected"),"Jita"==start_location&&$("#add_jita").removeClass("end-selected"),"Amarr"==start_location&&$("#add_amarr").removeClass("end-selected"),"Dodixie"==start_location&&$("#add_dodixie").removeClass("end-selected"),"Rens"==start_location&&$("#add_rens").removeClass("end-selected"),"Hek"==start_location&&$("#add_hek").removeClass("end-selected")}),$(".end").on("click",function(){$(this).hasClass("end-selected")?$(this).removeClass("end-selected"):$(this).addClass("end-selected")}),$(".station-start").on("click",function(){$(".station-start").removeClass("station-selected"),$(this).addClass("station-selected")}),$("#custom_route").on("click",function(){$(".standard").slideToggle(),$(".custom").slideToggle(),"Enable Custom Route"===$(this).val()?($(this).val("Disable Custom Route"),isCustom=!0):($(this).val("Enable Custom Route"),isCustom=!1)}),$("#custom_select").on("click",function(){$(".standard").slideToggle(),$(".custom").slideToggle(),"Enable Custom Selection"===$(this).val()?($(this).val("Disable Custom Selection"),isCustom=!0):($(this).val("Enable Custom Selection"),isCustom=!1)});for(var t=0;t<station_ids.length;t++)$("#custom_route_start").append("<option value="+[station_ids[t][1],station_ids[t][0]]+">"+station_ids[t][2]+"</option>"),$("#custom_route_end").append('<li><input id="end-'+t+'" class="end-selection" type="checkbox" value='+[station_ids[t][1],station_ids[t][0]]+'><label for="end-'+t+'">'+station_ids[t][2]+"</label></li>"),$("#custom_station").append("<option value="+[station_ids[t][1],station_ids[t][0]]+">"+station_ids[t][2]+"</option>");$(".end-selection").on("click",function(){(stations_checked=$(".end-selection:checked").length)>MAX_STATIONS&&($(this).prop("checked",!1),stations_checked=$(".end-selection:checked").length),$("#stations_remaining").text(MAX_STATIONS-stations_checked)}),$("#custom_route_start").change(function(){start_location=$("#custom_route_start option[value='"+$("#custom_route_start").val()+"']").text()}),$("#custom_station").change(function(){start_location=$("#custom_station option[value='"+$("#custom_station").val()+"']").text()}),$("#lower-margin-threshold").val(getCookie("lower-margin-threshold")),$("#upper-margin-threshold").val(getCookie("upper-margin-threshold")),$("#volume-threshold").val(getCookie("volume-threshold")),$("#profit-threshold").val(getCookie("profit-threshold")),$("#roi-threshold").val(getCookie("roi-threshold")),$("#buy-threshold").val(getCookie("buy-threshold")),$("#weight-threshold").val(getCookie("weight-threshold")),$('input[type="number"]').keypress(function(t){var e=t||window.event,o=e.keyCode||e.which;o=String.fromCharCode(o);/[0-9]|\./.test(o)||8===e.charCode||0===e.charCode||(e.returnValue=!1,e.preventDefault&&e.preventDefault())})});