var threshold_margin_lower=20;var threshold_margin_upper=40;var volume_threshold=1000;var threshold_profit=100000;var threshold_roi=1;var threshold_cost=1000000000000000000;var threshold_weight=1000000000000000000;var routeTrading=null;var isCustom=false;var customBuy=[];var customSell=[];var page=1;var popup_table_buy;var popup_table_sell;var stations_checked=0;var MAX_STATIONS=25;var universeList={};$(document).ready(function(){$("#stations_remaining").text(MAX_STATIONS);popup_table_buy=$("#popup-table-buy").DataTable({order:[[0,"asc"]],lengthMenu:[[10],["10"]]});popup_table_sell=$("#popup-table-sell").DataTable({order:[[0,"desc"]],lengthMenu:[[10],["10"]]});onClickListeners();setupCustomDropdown();$('input[type="number"]').keypress(function(c){var d=c||window.event;var a=d.keyCode||d.which;a=String.fromCharCode(a);var b=/[0-9]|\./;if(!b.test(a)&&d.charCode!==8&&d.charCode!==0){d.returnValue=false;if(d.preventDefault){d.preventDefault()}}});setAbout();setupCookies()});function setupCustomDropdown(){for(var a=0;a<station_ids.length;a++){$("#custom_route_start").append("<option>"+station_ids[a][2]+"</option>");$("#custom_route_end").append('<li><input id="echeck-'+a+'" class="end-selection" type="checkbox" value="'+station_ids[a][2]+'"><label for="echeck-'+a+'">'+station_ids[a][2]+"</label></li>");$("#custom_station").append("<option>"+station_ids[a][2]+"</option>");universeList[station_ids[a][2]]={};universeList[station_ids[a][2]].region=station_ids[a][1];universeList[station_ids[a][2]].station=station_ids[a][0]}$(".end-selection").on("click",function(){stations_checked=$(".end-selection:checked").length;if(stations_checked>MAX_STATIONS){$(this).prop("checked",false);stations_checked=$(".end-selection:checked").length}$("#stations_remaining").text(MAX_STATIONS-stations_checked)})}function onClickListeners(){$(".start").on("click",function(){$(".start").removeClass("start-selected");$(this).addClass("start-selected");checkStartSelection()});$(".end").on("click",function(){$(this).hasClass("end-selected")?$(this).removeClass("end-selected"):$(this).addClass("end-selected");checkEndSelection()});$(".route-trader").on("click",function(){setupTradeOptions(true)});$(".station-trader").on("click",function(){setupTradeOptions(false)});$(".station-start").on("click",function(){$(".station-start").removeClass("station-selected");$(this).addClass("station-selected")});$("#custom_route").on("click",function(){$(".standard").slideToggle();$(".custom").slideToggle();if($(this).val()==="Enable Custom Route"){$(this).val("Disable Custom Route");isCustom=true}else{$(this).val("Enable Custom Route");isCustom=false}});$("#custom_select").on("click",function(){$(".standard").slideToggle();$(".custom").slideToggle();if($(this).val()==="Enable Custom Selection"){$(this).val("Disable Custom Selection");isCustom=true}else{$(this).val("Enable Custom Selection");isCustom=false}})}function checkStartSelection(){$.each($(".start-selected"),function(){var a=this;$.each($(".end-selected"),function(){if(this.dataset.station===a.dataset.station){$(this).removeClass("end-selected")}})})}function checkEndSelection(){$.each($(".start-selected"),function(){var a=this;$.each($(".end-selected"),function(){if(this.dataset.station===a.dataset.station){$(a).removeClass("start-selected")}})})}function numberWithCommas(a){while(/(\d+)(\d{3})/.test(a.toString())){a=a.toString().replace(/(\d+)(\d{3})/,"$1,$2")}return a}function setAbout(){if(routeTrading==null){$("#about")[0].onclick=function(){$("#howto").modal("show")}}else{if(routeTrading){$("#about")[0].onclick=function(){$("#howto-route").modal("show")}}else{$("#about")[0].onclick=function(){$("#howto-station").modal("show")}}}}function setupCookies(){$("#lower-margin-threshold").val(getCookie("lower-margin-threshold"));$("#upper-margin-threshold").val(getCookie("upper-margin-threshold"));$("#volume-threshold").val(getCookie("volume-threshold"));$("#profit-threshold").val(getCookie("profit-threshold"));$("#roi-threshold").val(getCookie("roi-threshold"));$("#buy-threshold").val(getCookie("buy-threshold"));$("#weight-threshold").val(getCookie("weight-threshold"))}function updateCookies(){if(routeTrading){if($("#profit-threshold").val().length>0&&!isNaN($("#profit-threshold").val())){threshold_profit=parseFloat($("#profit-threshold").val());setCookie("profit-threshold",threshold_profit,7)}else{setCookie("profit-threshold","")}if($("#roi-threshold").val().length>0&&!isNaN($("#roi-threshold").val())){threshold_roi=parseFloat($("#roi-threshold").val());setCookie("roi-threshold",threshold_roi,7)}else{setCookie("roi-threshold","")}if($("#buy-threshold").val().length>0&&!isNaN($("#buy-threshold").val())){threshold_cost=parseFloat($("#buy-threshold").val());setCookie("buy-threshold",threshold_cost,7)}else{setCookie("buy-threshold","")}if($("#weight-threshold").val().length>0&&!isNaN($("#weight-threshold").val())){threshold_weight=parseFloat($("#weight-threshold").val());setCookie("weight-threshold",threshold_weight,7)}else{setCookie("weight-threshold","")}}else{if($("#lower-margin-threshold").val().length>0&&!isNaN($("#lower-margin-threshold").val())){threshold_margin_lower=parseFloat($("#lower-margin-threshold").val());setCookie("lower-margin-threshold",threshold_margin_lower,7)}else{setCookie("lower-margin-threshold","")}if($("#upper-margin-threshold").val().length>0&&!isNaN($("#upper-margin-threshold").val())){threshold_margin_upper=parseFloat($("#upper-margin-threshold").val());setCookie("upper-margin-threshold",threshold_margin_upper,7)}else{setCookie("upper-margin-threshold","")}if($("#volume-threshold").val().length>0&&!isNaN($("#volume-threshold").val())){volume_threshold=parseFloat($("#volume-threshold").val());setCookie("volume-threshold",volume_threshold,7)}else{setCookie("volume-threshold","")}}}function setupTradeOptions(a){routeTrading=a;$(".howto").toggle(false);$("#initial_choice").hide();setAbout();if(routeTrading){$("#route_trade").slideToggle();ga("send","event","Trade Style","Hauler","User Preference Campaign")}else{$("#station_trade").slideToggle();ga("send","event","Trade Style","Station Trader","User Preference Campaign")}}function open_popup(g,b,a,d){popup_table_buy.clear();popup_table_sell.clear();$("#popup_itemName").text("Trade info for "+b);if(isCustom){$("#buyLocation").text("Buy at "+startLocation);$("#sellLocation").text("Sell at "+a)}else{$("#buyLocation").text("Buy at "+startLocation);$("#sellLocation").text("Sell at "+a)}var f=customBuy[station_buy[1]][g];var e=customSell[d][g];for(var c=0;c<f.length;c++){if(f[c]){$("#popup-table-buy").dataTable().fnAddData([numberWithCommas(f[c][0].toFixed(2)),numberWithCommas(f[c][1].toFixed())])}}for(var c=0;c<e.length;c++){if(e[c]){$("#popup-table-sell").dataTable().fnAddData([numberWithCommas(e[c][0].toFixed(2)),numberWithCommas(e[c][1].toFixed())])}}$("#popup").modal("show");popup_table_buy.draw();popup_table_sell.draw()}function setCookie(b,f,c){var e=new Date();e.setTime(e.getTime()+(c*24*60*60*1000));var a="expires="+e.toUTCString();document.cookie=b+"="+f+";"+a+";path=/"}function getCookie(d){var b=d+"=";var f=decodeURIComponent(document.cookie);var a=f.split(";");for(var e=0;e<a.length;e++){var g=a[e];while(g.charAt(0)==" "){g=g.substring(1)}if(g.indexOf(b)==0){return g.substring(b.length,g.length)}}return""}var startCoordinates={};var endCoordinates=[];var startLocation;var endLocations=[];function setStationTradingLocations(){var a,b;if(isCustom){startLocation=$("#custom_station").val();a=universeList[startLocation].region;b=universeList[startLocation].station}else{var c=$(".station-selected")[0];startLocation=c.value;a=c.dataset.region;b=c.dataset.station}endLocations=[startLocation];startCoordinates.region=a;startCoordinates.station=b}function setRouteTradingLocations(){var a,b;if(isCustom){startLocation=$("#custom_route_start").val();a=universeList[startLocation].region;b=universeList[startLocation].station;$.each($(".end-selection:checked"),function(){var d={};d.name=this.value;d.region=universeList[d.name].region;d.station=universeList[d.name].station;endLocations.push(d.name);endCoordinates.push(d)})}else{var c=$(".start-selected")[0];if(c){a=c.dataset.region;b=c.dataset.station;startLocation=c.value;$.each($(".end-selected"),function(){var d={};d.region=$(this)[0].dataset.region;d.station=$(this)[0].dataset.station;d.name=$(this)[0].value;endLocations.push(d.name);endCoordinates.push(d)})}}startCoordinates.region=a;startCoordinates.station=b}function createDataTable(){var a;var g=$("#buyingHeader");var f=$("#buyingFooter");var e=$("#core");var d=$("#dataTable");if(routeTrading){d.append("<thead><tr><th>Item</th><th>Sell Order</th><th>Quantity</th><th>Total Cost</th><th>Take To</th><th>Buy Order</th><th>Quantity</th><th>Total Profit</th><th>Profit Per Item</th><th>R.O.I.</th><th>Total Volume (m3)</th></tr></thead><tbody id='tableBody'></tbody>");g.text("Buying Sell Orders from "+startLocation);var c="";$.each(endLocations,function(){c+=this+", "});c=c.substring(0,c.length-2);var b="<div id='route-to'>Selling to the Buy Orders at "+c+"</div> ROI&nbsp;Greater&nbsp;Than&nbsp;"+threshold_roi+"% |&nbsp;Profits&nbsp;Greater&nbsp;Than&nbsp;"+numberWithCommas(threshold_profit)+"&nbsp;ISK";if(threshold_cost!==1000000000000000000){b+=" |&nbsp;Buy&nbsp;Costs&nbsp;Less&nbsp;Than&nbsp;"+numberWithCommas(threshold_cost)+"&nbsp;ISK"}if(threshold_weight!==1000000000000000000){b+=" |&nbsp;Total&nbsp;Volume&nbsp;Under&nbsp;"+numberWithCommas(threshold_weight)+"&nbsp;m3"}g.show();a=b+"<br/>*Profit is not guaranteed. <span class='avoidwrap'>Use at your own risk. <span class='avoidwrap'>Verify in game that prices are accurate.</span></span><div class='loading'></div>";f.html(a);f.show();e.slideToggle()}else{g.text("Station Trading at "+startLocation);g.show();a="Volume greater than: "+numberWithCommas(volume_threshold)+" | Margins between "+threshold_margin_lower+"% and "+threshold_margin_upper+"%<div class='loading'>Loading. Please wait...</div>";f.html(a);f.show();e.slideToggle();d.append("<thead><tr><th>Item</th><th>Buy Order</th><th>Sell Order</th><th>Profit Per Item</th><th>Margin</th><th>Volume</th></tr></thead><tbody id='tableBody'></tbody>")}}function execute(){var b;var a;if(routeTrading){b=[startCoordinates.region,startCoordinates.station];a=[];$.each(endCoordinates,function(){a.push([this.region,this.station])})}else{b=[startCoordinates.region,startCoordinates.station];a=b}beginRoute(b,a)}function init(){updateCookies();if(routeTrading){setRouteTradingLocations()}else{setStationTradingLocations()}if(startLocation&&startLocation.length>0&&endLocations.length>0){$(".error").hide();$("#selection").hide()}else{$(".error").show();return}createDataTable();execute()};