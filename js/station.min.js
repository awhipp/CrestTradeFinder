function Station(a){this.stationLocation=a;this.allOrders={};this.allOrders.completePages=[];this.allOrders.complete=false;this.allOrders.pageBookend=PAGE_MULTIPLE;this.itemCache={};this.itemIds=[];this.secondsToRefresh=60;this.filtered=false;this.completed=false;this.filterCount=0;this.asyncChecker=null;this.asyncCalculator=null;this.asyncFilter=null;this.asyncRefresher=null;routes.push(this)}Station.prototype.className=function(){return"Station"};Station.prototype.startStation=function(){var b;var c=parseInt(this.stationLocation.region);var a=parseInt(this.stationLocation.station);for(b=1;b<=PAGE_MULTIPLE;b++){this.getOrders(c,a,b,this.allOrders,ALL_ORDER)}$("#selection").hide();this.asyncCheck()};Station.prototype.asyncCheck=function(){var a=this;this.asyncChecker=setInterval(function(){a.executeOrders()},1000)};Station.prototype.recalculateProgress=function(){var a=this.getNumberOfCompletePages(this.allOrders);return a===0?1:a};Station.prototype.getOrders=function(f,d,e,g,a){var b=marketEndpointBuilder(f,e,a);var c=this;if(!g.completePages[e]){$.ajax({type:"get",url:b,dataType:"json",contentType:"application/json",async:true,success:function(l){incrementProgress(g,e);if(l.length===0&&!g.complete){g.complete=true;console.log("Completed "+d+" order fetch at "+e);c.completed=true}else{for(var j=0;j<l.length;j++){if(l[j]["location_id"]===d){var m=l[j]["type_id"];if(!g[m]){g[m]=[]}g[m].push(l[j])}}if(!g.complete&&c.getNumberOfCompletePages(g)===g.pageBookend){var k=e+1;g.pageBookend=(g.pageBookend+PAGE_MULTIPLE);for(var h=g.pageBookend;k<=h;k++){c.getOrders(f,d,k,g,a)}}}},error:function(j,l,k){displayError();incrementProgress(g,e);if(!g.complete&&c.getNumberOfCompletePages(g)===g.pageBookend){var i=e+1;g.pageBookend=(g.pageBookend+PAGE_MULTIPLE);for(var h=g.pageBookend;i<=h;i++){c.getOrders(f,d,i,g,a)}}}})}};Station.prototype.getNumberOfCompletePages=function(a){var c=0;for(var b=0;b<a.completePages.length;b++){if(a.completePages[b]){c++}}return c};Station.prototype.checkOrdersComplete=function(){var a=(this.getNumberOfCompletePages(this.allOrders)===this.allOrders.pageBookend);var b=this.allOrders.complete&&this.completed;return(a&&b)};Station.prototype.executeOrders=function(){if(this.checkOrdersComplete()){clearInterval(this.asyncChecker);hideError();for(itemId in this.allOrders){if(itemId!=="completePages"&&itemId!=="complete"&&itemId!=="pageBookend"){this.itemIds.push(itemId)}}this.asyncCalculate()}};Station.prototype.clear=function(){this.stationLocation=null;this.allOrders={};this.allOrders.completePages=[];this.allOrders.complete=false;this.allOrders.pageBookend=PAGE_MULTIPLE;this.itemCache={};this.itemIds=[];this.secondsToRefresh=60;this.filtered=false;this.filterCount=0;this.completed=false;clearInterval(this.asyncChecker);clearInterval(this.asyncCalculator);clearInterval(this.asyncFilter);clearInterval(this.asyncRefresher)};Station.prototype.asyncRefresh=function(){var a=this;this.asyncRefresher=setInterval(function(){if(a.secondsToRefresh<=0){clearInterval(a.asyncRefresher);$("#refresh-timer").remove();$("#buyingFooter").append('<div id="refresh-button"><input type="button" class="btn btn-default" onclick="refresh()" value="Refresh Table with Last Query"/></div>')}else{if(rowAdded){$(".loading").hide()}else{$(".loading").text("No trades found for your filters.")}$(".tableLoadingIcon").hide();$("#refresh-timer").html("<p>Refresh allowed in: "+a.secondsToRefresh+" seconds.");a.secondsToRefresh--}},1000)};Station.prototype.asyncCalculate=function(){var a=this;this.asyncCalculator=setInterval(function(){if(!a.filtered){a.filtered=true;$("#buyingFooter").append("<div id='filtering-data'>Filtering Results. Please wait.</br>If it takes too long try a smaller margin range.</div>");a.asyncFiltering()}while(a.itemIds.length!=0&&executingCount<1500){executingCount++;var b=a.itemIds.splice(0,1)[0];a.calculateNext(b)}if(a.itemIds.length==0&&executingCount<=0){clearInterval(a.asyncCalculator);$(".tableLoadingIcon").hide();if(rowAdded){$(".loading").hide()}$("#buyingFooter").append('<div id="refresh-timer"></div>');a.asyncRefresh()}},1000)};Station.prototype.calculateNext=function(d){var a=getMarketData(this.allOrders[d],this.stationLocation.station,SELL_ORDER,d,false);if(a.length>0){var b=false;if(this.allOrders[d]){var c=getMarketData(this.allOrders[d],this.stationLocation.station,BUY_ORDER,d,false);if(c.length>0){b=true;this.getItemInfo(d,a,c)}}if(!b){executingCount--}}else{executingCount--}};Station.prototype.getItemInfo=function(h,c,g){var k=g[0][0];var b=c[0][0];for(var f=0;f<c.length;f++){for(var e=0;e<g.length;e++){if(g[e][0]>b){b=g[e][0]}if(c[f][0]<k){k=c[f][0]}}}var l={};c=k;g=b;var a=g-c;var d=(g-c)/g;if(d*100>=threshold_margin_lower&&d*100<=threshold_margin_upper&&a>1000){l.buyPrice=c;l.sellPrice=g;l.itemId=h;this.getItemVolume(h,l)}else{executingCount--}};Station.prototype.asyncFiltering=function(){var a=this;this.asyncFilter=setInterval(function(){a.filterCount+=1;var c="";for(var b=0;b<(a.filterCount%5);b++){c+="."}$("#filtering-data").html("Filtering Results. Please wait"+c+"</br>If it takes too long try a smaller margin range.");if(executingCount==0){clearInterval(a.asyncFilter);$("#filtering-data").remove()}},250)};Station.prototype.getItemVolume=function(d,c){var a=getVolumeEndpointBuilder(this.stationLocation.region,d);var b=this;$.ajax({type:"get",url:a,dataType:"json",async:true,cache:false,contentType:"application/json",success:function(e){if(e&&e[e.length-1]&&e[e.length-1].volume){c.volume=e[e.length-1].volume;c.volume14=0;c.volume30=0;for(var f=1;f<31;f++){if(e[e.length-f]&&e[e.length-f].volume){if(f<15){c.volume14+=e[e.length-f].volume}c.volume30+=e[e.length-f].volume}}c.volume14=parseInt(c.volume14/14);c.volume30=parseInt(c.volume30/30);if(c.volume14>=volume_threshold){b.getItemWeight(d,c)}else{executingCount--}}else{executingCount--}},error:function(f,e){if(f.status!=404&&f.statusText!=="parsererror"){b.getItemVolume(d,c)}else{executingCount--}}})};Station.prototype.getItemWeight=function(d,c){if(this.itemCache[d]){c.itemName=this.itemCache[d].name;this.addRow(c);executingCount--}else{var b=this;var a=getWeightEndpointBuilder(d);$.ajax({type:"get",url:a,dataType:"json",async:true,cache:false,contentType:"application/json",success:function(f){executingCount--;var e=f.name;b.itemCache[d]={};b.itemCache[d].name=e;c.itemName=e;b.addRow(c)},error:function(f,e){if(f.status!=404&&f.statusText!=="parsererror"){b.getItemWeight(d,c)}else{executingCount--}}})}};Station.prototype.addRow=function(d){var c=d.sellPrice-d.buyPrice;var b=(d.sellPrice-d.buyPrice)/d.sellPrice;b=(b.toFixed(3)*100).toFixed(1)+"%";createDataTable();var a=[d.itemName,numberWithCommas(d.buyPrice.toFixed(2)),numberWithCommas(d.sellPrice.toFixed(2)),numberWithCommas(c.toFixed(2)),b,numberWithCommas(d.volume),numberWithCommas(d.volume14),numberWithCommas(d.volume30)];$("#dataTable").dataTable().fnAddData(a);rowAdded=true};