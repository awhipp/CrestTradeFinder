function Station(a){this.stationLocation=a;this.allOrders={};this.allOrders.completePages=[];this.allOrders.complete=false;this.allOrders.pageBookend=PAGE_MULTIPLE;this.itemCache={};this.totalProgress=0;this.itemIds=[];this.executingCount=0;this.secondsToRefresh=60;this.tableCreated=false;this.filtered=false;this.filterCount=0;this.asyncChecker=null;this.asyncCalculator=null;this.asyncFilter=null}Station.prototype.className=function(){return"Station"};Station.prototype.startStation=function(){thiz=this;var b;var c=parseInt(this.stationLocation.region);var a=parseInt(this.stationLocation.station);for(b=1;b<=PAGE_MULTIPLE;b++){this.getOrders(c,a,b,this.allOrders,ALL_ORDER)}$("#selection").hide();this.asyncCheck()};Station.prototype.asyncCheck=function(){this.asyncChecker=setInterval(function(){thiz.executeOrders()},1000)};Station.prototype.marketEndpointBuilder=function(d,c,a){var b=ESI_ENDPOINT+"/latest/markets/"+d+"/orders/?datasource=tranquility&page="+c+"&order_type="+a+"&language=en-us&iteration="+iteration;return b.replace(/\s/g,"")};Station.prototype.getWeightEndpointBuilder=function(b){var a=ESI_ENDPOINT+"/latest/universe/types/"+b+"/?datasource=tranquility&language=en-us&iteration="+iteration;return a.replace(/\s/g,"")};Station.prototype.getVolumeEndpointBuilder=function(b){var a=ESI_ENDPOINT+"/latest/markets/"+this.stationLocation.region+"/history/?datasource=tranquility&type_id="+b+"&language=en-us&iteration="+iteration;return a.replace(/\s/g,"")};Station.prototype.recalculateProgress=function(){var a=this.getNumberOfCompletePages(this.allOrders);return a===0?1:a};Station.prototype.incrementProgress=function(b,a){if(this.totalProgress!==100){this.totalProgress=35*Math.log10(this.recalculateProgress());this.totalProgress=this.totalProgress>100?100:this.totalProgress;$(".loading").html("<b>Getting orders: "+this.totalProgress.toFixed(2)+"% complete</b>")}b.completePages[a]=true};Station.prototype.getOrders=function(e,c,d,f,a){var b=this.marketEndpointBuilder(e,d,a);if(!f.completePages[d]){$.ajax({type:"get",url:b,dataType:"json",contentType:"application/json",async:true,success:function(k){thiz.incrementProgress(f,d);if(k.length===0&&!f.complete){f.complete=true;console.log("Completed "+c+" order fetch at "+d)}else{for(var h=0;h<k.length;h++){if(k[h]["location_id"]===c){var l=k[h]["type_id"];if(!f[l]){f[l]=[]}f[l].push(k[h])}}if(!f.complete&&thiz.getNumberOfCompletePages(f)===f.pageBookend){var j=d+1;f.pageBookend=(f.pageBookend+PAGE_MULTIPLE);for(var g=f.pageBookend;j<=g;j++){thiz.getOrders(e,c,j,f,a)}}}},error:function(g,i,h){displayError();thiz.incrementProgress(f,d)}})}};Station.prototype.getNumberOfCompletePages=function(a){var c=0;for(var b=0;b<a.completePages.length;b++){if(a.completePages[b]){c++}}return c};Station.prototype.checkOrdersComplete=function(){var a=(this.getNumberOfCompletePages(this.allOrders)===this.allOrders.pageBookend);var b=this.allOrders.complete;return(a&&b)};Station.prototype.executeOrders=function(){if(this.checkOrdersComplete()){clearInterval(this.asyncChecker);hideError();for(itemId in this.allOrders){if(itemId!=="completePages"&&itemId!=="complete"&&itemId!=="pageBookend"){this.itemIds.push(itemId)}}this.totalProgress=100;$(".loading").text("Getting orders: "+this.totalProgress.toFixed(2)+"% complete");this.asyncCalculate()}};Station.prototype.refresh=function(){$("#noselect-object").html('<table id="dataTable" class="display"></table>');$(".dataTables_filter").remove();$(".dt-buttons").remove();$("#refresh-button").remove();iteration+=1;init()};Station.prototype.asyncRefresh=function(){this.asyncRefresher=setInterval(function(){if(thiz.secondsToRefresh<=0){clearInterval(thiz.asyncRefresher);$("#refresh-timer").remove();$("#buyingFooter").append('<div id="refresh-button"><br><input type="button" class="btn btn-default" onclick="thiz.refresh()" value="Refresh Table with Last Query"/></div>')}else{$("#refresh-timer").html("<br><p>Refresh allowed in: "+thiz.secondsToRefresh+" seconds.");thiz.secondsToRefresh--}},1000)};Station.prototype.asyncCalculate=function(){this.asyncCalculator=setInterval(function(){while(thiz.itemIds.length!=0&&thiz.executingCount<1500){thiz.executingCount++;var a=thiz.itemIds.splice(0,1)[0];thiz.calculateNext(a)}if(thiz.itemIds.length==0&&thiz.executingCount<=0){clearInterval(thiz.asyncCalculator);$(".loading").text("No trades found for your filters.");$("#buyingFooter").append('<div id="refresh-timer"></div>');thiz.asyncRefresh()}},1000)};Station.prototype.calculateNext=function(d){var a=getMarketData(this.allOrders[d],this.stationLocation.station,SELL_ORDER,d);if(a.length>0){var b=false;if(this.allOrders[d]){var c=getMarketData(this.allOrders[d],this.stationLocation.station,BUY_ORDER,d);if(c.length>0){b=true;this.getItemInfo(d,a,c)}}if(!b){this.executingCount--}}else{this.executingCount--}};Station.prototype.getItemInfo=function(h,c,g){var k=g[0][0];var b=c[0][0];for(var f=0;f<c.length;f++){for(var e=0;e<g.length;e++){if(g[e][0]>b){b=g[e][0]}if(c[f][0]<k){k=c[f][0]}}}var l={};c=k;g=b;var a=g-c;var d=(g-c)/g;if(d*100>=threshold_margin_lower&&d*100<=threshold_margin_upper&&a>1000){l.buyPrice=c;l.sellPrice=g;l.itemId=h;this.getItemVolume(h,l)}else{this.executingCount--}};Station.prototype.asyncFiltering=function(){this.asyncFilter=setInterval(function(){thiz.filterCount++;var b="";for(var a=0;a<(thiz.filterCount%5);a++){b+="."}$("#filtering-data").html("<b>Filtering Results. Please wait"+b+"</b></br>If it takes too long try a smaller margin range.");if(thiz.executingCount==0){clearInterval(thiz.asyncFilter);$("#filtering-data").remove()}},1000)};Station.prototype.getItemVolume=function(c,b){if(!this.filtered){this.filtered=true;$("#buyingFooter").append("<div id='filtering-data'><b>Filtering Results. Please wait.</b></br>If it takes too long try a smaller margin range.</div>");this.asyncFiltering()}var a=this.getVolumeEndpointBuilder(c);$.ajax({type:"get",url:a,dataType:"json",async:true,cache:false,contentType:"application/json",success:function(d){if(d&&d[d.length-1]&&d[d.length-1].volume){b.volume=d[d.length-1].volume;if(b.volume>=volume_threshold){thiz.getItemWeight(c,b)}else{thiz.executingCount--}}else{thiz.executingCount--}},error:function(e,d){if(e.status!=404&&e.statusText!=="parsererror"){thiz.getItemVolume(c,rows)}else{thiz.executingCount--}}})};Station.prototype.getItemWeight=function(c,b){if(this.itemCache[c]){b.itemName=this.itemCache[c].name;this.addRow(b);this.executingCount--}else{var a=this.getWeightEndpointBuilder(c);$.ajax({type:"get",url:a,dataType:"json",async:true,cache:false,contentType:"application/json",success:function(e){thiz.executingCount--;var d=e.name;thiz.itemCache[c]={};thiz.itemCache[c].name=d;b.itemName=d;thiz.addRow(b)},error:function(e,d){if(e.status!=404&&e.statusText!=="parsererror"){thiz.getItemWeight(c,b)}else{thiz.executingCount--}}})}};Station.prototype.addRow=function(d){var c=d.sellPrice-d.buyPrice;var b=(d.sellPrice-d.buyPrice)/d.sellPrice;b=(b.toFixed(3)*100).toFixed(1)+"%";if(!this.tableCreated){this.createTable()}var a=[d.itemName,numberWithCommas(d.buyPrice.toFixed(2)),numberWithCommas(d.sellPrice.toFixed(2)),numberWithCommas(c.toFixed(2)),b,numberWithCommas(d.volume)];$("#dataTable").dataTable().fnAddData(a)};Station.prototype.createTable=function(){this.tableCreated=true;dt=$("#dataTable").DataTable({order:[[5,"desc"]],lengthMenu:[[-1],["All"]],responsive:true,dom:"Bfrtip",buttons:["copy","csv","excel","pdf","print"]});var a=0;$("#dataTable thead th").each(function(e){var c=dt.column(e).header();var g=document.createElement("button");var d=[];g.innerHTML=c.innerHTML;$(g).addClass("colvistoggle");$(g).addClass("btn");$(g).addClass("btn-default");$(g).attr("colidx",e);$(g).addClass("is-true");var f=dt.column($(g).attr("colidx"));f.visible(true);for(var e=0;e<d.length;e++){if(g.innerHTML===d[e]){$(g).addClass("is-false");var f=dt.column($(g).attr("colidx"));f.visible(false);break}}$(g).on("click",function(i){i.preventDefault();var h=dt.column($(this).attr("colidx"));$(this).removeClass("is-"+h.visible());h.visible(!h.visible());$(this).addClass("is-"+h.visible())});var b=document.createElement("li");$(b).append($(g));$("#colvis").append($(b))});$("#show-hide").show();$(".dropdown").on("show.bs.dropdown",function(b){$(this).find(".dropdown-menu").first().stop(true,true).slideDown()});$(".dropdown").on("hide.bs.dropdown",function(b){$(this).find(".dropdown-menu").first().stop(true,true).slideUp()});$("#dataTable tbody").on("mousedown","tr",function(b){if(b.which===1){if(!$(this).hasClass("row-selected")){$(this).addClass("row-selected")}else{$(this).removeClass("row-selected")}}});$("label > input").addClass("form-control").addClass("minor-text");$("label > input").attr("placeholder","Search Results...");$(".loading").hide();$("#dataTable").show();$(".data_options").append($("#dataTable_filter"));$(".data_options").append($(".dt-buttons"));$(".dt-button").addClass("btn");$(".dt-button").addClass("btn-default");$("#core").css("display","block")};