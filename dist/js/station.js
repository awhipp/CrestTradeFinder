function Station(e){this.stationLocation=e,this.allOrders={},this.allOrders.completePages=[],this.allOrders.complete=!1,this.allOrders.pageBookend=PAGE_MULTIPLE,this.itemCache={},this.itemIds=[],this.secondsToRefresh=60,this.filtered=!1,this.completed=!1,this.filterCount=0,this.asyncChecker=null,this.asyncCalculator=null,this.asyncFilter=null,this.asyncRefresher=null,routes.push(this)}Station.prototype.className=function(){return"Station"},Station.prototype.startStation=function(){var e,t=parseInt(this.stationLocation.region),o=parseInt(this.stationLocation.station);for(e=1;e<=PAGE_MULTIPLE;e++)this.getOrders(t,o,e,this.allOrders,ALL_ORDER);$("#selection").hide(),this.asyncCheck()},Station.prototype.asyncCheck=function(){var e=this;this.asyncChecker=setInterval(function(){e.executeOrders()},1e3)},Station.prototype.recalculateProgress=function(){var e=this.getNumberOfCompletePages(this.allOrders);return e<=0?1:35*Math.log10(e)},Station.prototype.getOrders=function(a,n,s,l,c){var e=marketEndpointBuilder(a,s,c),h=this;l.completePages[s]||$.ajax({type:"get",url:e,dataType:"json",contentType:"application/json",async:!0,success:function(e){if(incrementProgress(l,s),0!==e.length||l.complete){for(var t=0;t<e.length;t++)if(e[t].location_id===n){var o=e[t].type_id;l[o]||(l[o]=[]),l[o].push(e[t])}if(!l.complete&&h.getNumberOfCompletePages(l)===l.pageBookend){var r=s+1;l.pageBookend=l.pageBookend+PAGE_MULTIPLE;for(var i=l.pageBookend;r<=i;r++)h.getOrders(a,n,r,l,c)}}else l.complete=!0,console.log("Completed "+n+" order fetch at "+s),h.completed=!0},error:function(){if(displayError(),incrementProgress(l,s),!l.complete&&h.getNumberOfCompletePages(l)===l.pageBookend){var e=s+1;l.pageBookend=l.pageBookend+PAGE_MULTIPLE;for(var t=l.pageBookend;e<=t;e++)h.getOrders(a,n,e,l,c)}}})},Station.prototype.getNumberOfCompletePages=function(e){for(var t=0,o=0;o<e.completePages.length;o++)e.completePages[o]&&t++;return t},Station.prototype.checkOrdersComplete=function(){var e=this.getNumberOfCompletePages(this.allOrders)===this.allOrders.pageBookend,t=this.allOrders.complete&&this.completed;return e&&t},Station.prototype.executeOrders=function(){if(this.checkOrdersComplete()){for(itemId in clearInterval(this.asyncChecker),hideError(),this.allOrders)"completePages"!==itemId&&"complete"!==itemId&&"pageBookend"!==itemId&&this.itemIds.push(itemId);this.asyncCalculate()}},Station.prototype.clear=function(){this.stationLocation=null,this.allOrders={},this.allOrders.completePages=[],this.allOrders.complete=!1,this.allOrders.pageBookend=PAGE_MULTIPLE,this.itemCache={},this.itemIds=[],this.secondsToRefresh=60,this.filtered=!1,this.filterCount=0,this.completed=!1,clearInterval(this.asyncChecker),clearInterval(this.asyncCalculator),clearInterval(this.asyncFilter),clearInterval(this.asyncRefresher)},Station.prototype.asyncRefresh=function(){var e=this;this.asyncRefresher=setInterval(function(){e.secondsToRefresh<=0?(clearInterval(e.asyncRefresher),$("#refresh-timer").remove(),$("#buyingFooter").append('<div id="refresh-button"><input type="button" class="btn btn-default" onclick="refresh()" value="Refresh Table with Last Query"/></div>')):(rowAdded?$(".loading").hide():$(".loading").text("No trades found for your filters."),$(".tableLoadingIcon").hide(),$("#refresh-timer").html("<p>Refresh allowed in: "+e.secondsToRefresh+" seconds."),e.secondsToRefresh--)},1e3)},Station.prototype.asyncCalculate=function(){var t=this;this.asyncCalculator=setInterval(function(){for(t.filtered||(t.filtered=!0,$("#buyingFooter").append("<div id='filtering-data'>Filtering Results. Please wait.</br>If it takes too long try a smaller margin range.</div>"),t.asyncFiltering());0!=t.itemIds.length&&executingCount<1500;){executingCount++;var e=t.itemIds.splice(0,1)[0];t.calculateNext(e)}0==t.itemIds.length&&executingCount<=0&&(clearInterval(t.asyncCalculator),$(".tableLoadingIcon").hide(),rowAdded&&$(".loading").hide(),$("#buyingFooter").append('<div id="refresh-timer"></div>'),t.asyncRefresh())},1e3)},Station.prototype.calculateNext=function(e){var t=getMarketData(this.allOrders[e],this.stationLocation.station,SELL_ORDER,e,!1);if(0<t.length){var o=!1;if(this.allOrders[e]){var r=getMarketData(this.allOrders[e],this.stationLocation.station,BUY_ORDER,e,!1);0<r.length&&(o=!0,this.getItemInfo(e,t,r))}o||executingCount--}else executingCount--},Station.prototype.getItemInfo=function(e,t,o){for(var r=o[0][0],i=t[0][0],a=0;a<t.length;a++)for(var n=0;n<o.length;n++)o[n][0]>i&&(i=o[n][0]),t[a][0]<r&&(r=t[a][0]);var s={},l=((o=i)-(t=r))/o;100*l>=threshold_margin_lower&&100*l<=threshold_margin_upper&&1e3<o-t?(s.buyPrice=t,s.sellPrice=o,s.itemId=e,this.getItemVolume(e,s)):executingCount--},Station.prototype.asyncFiltering=function(){var o=this;this.asyncFilter=setInterval(function(){o.filterCount+=1;for(var e="",t=0;t<o.filterCount%5;t++)e+=".";$("#filtering-data").html("Filtering Results. Please wait"+e+"</br>If it takes too long try a smaller margin range."),0==executingCount&&(clearInterval(o.asyncFilter),$("#filtering-data").remove())},250)},Station.prototype.getItemVolume=function(o,r){var e=getVolumeEndpointBuilder(this.stationLocation.region,o),i=this;$.ajax({type:"get",url:e,dataType:"json",async:!0,cache:!1,contentType:"application/json",success:function(e){if(e&&e[e.length-1]&&e[e.length-1].volume){r.volume=e[e.length-1].volume,r.volume14=0,r.volume30=0;for(var t=1;t<31;t++)e[e.length-t]&&e[e.length-t].volume&&(t<15&&(r.volume14+=e[e.length-t].volume),r.volume30+=e[e.length-t].volume);r.volume14=parseInt(r.volume14/14),r.volume30=parseInt(r.volume30/30),r.volume14>=volume_threshold?i.getItemWeight(o,r):executingCount--}else executingCount--},error:function(e){404!=e.status&&"parsererror"!==e.statusText?i.getItemVolume(o,r):executingCount--}})},Station.prototype.getItemWeight=function(o,r){if(this.itemCache[o])r.itemName=this.itemCache[o].name,this.addRow(r),executingCount--;else{var i=this,e=getWeightEndpointBuilder(o);$.ajax({type:"get",url:e,dataType:"json",async:!0,cache:!1,contentType:"application/json",success:function(e){executingCount--;var t=e.name;i.itemCache[o]={},i.itemCache[o].name=t,r.itemName=t,i.addRow(r)},error:function(e){404!=e.status&&"parsererror"!==e.statusText?i.getItemWeight(o,r):executingCount--}})}},Station.prototype.addRow=function(e){var t=e.sellPrice-e.buyPrice,o=(e.sellPrice-e.buyPrice)/e.sellPrice;o=(100*o.toFixed(3)).toFixed(1)+"%",createDataTable();var r=[e.itemName,numberWithCommas(e.buyPrice.toFixed(2)),numberWithCommas(e.sellPrice.toFixed(2)),numberWithCommas(t.toFixed(2)),o,numberWithCommas(e.volume),numberWithCommas(e.volume14),numberWithCommas(e.volume30)];$("#dataTable").dataTable().fnAddData(r),rowAdded=!0};