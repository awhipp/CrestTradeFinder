var SECOND_DELAY=0;var PROFIT_INDEX=6;var UPDATING_TIMEOUT=25000;var UPDATING_CHECK=[];var length;var stations=[];var created=false;var dt;var station_buy,stations;function getData(c,b,a,d){if(typeof(c)=="string"){return[c]}else{if(c!=null){return getPrice(c,b,a,d)}}}function goAgain(){if(routeTrading){getRowsRoute()}else{getRowsStation()}}function beginRoute(a,b){station_buy=a;stations=b;$("#selection").hide();getRowsRoute()}function getRandomInt(b,a){b=Math.ceil(b);a=Math.floor(a);return Math.floor(Math.random()*(a-b))+b}function getRowsRoute(){$("#percent-complete").text("Items Checked: "+(init_itemIds-itemIds.length)+" of "+init_itemIds);var b;var a=getRandomInt(6,26);for(b=0;b<itemIds.length&&b<a;b++){var c=itemIds[b];getBuyPrice(c,false)}length=itemIds[b-1];if(b>=itemIds.length){$("#stop").val("Finished");$("#stop").prop("disabled",true);itemIds=[];$(".loading").html("No Deals were found for these stations.<br>Try different search parameters.")}itemIds=itemIds.splice(a,itemIds.length)}function getBuyPrice(e,d){var b=ENDPOINT+"/market/"+station_buy[0]+"/orders/sell/";var c="?type="+ENDPOINT+"/inventory/types/"+e+"/";try{$.ajax({type:"get",url:b+c,dataType:"json",contentType:"application/json",success:function(g){var f=getData(g,station_buy[1],"sell",e);if(f.length>0&&(f[0][0]>0||f[1][0]>0||f[2][0]>0)){var j=g.items[0].type.name;for(var h=0;h<stations.length;h++){getSellPrice(e,f,j,stations[h],d)}}else{if(e===length){goAgain()}}},error:function(g,f){unreachable()}})}catch(a){getBuyPrice(e,d)}}function getSellPrice(h,b,f,d,e){if(d!=null){var g=ENDPOINT+"/market/"+d[0]+"/orders/buy/";var c="?type="+ENDPOINT+"/inventory/types/"+h+"/";try{$.ajax({type:"get",url:g+c,dataType:"json",contentType:"application/json",success:function(j){var i=getData(j,d[1],"buy",h);if(i.length>0&&(i[0][0]>0||i[1][0]>0||i[2][0]>0)){getItemName(h,b,f,i,d,e)}else{if(h===length){goAgain()}}},error:function(j,i){unreachable()}})}catch(a){getSellPrice(h,b,f,d,e)}}else{if(h===length){goAgain()}}}function getItemName(e,a,h,d,f,k){var l=[];for(var c=0;c<a.length;c++){for(var b=0;b<d.length;b++){var g=calculateRow(e,h,a[c][0],a[c][1],d[b][0],d[b][1],f,k);if(g.length>0){l.push(g)}}}l=l.sort(rowComparator);for(var c=0;c<l.length&&c<NUMBER_RETURNED;c++){addRow(l[c][0],l[c][1],l[c][2],l[c][3],l[c][4],l[c][5],l[c][6],l[c][7],l[c][8],l[c][9],l[c][10])}if(e===length){goAgain()}}function rowComparator(d,c){if(d[PROFIT_INDEX]<c[PROFIT_INDEX]){return 1}if(d[PROFIT_INDEX]>c[PROFIT_INDEX]){return -1}return 0}function calculateRow(g,m,h,e,l,f,j,n){if(h<l&&l>0){var d=l-h;var a;var b;var c;if(e>=f){c=numberWithCommas(e.toFixed())+"-<span class='selected_volume'>"+numberWithCommas(f.toFixed())+"</span>";a=f*d;b=h*f}else{c="<span class='selected_volume'>"+numberWithCommas(e.toFixed())+"</span>-"+numberWithCommas(f.toFixed());a=e*d;b=h*e}var i=getLocation(j[0]);var k=(l-h)/h;return[g,m,h,c,b,i,a,k,l,d,n]}return[]}function getLocation(a){return(a===JITA[0]?"Jita":a===AMARR[0]?"Amarr":a===DODIXIE[0]?"Dodixie":a===RENS[0]?"Rens":a===HEK[0]?"Hek":customEnd.split(" ")[0])}function checkRow(a){var b=UPDATING_CHECK[UPDATING_CHECK.length-1];if($("#"+b).hasClass("updating")){$("#"+b).remove()}}function addRow(j,q,d,g,c,l,a,m,h,e,p){var b=j+"-"+l;if(a>=threshold_profit&&(m.toFixed(3)*100).toFixed(1)>=threshold_roi&&c<=threshold_cost){if(!created){created=true;dt=$("#dataTable").DataTable({order:[[PROFIT_INDEX,"desc"]],lengthMenu:[[-1],["All"]]});var k=0;$("#dataTable thead th").each(function(u){var s=dt.column(u).header();var w=document.createElement("button");var t=[];if($(document).width()<768){t=["Total Cost","R.O.I.","Sell Price","Profit Per Item"]}w.innerHTML=s.innerHTML;$(w).addClass("colvistoggle");$(w).addClass("btn");$(w).addClass("btn-default");$(w).attr("colidx",u);$(w).addClass("is-true");var v=dt.column($(w).attr("colidx"));v.visible(true);for(var u=0;u<t.length;u++){if(w.innerHTML===t[u]){$(w).addClass("is-false");var v=dt.column($(w).attr("colidx"));v.visible(false);break}}$(w).on("click",function(y){y.preventDefault();var x=dt.column($(this).attr("colidx"));$(this).removeClass("is-"+x.visible());x.visible(!x.visible());$(this).addClass("is-"+x.visible())});var r=document.createElement("li");$(r).append($(w));$("#colvis").append($(r))});$("#show-hide").show();$(".dropdown").on("show.bs.dropdown",function(r){$(this).find(".dropdown-menu").first().stop(true,true).slideDown()});$(".dropdown").on("hide.bs.dropdown",function(r){$(this).find(".dropdown-menu").first().stop(true,true).slideUp()});$("#dataTable tbody").on("mousedown","tr",function(s){if(s.which===1){if(s.ctrlKey){var r=$(this).attr("id").split("-")[0]+"-"+$(this).attr("id").split("-")[1];if(!$(this).hasClass("row-selected")){$.each($("."+r),function(){$(this).addClass("row-selected")})}else{$.each($("."+r),function(){$(this).removeClass("row-selected")})}}else{if(s.shiftKey){open_popup($(this).attr("id").split("-")[0],$(this).children()[0].textContent,$(this).attr("id").split("-")[1])}else{if(!$(this).hasClass("row-selected")){$(this).addClass("row-selected")}else{$(this).removeClass("row-selected")}}}}else{if(s.which===3){var r=$(this).attr("id").split("-")[0]+"-"+$(this).attr("id").split("-")[1];if(document.getElementsByClassName(b)){var t=$("."+r);$.each(t,function(){$(this).addClass("updating");window.setTimeout(function(){UPDATING_CHECK.push($(this).attr("id"));checkRow()},UPDATING_TIMEOUT)})}getBuyPrice($(this).attr("id").split("-")[0],true)}}});$("label > input").addClass("form-control").addClass("minor-text");$("label > input").attr("placeholder","Search Results...");$(".loading").hide();$("#dataTable").show()}var f=[q,numberWithCommas(d.toFixed(2)),numberWithCommas(c.toFixed(2)),g.split("-")[0],l,g.split("-")[1],numberWithCommas(a.toFixed(2)),(m.toFixed(3)*100).toFixed(1)+"%",numberWithCommas(h.toFixed(2)),numberWithCommas(e.toFixed(2))];if(p&&document.getElementsByClassName(b).length>0){var o=$("."+b);var n=false;$.each(o,function(){if(!n&&$(this).hasClass("updating")){n=true;var r=0;$.each($(this).children(),function(){$(this).html(f[r]);r++});$(this).removeClass("updating")}})}else{var i=$("#dataTable").dataTable().fnAddData(f);var o=$("#dataTable").dataTable().fnGetNodes(i);$(o).attr("id",b+"-"+$("."+b).length);$(o).addClass(b)}}}function buyComparator(d,c){if(d[0]<c[0]){return -1}if(d[0]>c[0]){return 1}return 0}function sellComparator(d,c){if(d[0]<c[0]){return 1}if(d[0]>c[0]){return -1}return 0}function getPrice(h,c,j,i){var g=[];var k=[];var d=h.items;for(var a=0;a<d.length;a++){var b=d[a];if(c==b.location["id"]){var f=b.price;var e=b.volume;g.push([f,e])}}if(j=="sell"){saveBuyData(c,i,$.extend(true,[],g));g=g.sort(buyComparator);if(g.length>NUMBER_RETURNED-1){return g.splice(0,NUMBER_RETURNED)}else{return g}}else{saveSellData(c,i,$.extend(true,[],g));g=g.sort(sellComparator);if(g.length>NUMBER_RETURNED-1){return g.splice(0,NUMBER_RETURNED)}else{return g}}}function saveBuyData(b,c,a){if(b==JITA[1]){jitaBuy[c]=a}else{if(b==AMARR[1]){amarrBuy[c]=a}else{if(b==RENS[1]){rensBuy[c]=a}else{if(b==DODIXIE[1]){dodixieBuy[c]=a}else{if(b==HEK[1]){hekBuy[c]=a}else{customBuy[c]=a}}}}}}function saveSellData(b,c,a){if(b==JITA[1]){jitaSell[c]=a}else{if(b==AMARR[1]){amarrSell[c]=a}else{if(b==RENS[1]){rensSell[c]=a}else{if(b==DODIXIE[1]){dodixieSell[c]=a}else{if(b==HEK[1]){hekSell[c]=a}else{customSell[c]=a}}}}}};