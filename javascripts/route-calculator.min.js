var SECOND_DELAY=0;var PROFIT_INDEX=6;var JUMPS=75;var UPDATING_TIMEOUT=25000;var UPDATING_CHECK=[];var length;var stations=[];var created=false;var dt;var station_buy,stations;function getData(e,d,b,g){var a=[];var f;if(typeof(e)=="string"){f=[e]}else{if(e!=null){f=getPrice(e,d,b,g)}}for(var c=0;c<f.length;c++){if(f[c][0]>0){a.push(f[c])}}return a}function goAgain(){if(routeTrading){getRowsRoute()}else{getRowsStation()}}function beginRoute(a,b){station_buy=a;stations=b;$("#selection").hide();getRowsRoute()}function getRandomInt(b,a){b=Math.ceil(b);a=Math.floor(a);return Math.floor(Math.random()*(a-b))+b}function getRowsRoute(){$("#percent-complete").text("Items Checked: "+(init_itemIds-itemIds.length)+" of "+init_itemIds);var a;JUMPS=getRandomInt(6,26);for(a=0;a<itemIds.length&&a<JUMPS;a++){getBuyPrice(itemIds[a],false)}length=itemIds[a-1];if(a>=itemIds.length){$("#stop").val("Finished");$("#stop").prop("disabled",true);itemIds=[];$(".loading").html("No Deals were found for these stations.<br>Try different search parameters.")}itemIds=itemIds.splice(JUMPS,itemIds.length)}function getBuyPrice(e,d){var b=ENDPOINT+"/market/"+station_buy[0]+"/orders/sell/";var c="?type="+ENDPOINT+"/inventory/types/"+e+"/";try{$.ajax({type:"get",url:b+c,dataType:"json",contentType:"application/json",success:function(g){var f=getData(g,station_buy[1],"sell",e);if(f.length>0){var j=g.items[0].type.name;for(var h=0;h<stations.length;h++){getSellPrice(e,f,j,stations[h],d)}}else{if(e===length){goAgain()}}},error:function(g,f){unreachable(e,length)}})}catch(a){getBuyPrice(e,d)}}function getSellPrice(h,b,f,d,e){if(d!=null){var g=ENDPOINT+"/market/"+d[0]+"/orders/buy/";var c="?type="+ENDPOINT+"/inventory/types/"+h+"/";try{$.ajax({type:"get",url:g+c,dataType:"json",contentType:"application/json",success:function(j){var i=getData(j,d[1],"buy",h);if(i.length>0){getItemName(h,b,f,i,d,e)}else{if(h===length){goAgain()}}},error:function(j,i){unreachable(h,length)}})}catch(a){getSellPrice(h,b,f,d,e)}}else{if(h===length){goAgain()}}}function getItemName(e,a,h,d,f,k){if(e===length){goAgain()}var l=[];for(var c=0;c<a.length;c++){for(var b=0;b<d.length;b++){var g=calculateRow(e,h,a[c][0],a[c][1],d[b][0],d[b][1],f,k);if(g.length>0){l.push(g)}}}l=l.sort(rowComparator);for(var c=0;c<l.length&&c<NUMBER_RETURNED;c++){addRow(l[c][0],l[c][1],l[c][2],l[c][3],l[c][4],l[c][5],l[c][6],l[c][7],l[c][8],l[c][9],l[c][10],l[c][11])}}function rowComparator(d,c){if(d[PROFIT_INDEX]<c[PROFIT_INDEX]){return 1}if(d[PROFIT_INDEX]>c[PROFIT_INDEX]){return -1}return 0}function calculateRow(g,m,h,e,l,f,j,n){if(h<l&&l>0){var d=l-h;var a;var b;var c;if(e>=f){c=numberWithCommas(e.toFixed())+"-<span class='selected_volume'>"+numberWithCommas(f.toFixed())+"</span>";a=f*d;b=h*f}else{c="<span class='selected_volume'>"+numberWithCommas(e.toFixed())+"</span>-"+numberWithCommas(f.toFixed());a=e*d;b=h*e}var i=getLocation(j[1]);var k=(l-h)/h;return[g,m,h,c,b,i,a,k,l,d,n,j]}return[]}function getLocation(a){if(isCustom){return getCustomEnd(a)}else{return(a===JITA[1]?"Jita":a===AMARR[1]?"Amarr":a===DODIXIE[1]?"Dodixie":a===RENS[1]?"Rens":a===HEK[1]?"Hek":getCustomEnd(a))}}function getCustomEnd(a){for(var b=0;b<stations.length;b++){if(a===stations[b][1]){return customEnd[b]}}return"nil"}function checkRow(a){var b=UPDATING_CHECK[UPDATING_CHECK.length-1];if($("#"+b).hasClass("updating")){$("#"+b).remove()}}function addRow(k,o,c,q,d,a,f,n,r,g,p,i){var m=k+"_"+a+"_"+i[1];if(f>=threshold_profit&&(n.toFixed(3)*100).toFixed(1)>=threshold_roi&&d<=threshold_cost){if(!created){created=true;dt=$("#dataTable").DataTable({order:[[PROFIT_INDEX,"desc"]],lengthMenu:[[-1],["All"]]});var b=0;$("#dataTable thead th").each(function(v){var t=dt.column(v).header();var x=document.createElement("button");var u=[];if($(document).width()<768){u=["Total Cost","R.O.I.","Sell Price","Profit Per Item"]}x.innerHTML=t.innerHTML;$(x).addClass("colvistoggle");$(x).addClass("btn");$(x).addClass("btn-default");$(x).attr("colidx",v);$(x).addClass("is-true");var w=dt.column($(x).attr("colidx"));w.visible(true);for(var v=0;v<u.length;v++){if(x.innerHTML===u[v]){$(x).addClass("is-false");var w=dt.column($(x).attr("colidx"));w.visible(false);break}}$(x).on("click",function(z){z.preventDefault();var y=dt.column($(this).attr("colidx"));$(this).removeClass("is-"+y.visible());y.visible(!y.visible());$(this).addClass("is-"+y.visible())});var s=document.createElement("li");$(s).append($(x));$("#colvis").append($(s))});$("#show-hide").show();$(".dropdown").on("show.bs.dropdown",function(s){$(this).find(".dropdown-menu").first().stop(true,true).slideDown()});$(".dropdown").on("hide.bs.dropdown",function(s){$(this).find(".dropdown-menu").first().stop(true,true).slideUp()});$("#dataTable tbody").on("mousedown","tr",function(t){if(t.which===1){if(t.ctrlKey){var s=$(this).attr("id").split("_")[0]+"_"+$(this).attr("id").split("_")[1]+"_"+$(this).attr("id").split("_")[2];if(!$(this).hasClass("row-selected")){$.each($("."+s),function(){$(this).addClass("row-selected")})}else{$.each($("."+s),function(){$(this).removeClass("row-selected")})}}else{if(t.shiftKey){open_popup($(this).attr("id").split("_")[0],$(this).children()[0].textContent,$(this).attr("id").split("_")[1],parseInt($(this).attr("id").split("_")[2]))}else{if(!$(this).hasClass("row-selected")){$(this).addClass("row-selected")}else{$(this).removeClass("row-selected")}}}}else{if(t.which===3){var s=$(this).attr("id").split("_")[0]+"_"+$(this).attr("id").split("_")[1]+"_"+$(this).attr("id").split("_")[2];if(document.getElementsByClassName(m)){var u=$("."+s);$.each(u,function(){$(this).addClass("updating");window.setTimeout(function(){UPDATING_CHECK.push($(this).attr("id"));checkRow()},UPDATING_TIMEOUT)})}getBuyPrice($(this).attr("id").split("_")[0],true)}}});$("label > input").addClass("form-control").addClass("minor-text");$("label > input").attr("placeholder","Search Results...");$(".loading").hide();$("#dataTable").show()}var j=[o,numberWithCommas(c.toFixed(2)),numberWithCommas(d.toFixed(2)),q.split("-")[0],a,q.split("-")[1],numberWithCommas(f.toFixed(2)),(n.toFixed(3)*100).toFixed(1)+"%",numberWithCommas(r.toFixed(2)),numberWithCommas(g.toFixed(2))];if(p&&document.getElementsByClassName(m).length>0){var e=$("."+m);var l=false;$.each(e,function(){if(!l&&$(this).hasClass("updating")){l=true;var s=0;$.each($(this).children(),function(){$(this).html(j[s]);s++});$(this).removeClass("updating")}})}else{var h=$("#dataTable").dataTable().fnAddData(j);var e=$("#dataTable").dataTable().fnGetNodes(h);$(e).attr("id",m+"_"+$("."+m).length);$(e).addClass(m)}}}function buyComparator(d,c){if(d[0]<c[0]){return -1}if(d[0]>c[0]){return 1}return 0}function sellComparator(d,c){if(d[0]<c[0]){return 1}if(d[0]>c[0]){return -1}return 0}function getPrice(h,c,j,i){var g=[];var k=[];var d=h.items;for(var a=0;a<d.length;a++){var b=d[a];if(c==b.location["id"]){var f=b.price;var e=b.volume;g.push([f,e])}}if(j=="sell"){saveBuyData(c,i,$.extend(true,[],g));g=g.sort(buyComparator);if(g.length>NUMBER_RETURNED-1){return g.splice(0,NUMBER_RETURNED)}else{return g}}else{saveSellData(c,i,$.extend(true,[],g));g=g.sort(sellComparator);if(g.length>NUMBER_RETURNED-1){return g.splice(0,NUMBER_RETURNED)}else{return g}}}function saveBuyData(b,c,a){if(customBuy[b]){customBuy[b][c]=a}else{customBuy[b]=[];customBuy[b][c]=a}}function saveSellData(b,c,a){if(customSell[b]){customSell[b][c]=a}else{customSell[b]=[];customSell[b][c]=a}};