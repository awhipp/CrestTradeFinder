var SECOND_DELAY=0;var PROFIT_INDEX=6;var JUMPS=75;var UPDATING_TIMEOUT=25000;var UPDATING_CHECK=[];var length;var stations=[];var created=false;var dt;var station_buy,stations;function getData(e,d,b,g){var a=[];var f;if(typeof(e)=="string"){f=[e]}else{if(e!=null){f=getPrice(e,d,b,g)}}for(var c=0;c<f.length;c++){if(f[c][0]>0){a.push(f[c])}}return a}function goAgain(){if(routeTrading){getRowsRoute()}else{getRowsStation()}}function beginRoute(a,b){station_buy=a;stations=b;$("#selection").hide();getRowsRoute()}function getRandomInt(b,a){b=Math.ceil(b);a=Math.floor(a);return Math.floor(Math.random()*(a-b))+b}function getRowsRoute(){$("#percent-complete").text("Items Checked: "+(init_itemIds-itemIds.length)+" of "+init_itemIds);var a;JUMPS=getRandomInt(6,26);for(a=0;a<itemIds.length&&a<JUMPS;a++){getBuyPrice(itemIds[a],false)}length=itemIds[a-1];if(a>=itemIds.length){$("#stop").val("Finished");$("#stop").prop("disabled",true);itemIds=[];$(".loading").html("No Deals were found for these stations.<br>Try different search parameters.")}itemIds=itemIds.splice(JUMPS,itemIds.length)}function getBuyPrice(e,d){var b=ENDPOINT+"/market/"+station_buy[0]+"/orders/sell/";var c="?type="+ENDPOINT+"/inventory/types/"+e+"/";try{$.ajax({type:"get",url:b+c,dataType:"json",contentType:"application/json",success:function(g){var f=getData(g,station_buy[1],"sell",e);if(f.length>0){var j=g.items[0].type.name;for(var h=0;h<stations.length;h++){getSellPrice(e,f,j,stations[h],d)}}else{if(e===length){goAgain()}}},error:function(g,f){unreachable(e,length)}})}catch(a){getBuyPrice(e,d)}}function getSellPrice(h,b,f,d,e){if(d!=null){var g=ENDPOINT+"/market/"+d[0]+"/orders/buy/";var c="?type="+ENDPOINT+"/inventory/types/"+h+"/";try{$.ajax({type:"get",url:g+c,dataType:"json",contentType:"application/json",success:function(j){var i=getData(j,d[1],"buy",h);if(i.length>0){getItemName(h,b,f,i,d,e)}else{if(h===length){goAgain()}}},error:function(j,i){unreachable(h,length)}})}catch(a){getSellPrice(h,b,f,d,e)}}else{if(h===length){goAgain()}}}function getItemName(e,a,h,d,f,k){if(e===length){goAgain()}var l=[];for(var c=0;c<a.length;c++){for(var b=0;b<d.length;b++){var g=calculateRow(e,h,a[c][0],a[c][1],d[b][0],d[b][1],f,k);if(g.length>0){l.push(g)}}}l=l.sort(rowComparator);for(var c=0;c<l.length&&c<NUMBER_RETURNED;c++){if(requestItemWeight){getItemWeight(e,l[c])}else{addRow(l[c][0],l[c][1],l[c][2],l[c][3],l[c][4],l[c][5],l[c][6],l[c][7],l[c][8],l[c][9],l[c][10],l[c][11])}}}function getItemWeight(d,c){var b=ENDPOINT+"/inventory/types/"+d+"/";try{$.ajax({type:"get",url:b,dataType:"json",contentType:"application/json",success:function(e){addRow(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],e.volume)},error:function(f,e){getItemWeight(d)}})}catch(a){getItemWeight(d)}}function rowComparator(d,c){if(d[PROFIT_INDEX]<c[PROFIT_INDEX]){return 1}if(d[PROFIT_INDEX]>c[PROFIT_INDEX]){return -1}return 0}function calculateRow(g,m,h,e,l,f,j,n){if(h<l&&l>0){var d=l-h;var a;var b;var c;if(e>=f){c=numberWithCommas(e.toFixed())+"-<span class='selected_volume'>"+numberWithCommas(f.toFixed())+"</span>";a=f*d;b=h*f}else{c="<span class='selected_volume'>"+numberWithCommas(e.toFixed())+"</span>-"+numberWithCommas(f.toFixed());a=e*d;b=h*e}var i=getLocation(j[1]);var k=(l-h)/h;return[g,m,h,c,b,i,a,k,l,d,n,j]}return[]}function getLocation(a){if(isCustom){return getCustomEnd(a)}else{return(a===JITA[1]?"Jita":a===AMARR[1]?"Amarr":a===DODIXIE[1]?"Dodixie":a===RENS[1]?"Rens":a===HEK[1]?"Hek":getCustomEnd(a))}}function getCustomEnd(a){for(var b=0;b<stations.length;b++){if(a===stations[b][1]){return customEnd[b]}}return"nil"}function checkRow(a){var b=UPDATING_CHECK[UPDATING_CHECK.length-1];if($("#"+b).hasClass("updating")){$("#"+b).remove()}}function addRow(n,t,d,v,e,c,g,r,x,h,u,m,w){var p=n+"_"+c+"_"+m[1];if(w){var s=v.split("-")[0];var q=v.split("-")[1];var b;if(s.indexOf("span")>=0){b=s}else{b=q}var l=b.substring(b.indexOf(">")+1,b.indexOf("</"));var j=l.replace(",","");while(j.indexOf(",")>=0){j=j.replace(",","")}w=w*parseFloat(j)}else{w=0}if(g>=threshold_profit&&(r.toFixed(3)*100).toFixed(1)>=threshold_roi&&e<=threshold_cost&&w<=threshold_weight){if(!created){created=true;dt=$("#dataTable").DataTable({order:[[PROFIT_INDEX,"desc"]],lengthMenu:[[-1],["All"]]});var a=0;$("#dataTable thead th").each(function(B){var z=dt.column(B).header();var D=document.createElement("button");var A=[];if($(document).width()<768){A=["Total Cost","R.O.I.","Sell Price","Profit Per Item"]}D.innerHTML=z.innerHTML;$(D).addClass("colvistoggle");$(D).addClass("btn");$(D).addClass("btn-default");$(D).attr("colidx",B);$(D).addClass("is-true");var C=dt.column($(D).attr("colidx"));C.visible(true);for(var B=0;B<A.length;B++){if(D.innerHTML===A[B]){$(D).addClass("is-false");var C=dt.column($(D).attr("colidx"));C.visible(false);break}}$(D).on("click",function(F){F.preventDefault();var E=dt.column($(this).attr("colidx"));$(this).removeClass("is-"+E.visible());E.visible(!E.visible());$(this).addClass("is-"+E.visible())});var y=document.createElement("li");$(y).append($(D));$("#colvis").append($(y))});$("#show-hide").show();$(".dropdown").on("show.bs.dropdown",function(y){$(this).find(".dropdown-menu").first().stop(true,true).slideDown()});$(".dropdown").on("hide.bs.dropdown",function(y){$(this).find(".dropdown-menu").first().stop(true,true).slideUp()});$("#dataTable tbody").on("mousedown","tr",function(z){if(z.which===1){if(z.ctrlKey){var y=$(this).attr("id").split("_")[0]+"_"+$(this).attr("id").split("_")[1]+"_"+$(this).attr("id").split("_")[2];if(!$(this).hasClass("row-selected")){$.each($("."+y),function(){$(this).addClass("row-selected")})}else{$.each($("."+y),function(){$(this).removeClass("row-selected")})}}else{if(z.shiftKey){open_popup($(this).attr("id").split("_")[0],$(this).children()[0].textContent,$(this).attr("id").split("_")[1],parseInt($(this).attr("id").split("_")[2]))}else{if(!$(this).hasClass("row-selected")){$(this).addClass("row-selected")}else{$(this).removeClass("row-selected")}}}}else{if(z.which===3){var y=$(this).attr("id").split("_")[0]+"_"+$(this).attr("id").split("_")[1]+"_"+$(this).attr("id").split("_")[2];if(document.getElementsByClassName(p)){var A=$("."+y);$.each(A,function(){$(this).addClass("updating");window.setTimeout(function(){UPDATING_CHECK.push($(this).attr("id"));checkRow()},UPDATING_TIMEOUT)})}getBuyPrice($(this).attr("id").split("_")[0],true)}}});$("label > input").addClass("form-control").addClass("minor-text");$("label > input").attr("placeholder","Search Results...");$(".loading").hide();$("#dataTable").show()}var k;if(requestItemWeight){k=[t,numberWithCommas(d.toFixed(2)),numberWithCommas(e.toFixed(2)),v.split("-")[0],c,v.split("-")[1],numberWithCommas(g.toFixed(2)),(r.toFixed(3)*100).toFixed(1)+"%",numberWithCommas(x.toFixed(2)),numberWithCommas(h.toFixed(2)),numberWithCommas(w.toFixed(2))]}else{k=[t,numberWithCommas(d.toFixed(2)),numberWithCommas(e.toFixed(2)),v.split("-")[0],c,v.split("-")[1],numberWithCommas(g.toFixed(2)),(r.toFixed(3)*100).toFixed(1)+"%",numberWithCommas(x.toFixed(2)),numberWithCommas(h.toFixed(2))]}if(u&&document.getElementsByClassName(p).length>0){var f=$("."+p);var o=false;$.each(f,function(){if(!o&&$(this).hasClass("updating")){o=true;var y=0;$.each($(this).children(),function(){$(this).html(k[y]);y++});$(this).removeClass("updating")}})}else{var i=$("#dataTable").dataTable().fnAddData(k);var f=$("#dataTable").dataTable().fnGetNodes(i);$(f).attr("id",p+"_"+$("."+p).length);$(f).addClass(p)}}}function buyComparator(d,c){if(d[0]<c[0]){return -1}if(d[0]>c[0]){return 1}return 0}function sellComparator(d,c){if(d[0]<c[0]){return 1}if(d[0]>c[0]){return -1}return 0}function getPrice(h,c,j,i){var g=[];var k=[];var d=h.items;for(var a=0;a<d.length;a++){var b=d[a];if(c==b.location["id"]){var f=b.price;var e=b.volume;g.push([f,e])}}if(j=="sell"){saveBuyData(c,i,$.extend(true,[],g));g=g.sort(buyComparator);if(g.length>NUMBER_RETURNED-1){return g.splice(0,NUMBER_RETURNED)}else{return g}}else{saveSellData(c,i,$.extend(true,[],g));g=g.sort(sellComparator);if(g.length>NUMBER_RETURNED-1){return g.splice(0,NUMBER_RETURNED)}else{return g}}}function saveBuyData(b,c,a){if(customBuy[b]){customBuy[b][c]=a}else{customBuy[b]=[];customBuy[b][c]=a}}function saveSellData(b,c,a){if(customSell[b]){customSell[b][c]=a}else{customSell[b]=[];customSell[b][c]=a}};