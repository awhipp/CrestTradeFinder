function numberWithCommas(e){for(;/(\d+)(\d{3})/.test(e.toString());)e=e.toString().replace(/(\d+)(\d{3})/,"$1,$2");return e}function getData(e,t,a,s){return"string"==typeof e?[e]:null!=e?getPrice(e,t,a,s):void 0}function goAgain(){$(".more").val("Loading..."),$(".more").prop("disabled",!0),getRows()}function begin(e,t,a,s,l,i){itemIds=$.extend(!0,[],e),station_buy=t,station_sell1=a,station_sell2=s,station_sell3=l,station_sell4=i,getRows()}function getRows(){$("#selection").hide();var e;for(e=0;e<itemIds.length&&JUMPS>e;e++){var t=itemIds[e];getBuyPrice(t,!1),length=itemIds[e]}e>=itemIds.length&&($(".more").val("Finished"),$(".more").prop("disabled",!0),itemIds=[]),itemIds=itemIds.splice(JUMPS,itemIds.length),itemIds.length==originalIds.length-JUMPS&&(itemIds=shuffle(itemIds))}function getBuyPrice(e,t){var a="https://public-crest.eveonline.com/market/"+station_buy[0]+"/orders/sell/",s="?type=https://public-crest.eveonline.com/types/"+e+"/";try{$.get(a+s,function(a){var s=getData(a,station_buy[1],"sell",e);if(s.length>0&&(s[0][0]>0||s[1][0]>0||s[2][0]>0)){var l=a.items[0].type.name;getSellPrice1(e,s,l,t)}else e===length&&window.setTimeout(goAgain(),SECOND_DELAY)})}catch(l){getBuyPrice(e,t)}}function getSellPrice1(e,t,a,s){if(-1!==station_sell1[0]){var l="https://public-crest.eveonline.com/market/"+station_sell1[0]+"/orders/buy/",i="?type=https://public-crest.eveonline.com/types/"+e+"/";try{$.get(l+i,function(l){var i=getData(l,station_sell1[1],"buy",e);getSellPrice2(e,t,a,i,s)})}catch(o){getSellPrice1(e,t,a,s)}}else getSellPrice2(e,t,a,-1,s)}function getSellPrice2(e,t,a,s,l){if(-1!==station_sell2[0]){var i="https://public-crest.eveonline.com/market/"+station_sell2[0]+"/orders/buy/",o="?type=https://public-crest.eveonline.com/types/"+e+"/";try{$.get(i+o,function(i){var o=getData(i,station_sell2[1],"buy",e);getSellPrice3(e,t,a,s,o,l)})}catch(n){getSellPrice2(e,t,a,s,l)}}else getSellPrice3(e,t,a,s,-1,l)}function getSellPrice3(e,t,a,s,l,i){if(-1!==station_sell3[0]){var o="https://public-crest.eveonline.com/market/"+station_sell3[0]+"/orders/buy/",n="?type=https://public-crest.eveonline.com/types/"+e+"/";try{$.get(o+n,function(o){var n=getData(o,station_sell3[1],"buy",e);getSellPrice4(e,t,a,s,l,n,i)})}catch(r){getSellPrice3(e,t,a,s,l,i)}}else getSellPrice4(e,t,a,s,l,-1,i)}function getSellPrice4(e,t,a,s,l,i,o){if(-1!==station_sell4[0]){var n="https://public-crest.eveonline.com/market/"+station_sell4[0]+"/orders/buy/",r="?type=https://public-crest.eveonline.com/types/"+e+"/";try{$.get(n+r,function(n){var r=getData(n,station_sell4[1],"buy",e);getItemName(e,t,a,s,l,i,r,o)})}catch(c){getSellPrice4(e,t,a,s,l,i,o)}}else getItemName(e,t,a,s,l,i,-1,o)}function rowComparator(e,t){return e[PROFIT_INDEX]<t[PROFIT_INDEX]?-1:e[PROFIT_INDEX]>t[PROFIT_INDEX]?1:0}function getItemName(e,t,a,s,l,i,o,n){for(var r=[],c=0;c<t.length;c++)for(var d=t[c][1],u=t[c][0],h=0;h<s.length;h++){var m=s[h][1],g=s[h][0],p=calculateRow(e,a,u,d,g,m,station_sell1,n);p.length>0&&r.push(p)}for(var c=0;c<t.length;c++)for(var d=t[c][1],u=t[c][0],h=0;h<l.length;h++){var m=l[h][1],g=l[h][0],p=calculateRow(e,a,u,d,g,m,station_sell2,n);p.length>0&&r.push(p)}for(var c=0;c<t.length;c++)for(var d=t[c][1],u=t[c][0],h=0;h<i.length;h++){var m=i[h][1],g=i[h][0],p=calculateRow(e,a,u,d,g,m,station_sell3,n);p.length>0&&r.push(p)}for(var c=0;c<t.length;c++)for(var d=t[c][1],u=t[c][0],h=0;h<o.length;h++){var m=o[h][1],g=o[h][0],p=calculateRow(e,a,u,d,g,m,station_sell4,n);p.length>0&&r.push(p)}r=r.sort(rowComparator);for(var c=0;c<r.length&&c<NUMBER_RETURNED;c++)addRow(r[c][0],r[c][1],r[c][2],r[c][3],r[c][4],r[c][5],r[c][6],r[c][7],r[c][8],r[c][9],r[c][10]);e===length&&window.setTimeout(goAgain(),SECOND_DELAY)}function calculateRow(e,t,a,s,l,i,o,n){if(l>a&&l>0){var r,c,d,u=l-a;s>=i?(d=numberWithCommas(s.toFixed())+"-<span class='selected_volume'>"+numberWithCommas(i.toFixed())+"</span>",r=i*u,c=a*i):(d="<span class='selected_volume'>"+numberWithCommas(s.toFixed())+"</span>-"+numberWithCommas(i.toFixed()),r=s*u,c=a*s);var h=getLocation(o[0]),m=(l-a)/a;return[e,t,a,d,c,h,r,m,l,u,n]}return[]}function getLocation(e){return e===JITA[0]?"Jita":e===AMARR[0]?"Amarr":e===DODIXIE[0]?"Dodixie":e===RENS[0]?"Rens":"Hek"}function checkRow(e){var t=UPDATING_CHECK[UPDATING_CHECK.length-1];$("#"+t).hasClass("updating")&&$("#"+t).remove()}function addRow(e,t,a,s,l,i,o,n,r,c,d){var u=e+"-"+i;created||(created=!0,dt=$("#dataTable").DataTable({order:[[PROFIT_INDEX,"desc"]],lengthMenu:[[-1],["All"]]}),$("#dataTable tbody").on("mousedown","tr",function(e){if(1===e.which)if(e.ctrlKey||e.shiftKey){var t=$(this).attr("id").split("-")[0]+"-"+$(this).attr("id").split("-")[1];$(this).hasClass("row-selected")?$.each($("."+t),function(){$(this).removeClass("row-selected")}):$.each($("."+t),function(){$(this).addClass("row-selected")})}else $(this).hasClass("row-selected")?$(this).removeClass("row-selected"):$(this).addClass("row-selected");else if(3===e.which){var t=$(this).attr("id").split("-")[0]+"-"+$(this).attr("id").split("-")[1];if(document.getElementsByClassName(u)){var a=$("."+t);$.each(a,function(){$(this).addClass("updating"),window.setTimeout(function(){UPDATING_CHECK.push($(this).attr("id")),checkRow()},UPDATING_TIMEOUT)})}getBuyPrice($(this).attr("id").split("-")[0],!0)}}),$(".more").show(),$(".dataTables_length").remove(),$(".dataTables_paginate").remove(),$("label > input").addClass("form-control").addClass("minor-text"),$("label > input").attr("placeholder","Search Results..."),$("#dataTable").show());var h=[t,numberWithCommas(a.toFixed(2)),numberWithCommas(l.toFixed(2)),s.split("-")[0],i,s.split("-")[1],numberWithCommas(o.toFixed(2)),(100*n.toFixed(3)).toFixed(1)+"%",numberWithCommas(r.toFixed(2)),numberWithCommas(c.toFixed(2))];if(d&&document.getElementsByClassName(u).length>0){var m=$("."+u),g=!1;$.each(m,function(){if(!g&&$(this).hasClass("updating")){g=!0;var e=0;$.each($(this).children(),function(){$(this).html(h[e]),e++}),$(this).removeClass("updating")}})}else{var p=$("#dataTable").dataTable().fnAddData(h),m=$("#dataTable").dataTable().fnGetNodes(p);$(m).attr("id",u+"-"+$("."+u).length),$(m).addClass(u)}}function buyComparator(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}function sellComparator(e,t){return e[0]<t[0]?1:e[0]>t[0]?-1:0}function getPrice(e,t,a,s){for(var l=[],i=e.items,o=0;o<i.length;o++){var n=i[o];if(t==n.location.id){var r=n.price,c=n.volume;l.push([r,c])}}return"sell"==a?(l=l.sort(buyComparator),l.length>NUMBER_RETURNED-1?l.splice(0,NUMBER_RETURNED):l):(l=l.sort(sellComparator),l.length>NUMBER_RETURNED-1?l.splice(0,NUMBER_RETURNED):l)}var JUMPS=75,SECOND_DELAY=900,PROFIT_INDEX=6,UPDATING_TIMEOUT=25e3,UPDATING_CHECK=[],length,created=!1,dt,itemIds,station_buy,station_sell1,station_sell2,station_sell3,station_sell4;