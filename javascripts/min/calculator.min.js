function numberWithCommas(e){for(;/(\d+)(\d{3})/.test(e.toString());)e=e.toString().replace(/(\d+)(\d{3})/,"$1,$2");return e}function getData(e,t,a,l){return"string"==typeof e?[e]:null!=e?getPrice(e,t,a,l):void 0}function goAgain(){$(".more").val("Loading..."),$(".more").prop("disabled",!0),getRows()}function begin(e,t,a,l,s,n){itemIds=$.extend(!0,[],e),station_buy=t,station_sell1=a,station_sell2=l,station_sell3=s,station_sell4=n,getRows()}function getRows(){$("#selection").hide();var e;for(e=0;e<itemIds.length&&JUMPS>e;e++){var t=itemIds[e];getBuyPrice(t,!1),length=itemIds[e]}e>=itemIds.length&&($(".more").val("Finished"),$(".more").prop("disabled",!0),itemIds=[]),itemIds=itemIds.splice(JUMPS,itemIds.length),itemIds.length==originalIds.length-JUMPS&&(itemIds=shuffle(itemIds))}function getBuyPrice(e,t){var a="https://public-crest.eveonline.com/market/"+station_buy[0]+"/orders/sell/",l="?type=https://public-crest.eveonline.com/types/"+e+"/";try{$.get(a+l,function(a){var l=getData(a,station_buy[1],"sell",e);if(l.length>0&&(l[0][0]>0||l[1][0]>0||l[2][0]>0)){var s=a.items[0].type.name;getSellPrice1(e,l,s,t)}else e===length&&window.setTimeout(goAgain(),SECOND_DELAY)})}catch(s){getBuyPrice(e,t)}}function getSellPrice1(e,t,a,l){if(-1!==station_sell1[0]){var s="https://public-crest.eveonline.com/market/"+station_sell1[0]+"/orders/buy/",n="?type=https://public-crest.eveonline.com/types/"+e+"/";try{$.get(s+n,function(s){var n=getData(s,station_sell1[1],"buy",e);getSellPrice2(e,t,a,n,l)})}catch(r){getSellPrice1(e,t,a,l)}}else getSellPrice2(e,t,a,-1,l)}function getSellPrice2(e,t,a,l,s){if(-1!==station_sell2[0]){var n="https://public-crest.eveonline.com/market/"+station_sell2[0]+"/orders/buy/",r="?type=https://public-crest.eveonline.com/types/"+e+"/";try{$.get(n+r,function(n){var r=getData(n,station_sell2[1],"buy",e);getSellPrice3(e,t,a,l,r,s)})}catch(i){getSellPrice2(e,t,a,l,s)}}else getSellPrice3(e,t,a,l,-1,s)}function getSellPrice3(e,t,a,l,s,n){if(-1!==station_sell3[0]){var r="https://public-crest.eveonline.com/market/"+station_sell3[0]+"/orders/buy/",i="?type=https://public-crest.eveonline.com/types/"+e+"/";try{$.get(r+i,function(r){var i=getData(r,station_sell3[1],"buy",e);getSellPrice4(e,t,a,l,s,i,n)})}catch(o){getSellPrice3(e,t,a,l,s,n)}}else getSellPrice4(e,t,a,l,s,-1,n)}function getSellPrice4(e,t,a,l,s,n,r){if(-1!==station_sell4[0]){var i="https://public-crest.eveonline.com/market/"+station_sell4[0]+"/orders/buy/",o="?type=https://public-crest.eveonline.com/types/"+e+"/";try{$.get(i+o,function(i){var o=getData(i,station_sell4[1],"buy",e);getItemName(e,t,a,l,s,n,o,r)})}catch(c){getSellPrice4(e,t,a,l,s,n,r)}}else getItemName(e,t,a,l,s,n,-1,r)}function rowComparator(e,t){return e[PROFIT_INDEX]<t[PROFIT_INDEX]?-1:e[PROFIT_INDEX]>t[PROFIT_INDEX]?1:0}function getItemName(e,t,a,l,s,n,r,i){for(var o=[],c=0;c<t.length;c++)for(var u=t[c][1],m=t[c][0],d=0;d<l.length;d++){var h=l[d][1],g=l[d][0],p=calculateRow(e,a,m,u,g,h,station_sell1,i);p.length>0&&o.push(p)}for(var c=0;c<t.length;c++)for(var u=t[c][1],m=t[c][0],d=0;d<s.length;d++){var h=s[d][1],g=s[d][0],p=calculateRow(e,a,m,u,g,h,station_sell2,i);p.length>0&&o.push(p)}for(var c=0;c<t.length;c++)for(var u=t[c][1],m=t[c][0],d=0;d<n.length;d++){var h=n[d][1],g=n[d][0],p=calculateRow(e,a,m,u,g,h,station_sell3,i);p.length>0&&o.push(p)}for(var c=0;c<t.length;c++)for(var u=t[c][1],m=t[c][0],d=0;d<r.length;d++){var h=r[d][1],g=r[d][0],p=calculateRow(e,a,m,u,g,h,station_sell4,i);p.length>0&&o.push(p)}o=o.sort(rowComparator);for(var c=0;c<o.length&&c<NUMBER_RETURNED;c++)addRow(o[c][0],o[c][1],o[c][2],o[c][3],o[c][4],o[c][5],o[c][6],o[c][7],o[c][8],o[c][9],o[c][10]);e===length&&window.setTimeout(goAgain(),SECOND_DELAY)}function calculateRow(e,t,a,l,s,n,r,i){if(s>a&&s>0){var o,c,u,m=s-a;l>=n?(u=numberWithCommas(l.toFixed())+"-<span class='selected_volume'>"+numberWithCommas(n.toFixed())+"</span>",o=n*m,c=s*n):(u="<span class='selected_volume'>"+numberWithCommas(l.toFixed())+"</span>-"+numberWithCommas(n.toFixed()),o=l*m,c=a*l);var d=getLocation(r[0]),h=(s-a)/a;return[e,t,a,u,c,d,o,h,s,m,i]}return[]}function getLocation(e){return e===JITA[0]?"Jita":e===AMARR[0]?"Amarr":e===DODIXIE[0]?"Dodixie":e===RENS[0]?"Rens":"Hek"}function addRow(e,t,a,l,s,n,r,i,o,c,u){var m=e+"-"+n;created||(created=!0,dt=$("#dataTable").DataTable({order:[[PROFIT_INDEX,"desc"]],lengthMenu:[[-1],["All"]]}),$("#dataTable tbody").on("mousedown","tr",function(e){if(1===e.which)e.ctrlKey?$(this).hasClass("row-selected")?$.each($("."+$(this).attr("value")),function(){$(this).removeClass("row-selected")}):$.each($("."+$(this).attr("value")),function(){$(this).addClass("row-selected")}):$(this).hasClass("row-selected")?$(this).removeClass("row-selected"):$(this).addClass("row-selected");else if(3===e.which){var t=$(this).attr("value").split("-");if(document.getElementsByClassName(t)){var a=$("."+$(this).attr("value"));$.each(a,function(){var e=$(this).children()[0];e.textContent=e.textContent+" (updating)"})}return getBuyPrice(t[0],!0),!1}}),$(".more").show(),$(".dataTables_length").remove(),$(".dataTables_paginate").remove(),$(".dataTables_filter > label").css("color","white"),$("label > input").addClass("form-control").addClass("minor-text"),$("label > input").attr("placeholder","Search Results...").css("width","300px"),$(".dataTables_info").css("width","100%"),$("#dataTable").show());var d=[t,numberWithCommas(a.toFixed(2)),numberWithCommas(s.toFixed(2)),l.split("-")[0],n,l.split("-")[1],numberWithCommas(r.toFixed(2)),(100*i.toFixed(3)).toFixed(1)+"%",numberWithCommas(o.toFixed(2)),numberWithCommas(c.toFixed(2))];if(u&&document.getElementsByClassName(m).length>0){var h=$("."+m);$.each(h,function(){var e=0;$.each($(this).children(),function(){$(this).html(d[e]),e++})})}else{var g=$("#dataTable").dataTable().fnAddData(d),h=$("#dataTable").dataTable().fnGetNodes(g);$(h).attr("value",m),$(h).addClass(m)}}function buyComparator(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}function sellComparator(e,t){return e[0]<t[0]?1:e[0]>t[0]?-1:0}function getPrice(e,t,a,l){for(var s=[],n=e.items,r=0;r<n.length;r++){var i=n[r];if(t==i.location.id){var o=i.price,c=i.volume;s.push([o,c])}}return"sell"==a?(s=s.sort(buyComparator),s.length>NUMBER_RETURNED-1?s.splice(0,NUMBER_RETURNED):s):(s=s.sort(sellComparator),s.length>NUMBER_RETURNED-1?s.splice(0,NUMBER_RETURNED):s)}var JUMPS=75,SECOND_DELAY=900,PROFIT_INDEX=6,length,created=!1,dt,itemIds,station_buy,station_sell1,station_sell2,station_sell3,station_sell4;jQuery.extend(jQuery.fn.dataTableExt.oSort,{"numeric-comma-pre":function(e){var t="-"==e?0:e.replace(/,/,".").replace("/(/","").replace("/)/","");return parseFloat(t)},"numeric-comma-asc":function(e,t){return t>e?-1:e>t?1:0},"numeric-comma-desc":function(e,t){return t>e?1:e>t?-1:0}});