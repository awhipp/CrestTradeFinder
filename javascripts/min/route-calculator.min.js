var JUMPS=75;var SECOND_DELAY=900;var PROFIT_INDEX=6;var UPDATING_TIMEOUT=25000;var UPDATING_CHECK=[];var length;var created=false;var dt;var station_buy,station_sell1,station_sell2,station_sell3,station_sell4;function numberWithCommas(a){while(/(\d+)(\d{3})/.test(a.toString())){a=a.toString().replace(/(\d+)(\d{3})/,"$1,$2")}return a}function getData(c,b,a,d){if(typeof(c)=="string"){return[c]}else{if(c!=null){return getPrice(c,b,a,d)}}}function goAgain(){if(routeTrading){getRowsRoute()}else{getRowsStation()}}function beginRoute(b,a,e,d,c){station_buy=b;station_sell1=a;station_sell2=e;station_sell3=d;station_sell4=c;getRowsRoute()}function getRowsRoute(){$("#selection").hide();var a;for(a=0;a<itemIds.length&&a<JUMPS;a++){var b=itemIds[a];getBuyPrice(b,false);length=itemIds[a]}if(a>=itemIds.length){$("#stop").val("Finished");$("#stop").prop("disabled",true);itemIds=[]}itemIds=itemIds.splice(JUMPS,itemIds.length)}function getBuyPrice(e,d){var b=ENDPOINT+"/market/"+station_buy[0]+"/orders/sell/";var c="?type="+ENDPOINT+"/types/"+e+"/";try{$.ajax({type:"get",url:b+c,success:function(g){var f=getData(g,station_buy[1],"sell",e);if(f.length>0&&(f[0][0]>0||f[1][0]>0||f[2][0]>0)){var h=g.items[0].type.name;getSellPrice1(e,f,h,d)}else{if(e===length){window.setTimeout(goAgain(),SECOND_DELAY)}}},error:function(g,f){unreachable()}})}catch(a){getBuyPrice(e,d)}}function getSellPrice1(g,c,f,e){if(station_sell1[0]!==-1){var d=ENDPOINT+"/market/"+station_sell1[0]+"/orders/buy/";var b="?type="+ENDPOINT+"/types/"+g+"/";try{$.ajax({type:"get",url:d+b,success:function(h){var i=getData(h,station_sell1[1],"buy",g);getSellPrice2(g,c,f,i,e)},error:function(i,h){unreachable()}})}catch(a){getSellPrice1(g,c,f,e)}}else{getSellPrice2(g,c,f,-1,e)}}function getSellPrice2(g,b,f,c,e){if(station_sell2[0]!==-1){var d=ENDPOINT+"/market/"+station_sell2[0]+"/orders/buy/";var h="?type="+ENDPOINT+"/types/"+g+"/";try{$.ajax({type:"get",url:d+h,success:function(i){var j=getData(i,station_sell2[1],"buy",g);getSellPrice3(g,b,f,c,j,e)},error:function(j,i){unreachable()}})}catch(a){getSellPrice2(g,b,f,c,e)}}else{getSellPrice3(g,b,f,c,-1,e)}}function getSellPrice3(f,b,h,d,c,i){if(station_sell3[0]!==-1){var e=ENDPOINT+"/market/"+station_sell3[0]+"/orders/buy/";var g="?type="+ENDPOINT+"/types/"+f+"/";try{$.ajax({type:"get",url:e+g,success:function(k){var j=getData(k,station_sell3[1],"buy",f);getSellPrice4(f,b,h,d,c,j,i)},error:function(k,j){unreachable()}})}catch(a){getSellPrice3(f,b,h,d,c,i)}}else{getSellPrice4(f,b,h,d,c,-1,i)}}function getSellPrice4(g,b,i,e,d,c,j){if(station_sell4[0]!==-1){var f=ENDPOINT+"/market/"+station_sell4[0]+"/orders/buy/";var h="?type="+ENDPOINT+"/types/"+g+"/";try{$.ajax({type:"get",url:f+h,success:function(l){var k=getData(l,station_sell4[1],"buy",g);getItemName(g,b,i,e,d,c,k,j)},error:function(l,k){unreachable()}})}catch(a){getSellPrice4(g,b,i,e,d,c,j)}}else{getItemName(g,b,i,e,d,c,-1,j)}}function rowComparator(d,c){if(d[PROFIT_INDEX]<c[PROFIT_INDEX]){return 1}if(d[PROFIT_INDEX]>c[PROFIT_INDEX]){return -1}return 0}function getItemName(h,a,m,g,f,e,c,n){var l=[];for(var d=0;d<a.length;d++){for(var b=0;b<g.length;b++){var k=calculateRow(h,m,a[d][0],a[d][1],g[b][0],g[b][1],station_sell1,n);if(k.length>0){l.push(k)}}}for(var d=0;d<a.length;d++){for(var b=0;b<f.length;b++){var k=calculateRow(h,m,a[d][0],a[d][1],f[b][0],f[b][1],station_sell2,n);if(k.length>0){l.push(k)}}}for(var d=0;d<a.length;d++){for(var b=0;b<e.length;b++){var k=calculateRow(h,m,a[d][0],a[d][1],e[b][0],e[b][1],station_sell3,n);if(k.length>0){l.push(k)}}}for(var d=0;d<a.length;d++){for(var b=0;b<c.length;b++){var k=calculateRow(h,m,a[d][0],a[d][1],c[b][0],c[b][1],station_sell4,n);if(k.length>0){l.push(k)}}}l=l.sort(rowComparator);for(var d=0;d<l.length&&d<NUMBER_RETURNED;d++){addRow(l[d][0],l[d][1],l[d][2],l[d][3],l[d][4],l[d][5],l[d][6],l[d][7],l[d][8],l[d][9],l[d][10])}if(h===length){window.setTimeout(goAgain(),SECOND_DELAY)}}function calculateRow(g,m,h,e,l,f,j,n){if(h<l&&l>0){var d=l-h;var a;var b;var c;if(e>=f){c=numberWithCommas(e.toFixed())+"-<span class='selected_volume'>"+numberWithCommas(f.toFixed())+"</span>";a=f*d;b=h*f}else{c="<span class='selected_volume'>"+numberWithCommas(e.toFixed())+"</span>-"+numberWithCommas(f.toFixed());a=e*d;b=h*e}var i=getLocation(j[0]);var k=(l-h)/h;return[g,m,h,c,b,i,a,k,l,d,n]}return[]}function getLocation(a){return(a===JITA[0]?"Jita":a===AMARR[0]?"Amarr":a===DODIXIE[0]?"Dodixie":a===RENS[0]?"Rens":"Hek")}function checkRow(a){var b=UPDATING_CHECK[UPDATING_CHECK.length-1];if($("#"+b).hasClass("updating")){$("#"+b).remove()}}function addRow(j,q,d,g,c,l,a,m,h,e,p){var b=j+"-"+l;if(!created){created=true;dt=$("#dataTable").DataTable({order:[[PROFIT_INDEX,"desc"]],lengthMenu:[[-1],["All"]]});var k=0;$("#dataTable thead th").each(function(u){var s=dt.column(u).header();var w=document.createElement("button");var t=["Total Cost","R.O.I.","Sell Price","Profit Per Item"];w.innerHTML=s.innerHTML;$(w).addClass("colvistoggle");$(w).addClass("btn");$(w).addClass("btn-default");$(w).attr("colidx",u);$(w).addClass("is-true");var v=dt.column($(w).attr("colidx"));v.visible(true);for(var u=0;u<t.length;u++){if(w.innerHTML===t[u]){$(w).addClass("is-false");var v=dt.column($(w).attr("colidx"));v.visible(false);break}}$(w).on("click",function(y){y.preventDefault();var x=dt.column($(this).attr("colidx"));$(this).removeClass("is-"+x.visible());x.visible(!x.visible());$(this).addClass("is-"+x.visible())});var r=document.createElement("li");$(r).append($(w));$("#colvis").append($(r))});$("#show-hide").show();$(".dropdown").on("show.bs.dropdown",function(r){$(this).find(".dropdown-menu").first().stop(true,true).slideDown()});$(".dropdown").on("hide.bs.dropdown",function(r){$(this).find(".dropdown-menu").first().stop(true,true).slideUp()});$("#dataTable tbody").on("mousedown","tr",function(s){if(s.which===1){if(s.ctrlKey){var r=$(this).attr("id").split("-")[0]+"-"+$(this).attr("id").split("-")[1];if(!$(this).hasClass("row-selected")){$.each($("."+r),function(){$(this).addClass("row-selected")})}else{$.each($("."+r),function(){$(this).removeClass("row-selected")})}}else{if(s.shiftKey){open_popup($(this).attr("id").split("-")[0],$(this).children()[0].textContent,$(this).children()[4].textContent)}else{if(!$(this).hasClass("row-selected")){$(this).addClass("row-selected")}else{$(this).removeClass("row-selected")}}}}else{if(s.which===3){var r=$(this).attr("id").split("-")[0]+"-"+$(this).attr("id").split("-")[1];if(document.getElementsByClassName(b)){var t=$("."+r);$.each(t,function(){$(this).addClass("updating");window.setTimeout(function(){UPDATING_CHECK.push($(this).attr("id"));checkRow()},UPDATING_TIMEOUT)})}getBuyPrice($(this).attr("id").split("-")[0],true)}}});$("label > input").addClass("form-control").addClass("minor-text");$("label > input").attr("placeholder","Search Results...");$(".loading").hide();$("#dataTable").show()}var f=[q,numberWithCommas(d.toFixed(2)),numberWithCommas(c.toFixed(2)),g.split("-")[0],l,g.split("-")[1],numberWithCommas(a.toFixed(2)),(m.toFixed(3)*100).toFixed(1)+"%",numberWithCommas(h.toFixed(2)),numberWithCommas(e.toFixed(2))];if(p&&document.getElementsByClassName(b).length>0){var o=$("."+b);var n=false;$.each(o,function(){if(!n&&$(this).hasClass("updating")){n=true;var r=0;$.each($(this).children(),function(){$(this).html(f[r]);r++});$(this).removeClass("updating")}})}else{var i=$("#dataTable").dataTable().fnAddData(f);var o=$("#dataTable").dataTable().fnGetNodes(i);$(o).attr("id",b+"-"+$("."+b).length);$(o).addClass(b)}}function buyComparator(d,c){if(d[0]<c[0]){return -1}if(d[0]>c[0]){return 1}return 0}function sellComparator(d,c){if(d[0]<c[0]){return 1}if(d[0]>c[0]){return -1}return 0}function getPrice(h,c,j,i){var g=[];var k=[];var d=h.items;for(var a=0;a<d.length;a++){var b=d[a];if(c==b.location["id"]){var f=b.price;var e=b.volume;g.push([f,e])}}if(j=="sell"){saveBuyData(c,i,$.extend(true,[],g));g=g.sort(buyComparator);if(g.length>NUMBER_RETURNED-1){return g.splice(0,NUMBER_RETURNED)}else{return g}}else{saveSellData(c,i,$.extend(true,[],g));g=g.sort(sellComparator);if(g.length>NUMBER_RETURNED-1){return g.splice(0,NUMBER_RETURNED)}else{return g}}}function saveBuyData(b,c,a){if(b==JITA[1]){jitaBuy[c]=a}else{if(b==AMARR[1]){amarrBuy[c]=a}else{if(b==RENS[1]){rensBuy[c]=a}else{if(b==DODIXIE[1]){dodixieBuy[c]=a}else{if(b==HEK[1]){hekBuy[c]=a}}}}}}function saveSellData(b,c,a){if(b==JITA[1]){jitaSell[c]=a}else{if(b==AMARR[1]){amarrSell[c]=a}else{if(b==RENS[1]){rensSell[c]=a}else{if(b==DODIXIE[1]){dodixieSell[c]=a}else{if(b==HEK[1]){hekSell[c]=a}}}}}};