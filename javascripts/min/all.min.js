function numberWithCommas(e){for(;/(\d+)(\d{3})/.test(e.toString());)e=e.toString().replace(/(\d+)(\d{3})/,"$1,$2");return e}function getData(e,t,a,l){return"string"==typeof e?[e]:null!=e?getPrice(e,t,a,l):void 0}function goAgain(){$(".more").val("Loading..."),$(".more").prop("disabled",!0),getRows()}function begin(e,t,a,l,s){station_buy=e,station_sell1=t,station_sell2=a,station_sell3=l,station_sell4=s,getRows()}function getRows(){$("#selection").hide();var e;for(e=0;e<itemIds.length&&JUMPS>e;e++){var t=itemIds[e];getBuyPrice(t,!1),length=itemIds[e]}e>=itemIds.length&&($(".more").val("Finished"),$(".more").prop("disabled",!0),$("#stop").val("Finished"),$("#stop").prop("disabled",!0),itemIds=[]),itemIds=itemIds.splice(JUMPS,itemIds.length)}function getBuyPrice(e,t){var a="https://public-crest.eveonline.com/market/"+station_buy[0]+"/orders/sell/",l="?type=https://public-crest.eveonline.com/types/"+e+"/";try{$.ajax({type:"get",url:a+l,success:function(a){var l=getData(a,station_buy[1],"sell",e);if(l.length>0&&(l[0][0]>0||l[1][0]>0||l[2][0]>0)){var s=a.items[0].type.name;getSellPrice1(e,l,s,t)}else e===length&&window.setTimeout(goAgain(),SECOND_DELAY)},error:function(e,t){unreachable()}})}catch(s){getBuyPrice(e,t)}}function getSellPrice1(e,t,a,l){if(-1!==station_sell1[0]){var s="https://public-crest.eveonline.com/market/"+station_sell1[0]+"/orders/buy/",i="?type=https://public-crest.eveonline.com/types/"+e+"/";try{$.ajax({type:"get",url:s+i,success:function(s){var i=getData(s,station_sell1[1],"buy",e);getSellPrice2(e,t,a,i,l)},error:function(e,t){unreachable()}})}catch(o){getSellPrice1(e,t,a,l)}}else getSellPrice2(e,t,a,-1,l)}function getSellPrice2(e,t,a,l,s){if(-1!==station_sell2[0]){var i="https://public-crest.eveonline.com/market/"+station_sell2[0]+"/orders/buy/",o="?type=https://public-crest.eveonline.com/types/"+e+"/";try{$.ajax({type:"get",url:i+o,success:function(i){var o=getData(i,station_sell2[1],"buy",e);getSellPrice3(e,t,a,l,o,s)},error:function(e,t){unreachable()}})}catch(r){getSellPrice2(e,t,a,l,s)}}else getSellPrice3(e,t,a,l,-1,s)}function getSellPrice3(e,t,a,l,s,i){if(-1!==station_sell3[0]){var o="https://public-crest.eveonline.com/market/"+station_sell3[0]+"/orders/buy/",r="?type=https://public-crest.eveonline.com/types/"+e+"/";try{$.ajax({type:"get",url:o+r,success:function(o){var r=getData(o,station_sell3[1],"buy",e);getSellPrice4(e,t,a,l,s,r,i)},error:function(e,t){unreachable()}})}catch(n){getSellPrice3(e,t,a,l,s,i)}}else getSellPrice4(e,t,a,l,s,-1,i)}function getSellPrice4(e,t,a,l,s,i,o){if(-1!==station_sell4[0]){var r="https://public-crest.eveonline.com/market/"+station_sell4[0]+"/orders/buy/",n="?type=https://public-crest.eveonline.com/types/"+e+"/";try{$.ajax({type:"get",url:r+n,success:function(r){var n=getData(r,station_sell4[1],"buy",e);getItemName(e,t,a,l,s,i,n,o)},error:function(e,t){unreachable()}})}catch(c){getSellPrice4(e,t,a,l,s,i,o)}}else getItemName(e,t,a,l,s,i,-1,o)}function rowComparator(e,t){return e[PROFIT_INDEX]<t[PROFIT_INDEX]?1:e[PROFIT_INDEX]>t[PROFIT_INDEX]?-1:0}function getItemName(e,t,a,l,s,i,o,r){for(var n=[],c=0;c<t.length;c++)for(var u=0;u<l.length;u++){var d=calculateRow(e,a,t[c][0],t[c][1],l[u][0],l[u][1],station_sell1,r);d.length>0&&n.push(d)}for(var c=0;c<t.length;c++)for(var u=0;u<s.length;u++){var d=calculateRow(e,a,t[c][0],t[c][1],s[u][0],s[u][1],station_sell2,r);d.length>0&&n.push(d)}for(var c=0;c<t.length;c++)for(var u=0;u<i.length;u++){var d=calculateRow(e,a,t[c][0],t[c][1],i[u][0],i[u][1],station_sell3,r);d.length>0&&n.push(d)}for(var c=0;c<t.length;c++)for(var u=0;u<o.length;u++){var d=calculateRow(e,a,t[c][0],t[c][1],o[u][0],o[u][1],station_sell4,r);d.length>0&&n.push(d)}n=n.sort(rowComparator);for(var c=0;c<n.length&&NUMBER_RETURNED>c;c++)addRow(n[c][0],n[c][1],n[c][2],n[c][3],n[c][4],n[c][5],n[c][6],n[c][7],n[c][8],n[c][9],n[c][10]);e===length&&window.setTimeout(goAgain(),SECOND_DELAY)}function calculateRow(e,t,a,l,s,i,o,r){if(s>a&&s>0){var n,c,u,d=s-a;l>=i?(u=numberWithCommas(l.toFixed())+"-<span class='selected_volume'>"+numberWithCommas(i.toFixed())+"</span>",n=i*d,c=a*i):(u="<span class='selected_volume'>"+numberWithCommas(l.toFixed())+"</span>-"+numberWithCommas(i.toFixed()),n=l*d,c=a*l);var h=getLocation(o[0]),p=(s-a)/a;return[e,t,a,u,c,h,n,p,s,d,r]}return[]}function getLocation(e){return e===JITA[0]?"Jita":e===AMARR[0]?"Amarr":e===DODIXIE[0]?"Dodixie":e===RENS[0]?"Rens":"Hek"}function checkRow(e){var t=UPDATING_CHECK[UPDATING_CHECK.length-1];$("#"+t).hasClass("updating")&&$("#"+t).remove()}function addRow(e,t,a,l,s,i,o,r,n,c,u){var d=e+"-"+i;created||(created=!0,dt=$("#dataTable").DataTable({order:[[PROFIT_INDEX,"desc"]],lengthMenu:[[-1],["All"]]}),$("#dataTable tbody").on("mousedown","tr",function(e){if(1===e.which)if(e.ctrlKey){var t=$(this).attr("id").split("-")[0]+"-"+$(this).attr("id").split("-")[1];$(this).hasClass("row-selected")?$.each($("."+t),function(){$(this).removeClass("row-selected")}):$.each($("."+t),function(){$(this).addClass("row-selected")})}else e.shiftKey?open_popup($(this).attr("id").split("-")[0],$(this).children()[0].textContent,$(this).children()[4].textContent):$(this).hasClass("row-selected")?$(this).removeClass("row-selected"):$(this).addClass("row-selected");else if(3===e.which){var t=$(this).attr("id").split("-")[0]+"-"+$(this).attr("id").split("-")[1];if(document.getElementsByClassName(d)){var a=$("."+t);$.each(a,function(){$(this).addClass("updating"),window.setTimeout(function(){UPDATING_CHECK.push($(this).attr("id")),checkRow()},UPDATING_TIMEOUT)})}getBuyPrice($(this).attr("id").split("-")[0],!0)}}),$(".more").show(),$("label > input").addClass("form-control").addClass("minor-text"),$("label > input").attr("placeholder","Search Results..."),$("#dataTable").show());var h=[t,numberWithCommas(a.toFixed(2)),numberWithCommas(s.toFixed(2)),l.split("-")[0],i,l.split("-")[1],numberWithCommas(o.toFixed(2)),(100*r.toFixed(3)).toFixed(1)+"%",numberWithCommas(n.toFixed(2)),numberWithCommas(c.toFixed(2))];if(u&&document.getElementsByClassName(d).length>0){var p=$("."+d),m=!1;$.each(p,function(){if(!m&&$(this).hasClass("updating")){m=!0;var e=0;$.each($(this).children(),function(){$(this).html(h[e]),e++}),$(this).removeClass("updating")}})}else{var g=$("#dataTable").dataTable().fnAddData(h),p=$("#dataTable").dataTable().fnGetNodes(g);$(p).attr("id",d+"-"+$("."+d).length),$(p).addClass(d)}}function buyComparator(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}function sellComparator(e,t){return e[0]<t[0]?1:e[0]>t[0]?-1:0}function getPrice(e,t,a,l){for(var s=[],i=e.items,o=0;o<i.length;o++){var r=i[o];if(t==r.location.id){var n=r.price,c=r.volume;s.push([n,c])}}return"sell"==a?(saveBuyData(t,l,$.extend(!0,[],s)),s=s.sort(buyComparator),34==l&&console.log(s),s.length>NUMBER_RETURNED-1?s.splice(0,NUMBER_RETURNED):s):(saveSellData(t,l,$.extend(!0,[],s)),s=s.sort(sellComparator),s.length>NUMBER_RETURNED-1?s.splice(0,NUMBER_RETURNED):s)}function saveBuyData(e,t,a){e==JITA[1]?jitaBuy[t]=a:e==AMARR[1]?amarrBuy[t]=a:e==RENS[1]?rensBuy[t]=a:e==DODIXIE[1]?dodixieBuy[t]=a:e==HEK[1]&&(hekBuy[t]=a)}function saveSellData(e,t,a){e==JITA[1]?jitaSell[t]=a:e==AMARR[1]?amarrSell[t]=a:e==RENS[1]?rensSell[t]=a:e==DODIXIE[1]?dodixieSell[t]=a:e==HEK[1]&&(hekSell[t]=a)}function getMoreItems(){$.ajax({type:"get",url:"https://public-crest.eveonline.com/market/types/?page="+page,success:function(e){if(e&&e.items){for(var t=shuffle(e.items),a=0;a<t.length;a++)itemIds.push(t[a].id);page++,3==page&&($("#loading").hide(),$("#selection").show()),e.next?getMoreItems():3>page&&($("#loading").hide(),$("#selection").show())}},error:function(e,t){unreachable()}})}function updateNumber(){NUMBER_RETURNED=parseInt($("#numberInput").val()),(NUMBER_RETURNED>10||1>NUMBER_RETURNED)&&(NUMBER_RETURNED=1,$("#numberInput").val("1"))}function shuffle(e){for(var t,a,l=e.length;0!==l;)a=Math.floor(Math.random()*l),l-=1,t=e[l],e[l]=e[a],e[a]=t;return e}function open_popup(e,t,a){popup_table_buy.clear(),popup_table_sell.clear(),$("#popup_itemName").text("Trade info for "+t),$("#buyLocation").text("Buy at "+start_location),$("#sellLocation").text("Sell at "+a);var l,s;"Jita"==start_location?l=jitaBuy[e]:"Amarr"==start_location?l=amarrBuy[e]:"Dodixie"==start_location?l=dodixieBuy[e]:"Rens"==start_location?l=rensBuy[e]:"Hek"==start_location&&(l=hekBuy[e]);for(var i=0;i<l.length;i++)l[i]&&$("#popup-table-buy").dataTable().fnAddData([numberWithCommas(l[i][0]),numberWithCommas(l[i][1])]);"Jita"==a?s=jitaSell[e]:"Amarr"==a?s=amarrSell[e]:"Dodixie"==a?s=dodixieSell[e]:"Rens"==a?s=rensSell[e]:"Hek"==a&&(s=hekSell[e]);for(var i=0;i<s.length;i++)s[i]&&$("#popup-table-sell").dataTable().fnAddData([numberWithCommas(s[i][0]),numberWithCommas(s[i][1])]);$("#popup").modal("show"),popup_table_buy.draw(),popup_table_sell.draw()}function unreachable(){itemIds=[],$("#unreachable").is(":hidden")&&($("#unreachable").hide(),$("#unreachable").slideToggle())}function init(){var e=start_location,t=[];$.each($(".end-selected"),function(){t.push($(this).val())});var a=t.indexOf("Jita")>-1?!0:!1,l=t.indexOf("Amarr")>-1?!0:!1,s=t.indexOf("Dodixie")>-1?!0:!1,i=t.indexOf("Rens")>-1?!0:!1,o=t.indexOf("Hek")>-1?!0:!1;if(t.indexOf(start_location)>-1&&1==t.length||0==t.length||""===start_location)return void $("#error").show();$("#error").hide(),$(".more").val("Loading..."),$(".more").show(),$(".scroll").show(),$(".more").prop("disabled",!0),$("#selection").hide(),$("#stop").show();var r,n,c,u,d,a=t.indexOf("Jita")>-1?!0:!1,l=t.indexOf("Amarr")>-1?!0:!1,s=t.indexOf("Dodixie")>-1?!0:!1,i=t.indexOf("Rens")>-1?!0:!1,o=t.indexOf("Hek")>-1?!0:!1;"Jita"===e?(r=JITA,n=l?AMARR:IGNORE,c=s?DODIXIE:IGNORE,u=i?RENS:IGNORE,d=o?HEK:IGNORE):"Amarr"===e?(r=AMARR,n=a?JITA:IGNORE,c=s?DODIXIE:IGNORE,u=i?RENS:IGNORE,d=o?HEK:IGNORE):"Dodixie"===e?(r=DODIXIE,n=l?AMARR:IGNORE,c=a?JITA:IGNORE,u=i?RENS:IGNORE,d=o?HEK:IGNORE):"Rens"===e?(r=RENS,n=l?AMARR:IGNORE,c=s?DODIXIE:IGNORE,u=a?JITA:IGNORE,d=o?HEK:IGNORE):(r=HEK,n=l?AMARR:IGNORE,c=s?DODIXIE:IGNORE,u=i?RENS:IGNORE,d=a?JITA:IGNORE),$("#dataTable").append("<thead><tr><th>Item</th><th>Buy Price</th><th>Total Cost</th><th>Buy Quantity</th><th>Sell At</th><th>Sell Quantity</th><th>Total Profit</th><th>R.O.I.</th><th>Sell Price</th><th>Profit Per Item</th></tr></thead>"),$("#dataTable thead:last").after("<tbody id='tableBody'></tbody>"),$("#buyingHeader").text("Buying from "+e);var h="";a&&"Jita"!==e&&(h+="Jita, "),l&&"Amarr"!==e&&(h+="Amarr, "),s&&"Dodixie"!==e&&(h+="Dodixie, "),i&&"Rens"!==e&&(h+="Rens, "),o&&"Hek"!==e&&(h+="Hek, "),h.length>0&&(h="( routes to "+h.substring(0,h.length-2)+" )"),$("#buyingFooter").html(h+"<br/>*Profit is not guaranteed. <span class='avoidwrap'>Use at your own risk. <span class='avoidwrap'>Verify in game that prices are accurate.</span></span>"),$("#buyingFooter").show(),$("#buyingHeader").show(),begin(r,n,c,u,d)}var JUMPS=75,SECOND_DELAY=900,PROFIT_INDEX=6,UPDATING_TIMEOUT=25e3,UPDATING_CHECK=[],length,created=!1,dt,station_buy,station_sell1,station_sell2,station_sell3,station_sell4,JITA=[10000002,60003760],AMARR=[10000043,60008494],DODIXIE=[10000032,60011866],RENS=[10000030,60004588],HEK=[10000042,60005686],IGNORE=[-1,-1],NUMBER_RETURNED=3,itemIds=[],jitaBuy=[],jitaSell=[],amarrBuy=[],amarrSell=[],dodixieBuy=[],dodixieSell=[],rensBuy=[],rensSell=[],hekBuy=[],hekSell=[],start_location="",popup_table_buy,popup_table_sell,IGNORE_STRING,page=1,curr;$(document).ready(function(){$("#loading").show(),$("#selection").hide(),popup_table_buy=$("#popup-table-buy").DataTable({order:[[0,"asc"]],lengthMenu:[[5],["5"]]}),popup_table_sell=$("#popup-table-sell").DataTable({order:[[0,"desc"]],lengthMenu:[[5],["5"]]}),getMoreItems(),$(".start").on("click",function(){start_location=$(this).val(),$(".start").removeClass("start-selected"),$(this).addClass("start-selected"),"Jita"==start_location?$("#add_jita").removeClass("end-selected"):"","Amarr"==start_location?$("#add_amarr").removeClass("end-selected"):"","Dodixie"==start_location?$("#add_dodixie").removeClass("end-selected"):"","Rens"==start_location?$("#add_rens").removeClass("end-selected"):"","Hek"==start_location?$("#add_hek").removeClass("end-selected"):""}),$(".end").on("click",function(){$(this).hasClass("end-selected")?$(this).removeClass("end-selected"):$(this).addClass("end-selected")}),$("#numberInput").on("blur",updateNumber)});