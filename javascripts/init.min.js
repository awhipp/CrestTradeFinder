var JITA=[10000002,60003760];var AMARR=[10000043,60008494];var DODIXIE=[10000032,60011866];var RENS=[10000030,60004588];var HEK=[10000042,60005686];var IGNORE=null;var NUMBER_RETURNED=3;var threshold_margin_lower=30;var threshold_margin_upper=45;var threshold_profit=100000;var threshold_roi=1;var threshold_cost=1000000000000000000;var threshold_weight=1000000000000000000;var itemIds=[];var customBuy=[];var customSell=[];var start_location="";var isCustom=false;var customStart;var customEnd;var popup_table_buy;var popup_table_sell;var routeTrading=null;var init_itemIds=0;var page=1;var has_shown=false;var curr;var requestItemWeight=true;var stations_checked=0;var ENDPOINT="https://crest-tq.eveonline.com";function numberWithCommas(a){while(/(\d+)(\d{3})/.test(a.toString())){a=a.toString().replace(/(\d+)(\d{3})/,"$1,$2")}return a}function showAbout(){if(routeTrading==null){$("#howto").slideToggle()}else{if(routeTrading){$("#howto-route").slideToggle()}else{$("#howto-station").slideToggle()}}}function getMoreItems(){var a=false;$.ajax({type:"get",dataType:"json",url:ENDPOINT+"/market/types/",success:function(c){for(var b=1;b<=c.pageCount;b++){$.ajax({type:"get",dataType:"json",url:ENDPOINT+"/market/types/?page="+b,success:function(f){if(f&&f.items){if(!f.next){$("#loading").hide();$("#selection").show()}var d=shuffle(f.items);init_itemIds=init_itemIds+d.length;for(var e=0;e<d.length;e++){itemIds.push(d[e].id)}}},error:function(e,d){}})}},error:function(c,b){}})}function setup(a){routeTrading=a;$(".howto").toggle(false);if(routeTrading==true){$("#initial_choice").hide();$("#route_trade").slideToggle()}else{$("#initial_choice").hide();$("#station_trade").slideToggle()}}$(document).ready(function(){$("#loading").show();$("#selection").hide();popup_table_buy=$("#popup-table-buy").DataTable({order:[[0,"asc"]],lengthMenu:[[10],["10"]]});popup_table_sell=$("#popup-table-sell").DataTable({order:[[0,"desc"]],lengthMenu:[[10],["10"]]});getMoreItems();$(".start").on("click",function(){start_location=$(this).val();$(".start").removeClass("start-selected");$(this).addClass("start-selected");start_location=="Jita"?$("#add_jita").removeClass("end-selected"):"";start_location=="Amarr"?$("#add_amarr").removeClass("end-selected"):"";start_location=="Dodixie"?$("#add_dodixie").removeClass("end-selected"):"";start_location=="Rens"?$("#add_rens").removeClass("end-selected"):"";start_location=="Hek"?$("#add_hek").removeClass("end-selected"):""});$(".end").on("click",function(){if($(this).hasClass("end-selected")){$(this).removeClass("end-selected")}else{$(this).addClass("end-selected")}});$(".station-start").on("click",function(){$(".station-start").removeClass("station-selected");$(this).addClass("station-selected")});$("#numberInput").on("blur",updateNumber);$("#custom_route").on("click",function(){$(".standard").slideToggle();$(".custom").slideToggle();if($(this).val()==="Enable Custom Route (BETA)"){$(this).val("Disable Custom Route");isCustom=true}else{$(this).val("Enable Custom Route (BETA)");isCustom=false}});$("#custom_select").on("click",function(){$(".standard").slideToggle();$(".custom").slideToggle();if($(this).val()==="Enable Custom Selection (BETA)"){$(this).val("Disable Custom Selection");isCustom=true}else{$(this).val("Enable Custom Selection (BETA)");isCustom=false}});for(var a=0;a<station_ids.length;a++){$("#custom_route_start").append("<option value="+[station_ids[a][1],station_ids[a][0]]+">"+station_ids[a][2]+"</option>");$("#custom_route_end").append('<li><input id="end-'+a+'" class="end-selection" type="checkbox" value='+[station_ids[a][1],station_ids[a][0]]+'><label for="end-'+a+'">'+station_ids[a][2]+"</label></li>");$("#custom_station").append("<option value="+[station_ids[a][1],station_ids[a][0]]+">"+station_ids[a][2]+"</option>")}$(".end-selection").on("click",function(){stations_checked=$(".end-selection:checked").length;if(stations_checked>10){$(this).prop("checked",false);stations_checked=$(".end-selection:checked").length}$("#stations_remaining").text(10-stations_checked)});$("#custom_route_start").change(function(){start_location=$("#custom_route_start option[value='"+$("#custom_route_start").val()+"']").text()});$("#custom_station").change(function(){start_location=$("#custom_station option[value='"+$("#custom_station").val()+"']").text()});if($("#numberInput").val().length>0){NUMBER_RETURNED=parseInt($("#numberInput").val())}$("#numberInput").val(getCookie("numberInput"));$("#lower-margin-threshold").val(getCookie("lower-margin-threshold"));$("#upper-margin-threshold").val(getCookie("upper-margin-threshold"));$("#profit-threshold").val(getCookie("profit-threshold"));$("#roi-threshold").val(getCookie("roi-threshold"));$("#buy-threshold").val(getCookie("buy-threshold"));$("#weight-threshold").val(getCookie("weight-threshold"))});function updateNumber(){NUMBER_RETURNED=parseInt($("#numberInput").val());if(NUMBER_RETURNED>10||NUMBER_RETURNED<1){NUMBER_RETURNED=1;$("#numberInput").val("1");setCookie("numberInput",numberInput)}}function shuffle(d){var c=d.length,b,a;while(0!==c){a=Math.floor(Math.random()*c);c-=1;b=d[c];d[c]=d[a];d[a]=b}return d}function open_popup(g,b,a,d){popup_table_buy.clear();popup_table_sell.clear();$("#popup_itemName").text("Trade info for "+b);if(isCustom){$("#buyLocation").text("Buy at "+customStart);$("#sellLocation").text("Sell at "+a)}else{$("#buyLocation").text("Buy at "+start_location);$("#sellLocation").text("Sell at "+a)}var f=customBuy[station_buy[1]][g];var e=customSell[d][g];for(var c=0;c<f.length;c++){if(f[c]){$("#popup-table-buy").dataTable().fnAddData([numberWithCommas(f[c][0].toFixed(2)),numberWithCommas(f[c][1].toFixed())])}}for(var c=0;c<e.length;c++){if(e[c]){$("#popup-table-sell").dataTable().fnAddData([numberWithCommas(e[c][0].toFixed(2)),numberWithCommas(e[c][1].toFixed())])}}$("#popup").modal("show");popup_table_buy.draw();popup_table_sell.draw()}function unreachable(b,a){if(!has_shown&&$("#unreachable").is(":hidden")){$("#unreachable").hide();$("#unreachable").slideToggle();has_shown=true}if(b===a){goAgain()}}function setCookie(b,f,c){var e=new Date();e.setTime(e.getTime()+(c*24*60*60*1000));var a="expires="+e.toUTCString();document.cookie=b+"="+f+";"+a+";path=/"}function getCookie(d){var b=d+"=";var f=decodeURIComponent(document.cookie);var a=f.split(";");for(var e=0;e<a.length;e++){var g=a[e];while(g.charAt(0)==" "){g=g.substring(1)}if(g.indexOf(b)==0){return g.substring(b.length,g.length)}}return""}function init(){var q=start_location;var n=[];if(routeTrading==false){if(isCustom){n.push($("#custom_station option[value='"+$("#custom_station").val()+"']").text());start_location="Nil";customStart=q;customEnd=n[0]}else{$.each($(".station-selected"),function(){start_location="Nil";q=$(this).val();n.push($(this).val())})}if($("#lower-margin-threshold").val().length>0&&!isNaN($("#lower-margin-threshold").val())){threshold_margin_lower=parseInt($("#lower-margin-threshold").val());setCookie("threshold_margin_lower",threshold_margin_lower,7)}if($("#upper-margin-threshold").val().length>0&&!isNaN($("#upper-margin-threshold").val())){threshold_margin_upper=parseInt($("#upper-margin-threshold").val());setCookie("threshold_margin_upper",threshold_margin_upper,7)}}else{if(isCustom){if($(".end-selection:checked").length==0){n.push("None")}$.each($(".end-selection:checked"),function(){if(n.length<10){n.push($("[for='"+$(this).attr("id")+"']").text())}});customStart=q;customEnd=n}else{$.each($(".end-selected"),function(){n.push($(this).val())})}if($("#profit-threshold").val().length>0&&!isNaN($("#profit-threshold").val())){threshold_profit=parseInt($("#profit-threshold").val());setCookie("threshold_profit",threshold_profit,7)}if($("#roi-threshold").val().length>0&&!isNaN($("#roi-threshold").val())){threshold_roi=parseInt($("#roi-threshold").val());setCookie("threshold_roi",threshold_roi,7)}if($("#buy-threshold").val().length>0&&!isNaN($("#buy-threshold").val())){threshold_cost=parseInt($("#buy-threshold").val());setCookie("threshold_cost",threshold_cost,7)}if($("#weight-threshold").val().length>0&&!isNaN($("#weight-threshold").val())){threshold_weight=parseInt($("#weight-threshold").val());setCookie("threshold_weight",threshold_weight,7)}}var r=n.indexOf("Jita")>-1?true:false;var a=n.indexOf("Amarr")>-1?true:false;var c=n.indexOf("Dodixie")>-1?true:false;var b=n.indexOf("Rens")>-1?true:false;var o=n.indexOf("Hek")>-1?true:false;if((n.indexOf(start_location)>-1&&n.length==1)||(n.length==0||start_location==="")){$(".error").show();return}else{$(".error").hide();$("#selection").hide();$("#stop").show()}if(isCustom&&(n[0]==="None"||start_location==="None")){$(".error").show();$("#selection").show();$("#stop").hide();return}else{$(".error").hide();$("#selection").hide();$("#stop").show()}var e=[];if(!isCustom){var r=n.indexOf("Jita")>-1?true:false;var a=n.indexOf("Amarr")>-1?true:false;var c=n.indexOf("Dodixie")>-1?true:false;var b=n.indexOf("Rens")>-1?true:false;var o=n.indexOf("Hek")>-1?true:false;var p,m,l,h,d;if(q==="Jita"){p=JITA;m=a?AMARR:IGNORE;l=c?DODIXIE:IGNORE;h=b?RENS:IGNORE;d=o?HEK:IGNORE}else{if(q==="Amarr"){p=AMARR;m=r?JITA:IGNORE;l=c?DODIXIE:IGNORE;h=b?RENS:IGNORE;d=o?HEK:IGNORE}else{if(q==="Dodixie"){p=DODIXIE;m=a?AMARR:IGNORE;l=r?JITA:IGNORE;h=b?RENS:IGNORE;d=o?HEK:IGNORE}else{if(q==="Rens"){p=RENS;m=a?AMARR:IGNORE;l=c?DODIXIE:IGNORE;h=r?JITA:IGNORE;d=o?HEK:IGNORE}else{p=HEK;m=a?AMARR:IGNORE;l=c?DODIXIE:IGNORE;h=b?RENS:IGNORE;d=r?JITA:IGNORE}}}}}else{p=$("#custom_route_start").val().split(",");$.each($(".end-selection:checked"),function(){if(e.length<10){e.push($(this).val().split(","))}})}$("#title-banner").slideToggle();if(routeTrading){if(threshold_weight===1000000000000000000){requestItemWeight=false}if(requestItemWeight){$("#dataTable").append("<thead><tr><th>Item</th><th>Buy Price</th><th>Total Cost</th><th>Buy Quantity</th><th>Sell At</th><th>Sell Quantity</th><th>Total Profit</th><th>R.O.I.</th><th>Sell Price</th><th>Profit Per Item</th><th>Total Volume (m3)</th></tr></thead>")}else{$("#dataTable").append("<thead><tr><th>Item</th><th>Buy Price</th><th>Total Cost</th><th>Buy Quantity</th><th>Sell At</th><th>Sell Quantity</th><th>Total Profit</th><th>R.O.I.</th><th>Sell Price</th><th>Profit Per Item</th></tr></thead>")}$("#dataTable thead:last").after("<tbody id='tableBody'></tbody>");$("#buyingHeader").text("Buying from "+q);var g="";if(isCustom){$.each(n,function(){g+=this+", "})}else{if(r&&q!=="Jita"){g+="Jita, "}if(a&&q!=="Amarr"){g+="Amarr, "}if(c&&q!=="Dodixie"){g+="Dodixie, "}if(b&&q!=="Rens"){g+="Rens, "}if(o&&q!=="Hek"){g+="Hek, "}}if(g.length>0){g="<div id='route-to'>Routes to "+g.substring(0,g.length-2)+"</div>"}g+="ROI&nbsp;Greater&nbsp;Than&nbsp;"+threshold_roi+"% |&nbsp;Profits&nbsp;Greater&nbsp;Than&nbsp;"+numberWithCommas(threshold_profit)+"&nbsp;ISK";if(threshold_cost!==1000000000000000000){g+=" |&nbsp;Buy&nbsp;Costs&nbsp;Less&nbsp;Than&nbsp;"+numberWithCommas(threshold_cost)+"&nbsp;ISK"}if(threshold_weight!==1000000000000000000){g+=" |&nbsp;Weight&nbsp;Under&nbsp;"+numberWithCommas(threshold_weight)+"&nbsp;m3"}g+=" |&nbsp;<span id='percent-complete'></span>";$("#buyingFooter").html(g+"<br/>*Profit is not guaranteed. <span class='avoidwrap'>Use at your own risk. <span class='avoidwrap'>Verify in game that prices are accurate.</span></span><div class='loading'>Checking Live Prices<br>Please wait...</div>");$("#buyingFooter").show();$("#buyingHeader").show();if(m!=null){e.push(m)}if(l!=null){e.push(l)}if(h!=null){e.push(h)}if(d!=null){e.push(d)}for(var k=0;k<e.length;k++){for(var f=0;f<e[k].length;f++){e[k][f]=parseInt(e[k][f])}}beginRoute(p,e)}else{$("#buyingHeader").text("Station Trading at "+q);$("#buyingFooter").html("Margins between "+threshold_margin_lower+"% and "+threshold_margin_upper+"%<div class='loading'>Loading. Please wait...</div>");$("#buyingFooter").show();$("#buyingHeader").show();if(isCustom){p=$("#custom_station").val().split(",")}$("#dataTable").append("<thead><tr><th>Item</th><th>Buy Price</th><th>Sell Price</th><th>Profit Per Item</th><th>Margin</th></tr></thead>");$("#dataTable thead:last").after("<tbody id='tableBody'></tbody>");beginStation(p)}};