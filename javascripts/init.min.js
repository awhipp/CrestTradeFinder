var JITA=[10000002,60003760];var AMARR=[10000043,60008494];var DODIXIE=[10000032,60011866];var RENS=[10000030,60004588];var HEK=[10000042,60005686];var IGNORE=null;var NUMBER_RETURNED=3;var threshold_margin_lower=30;var threshold_margin_upper=45;var threshold_profit=100000;var threshold_roi=1;var threshold_cost=1000000000000000000;var itemIds=[];var jitaBuy=[];var jitaSell=[];var amarrBuy=[];var amarrSell=[];var dodixieBuy=[];var dodixieSell=[];var rensBuy=[];var rensSell=[];var hekBuy=[];var hekSell=[];var customBuy=[];var customSell=[];var start_location="";var isCustom=false;var customStart;var customEnd;var popup_table_buy;var popup_table_sell;var routeTrading=null;var init_itemIds=0;var page=1;var has_shown=false;var curr;var ENDPOINT="https://crest-tq.eveonline.com";function numberWithCommas(a){while(/(\d+)(\d{3})/.test(a.toString())){a=a.toString().replace(/(\d+)(\d{3})/,"$1,$2")}return a}function showAbout(){if(routeTrading==null){$("#howto").slideToggle()}else{if(routeTrading){$("#howto-route").slideToggle()}else{$("#howto-station").slideToggle()}}}function getMoreItems(){var a=false;$.ajax({type:"get",dataType:"json",url:ENDPOINT+"/market/types/",success:function(c){for(var b=1;b<=c.pageCount;b++){$.ajax({type:"get",dataType:"json",url:ENDPOINT+"/market/types/?page="+b,success:function(f){if(f&&f.items){if(!f.next){$("#loading").hide();$("#selection").show()}var d=shuffle(f.items);init_itemIds=init_itemIds+d.length;for(var e=0;e<d.length;e++){itemIds.push(d[e].id)}}},error:function(e,d){}})}},error:function(c,b){}})}function setup(a){routeTrading=a;$(".howto").toggle(false);if(routeTrading==true){$("#initial_choice").hide();$("#route_trade").slideToggle()}else{$("#initial_choice").hide();$("#station_trade").slideToggle()}}$(document).ready(function(){$("#loading").show();$("#selection").hide();popup_table_buy=$("#popup-table-buy").DataTable({order:[[0,"asc"]],lengthMenu:[[10],["10"]]});popup_table_sell=$("#popup-table-sell").DataTable({order:[[0,"desc"]],lengthMenu:[[10],["10"]]});getMoreItems();$(".start").on("click",function(){start_location=$(this).val();$(".start").removeClass("start-selected");$(this).addClass("start-selected");start_location=="Jita"?$("#add_jita").removeClass("end-selected"):"";start_location=="Amarr"?$("#add_amarr").removeClass("end-selected"):"";start_location=="Dodixie"?$("#add_dodixie").removeClass("end-selected"):"";start_location=="Rens"?$("#add_rens").removeClass("end-selected"):"";start_location=="Hek"?$("#add_hek").removeClass("end-selected"):""});$(".end").on("click",function(){if($(this).hasClass("end-selected")){$(this).removeClass("end-selected")}else{$(this).addClass("end-selected")}});$(".station-start").on("click",function(){$(".station-start").removeClass("station-selected");$(this).addClass("station-selected")});$("#numberInput").on("blur",updateNumber);$("#custom_route").on("click",function(){$(".standard").slideToggle();$(".custom").slideToggle();if($(this).val()==="Enable Custom Route (BETA)"){$(this).val("Disable Custom Route");isCustom=true}else{$(this).val("Enable Custom Route (BETA)");isCustom=false}});$("#custom_select").on("click",function(){$(".standard").slideToggle();$(".custom").slideToggle();if($(this).val()==="Enable Custom Selection (BETA)"){$(this).val("Disable Custom Selection");isCustom=true}else{$(this).val("Enable Custom Selection (BETA)");isCustom=false}});for(var a=0;a<station_ids.length;a++){$("#custom_route_start").append("<option value="+[station_ids[a][1],station_ids[a][0]]+">"+station_ids[a][2]+"</option>");$("#custom_route_end").append("<option value="+[station_ids[a][1],station_ids[a][0]]+">"+station_ids[a][2]+"</option>");$("#custom_station").append("<option value="+[station_ids[a][1],station_ids[a][0]]+">"+station_ids[a][2]+"</option>")}$("#custom_route_start").change(function(){start_location=$("#custom_route_start option[value='"+$("#custom_route_start").val()+"']").text()});$("#custom_station").change(function(){start_location=$("#custom_station option[value='"+$("#custom_station").val()+"']").text()})});function updateNumber(){NUMBER_RETURNED=parseInt($("#numberInput").val());if(NUMBER_RETURNED>10||NUMBER_RETURNED<1){NUMBER_RETURNED=1;$("#numberInput").val("1")}}function shuffle(d){var c=d.length,b,a;while(0!==c){a=Math.floor(Math.random()*c);c-=1;b=d[c];d[c]=d[a];d[a]=b}return d}function open_popup(f,b,a){popup_table_buy.clear();popup_table_sell.clear();$("#popup_itemName").text("Trade info for "+b);if(isCustom){$("#buyLocation").text("Buy at "+customStart);$("#sellLocation").text("Sell at "+customEnd)}else{$("#buyLocation").text("Buy at "+start_location);$("#sellLocation").text("Sell at "+a)}var e;var d;if(start_location=="Jita"){e=jitaBuy[f]}else{if(start_location=="Amarr"){e=amarrBuy[f]}else{if(start_location=="Dodixie"){e=dodixieBuy[f]}else{if(start_location=="Rens"){e=rensBuy[f]}else{if(start_location=="Hek"){e=hekBuy[f]}else{e=customBuy[f]}}}}}for(var c=0;c<e.length;c++){if(e[c]){$("#popup-table-buy").dataTable().fnAddData([numberWithCommas(e[c][0].toFixed(2)),numberWithCommas(e[c][1].toFixed())])}}if(a=="Jita"){d=jitaSell[f]}else{if(a=="Amarr"){d=amarrSell[f]}else{if(a=="Dodixie"){d=dodixieSell[f]}else{if(a=="Rens"){d=rensSell[f]}else{if(a=="Hek"){d=hekSell[f]}else{d=customSell[f]}}}}}for(var c=0;c<d.length;c++){if(d[c]){$("#popup-table-sell").dataTable().fnAddData([numberWithCommas(d[c][0].toFixed(2)),numberWithCommas(d[c][1].toFixed())])}}$("#popup").modal("show");popup_table_buy.draw();popup_table_sell.draw()}function unreachable(){if(!has_shown&&$("#unreachable").is(":hidden")){$("#unreachable").hide();$("#unreachable").slideToggle();has_shown=true}}function init(){var m=start_location;var j=[];if(routeTrading==false){if(isCustom){j.push($("#custom_station option[value='"+$("#custom_station").val()+"']").text());start_location="Nil";customStart=m;customEnd=j[0]}else{$.each($(".station-selected"),function(){start_location="Nil";m=$(this).val();j.push($(this).val())})}if($("#lower-margin-threshold").val().length>0&&!isNaN($("#lower-margin-threshold").val())){threshold_margin_lower=parseInt($("#lower-margin-threshold").val())}if($("#upper-margin-threshold").val().length>0&&!isNaN($("#upper-margin-threshold").val())){threshold_margin_upper=parseInt($("#upper-margin-threshold").val())}}else{if(isCustom){j.push($("#custom_route_end option[value='"+$("#custom_route_end").val()+"']").text());customStart=m;customEnd=j[0]}else{$.each($(".end-selected"),function(){j.push($(this).val())})}if($("#profit-threshold").val().length>0&&!isNaN($("#profit-threshold").val())){threshold_profit=parseInt($("#profit-threshold").val())}if($("#roi-threshold").val().length>0&&!isNaN($("#roi-threshold").val())){threshold_roi=parseInt($("#roi-threshold").val())}if($("#buy-threshold").val().length>0&&!isNaN($("#buy-threshold").val())){threshold_cost=parseInt($("#buy-threshold").val())}}var n=j.indexOf("Jita")>-1?true:false;var a=j.indexOf("Amarr")>-1?true:false;var c=j.indexOf("Dodixie")>-1?true:false;var b=j.indexOf("Rens")>-1?true:false;var k=j.indexOf("Hek")>-1?true:false;if((j.indexOf(start_location)>-1&&j.length==1)||(j.length==0||start_location==="")){$(".error").show();return}else{$(".error").hide();$("#selection").hide();$("#stop").show()}if(isCustom&&(j[0]==="None"||start_location==="None")){$(".error").show();$("#selection").show();$("#stop").hide();return}else{$(".error").hide();$("#selection").hide();$("#stop").show()}if(!isCustom){var n=j.indexOf("Jita")>-1?true:false;var a=j.indexOf("Amarr")>-1?true:false;var c=j.indexOf("Dodixie")>-1?true:false;var b=j.indexOf("Rens")>-1?true:false;var k=j.indexOf("Hek")>-1?true:false;var l,i,h,g,e;if(m==="Jita"){l=JITA;i=a?AMARR:IGNORE;h=c?DODIXIE:IGNORE;g=b?RENS:IGNORE;e=k?HEK:IGNORE}else{if(m==="Amarr"){l=AMARR;i=n?JITA:IGNORE;h=c?DODIXIE:IGNORE;g=b?RENS:IGNORE;e=k?HEK:IGNORE}else{if(m==="Dodixie"){l=DODIXIE;i=a?AMARR:IGNORE;h=n?JITA:IGNORE;g=b?RENS:IGNORE;e=k?HEK:IGNORE}else{if(m==="Rens"){l=RENS;i=a?AMARR:IGNORE;h=c?DODIXIE:IGNORE;g=n?JITA:IGNORE;e=k?HEK:IGNORE}else{l=HEK;i=a?AMARR:IGNORE;h=c?DODIXIE:IGNORE;g=b?RENS:IGNORE;e=n?JITA:IGNORE}}}}}else{l=$("#custom_route_start").val().split(",");i=$("#custom_route_end").val().split(",");h=IGNORE;g=IGNORE;e=IGNORE}$("#title-banner").slideToggle();if(routeTrading){$("#dataTable").append("<thead><tr><th>Item</th><th>Buy Price</th><th>Total Cost</th><th>Buy Quantity</th><th>Sell At</th><th>Sell Quantity</th><th>Total Profit</th><th>R.O.I.</th><th>Sell Price</th><th>Profit Per Item</th></tr></thead>");$("#dataTable thead:last").after("<tbody id='tableBody'></tbody>");$("#buyingHeader").text("Buying from "+m);var f="";if(isCustom){f+=j[0]+", "}else{if(n&&m!=="Jita"){f+="Jita, "}if(a&&m!=="Amarr"){f+="Amarr, "}if(c&&m!=="Dodixie"){f+="Dodixie, "}if(b&&m!=="Rens"){f+="Rens, "}if(k&&m!=="Hek"){f+="Hek, "}}if(f.length>0){f="( routes to "+f.substring(0,f.length-2)+" )<br/>"}f+="ROI&nbsp;Greater&nbsp;Than&nbsp;"+threshold_roi+"% |&nbsp;Profits&nbsp;Greater&nbsp;Than&nbsp;"+numberWithCommas(threshold_profit)+"&nbsp;ISK";if(threshold_cost!==1000000000000000000){f+=" |&nbsp;Buy&nbsp;Costs&nbsp;Less&nbsp;Than&nbsp;"+numberWithCommas(threshold_cost)+"&nbsp;ISK"}f+=" |&nbsp;<span id='percent-complete'></span>";$("#buyingFooter").html(f+"<br/>*Profit is not guaranteed. <span class='avoidwrap'>Use at your own risk. <span class='avoidwrap'>Verify in game that prices are accurate.</span></span><div class='loading'>Checking Live Prices<br>Please wait...</div>");$("#buyingFooter").show();$("#buyingHeader").show();var d=[];if(i!=null){d.push(i)}if(h!=null){d.push(h)}if(g!=null){d.push(g)}if(e!=null){d.push(e)}beginRoute(l,d)}else{$("#buyingHeader").text("Station Trading at "+m);$("#buyingFooter").html("Margins between "+threshold_margin_lower+"% and "+threshold_margin_upper+"%<div class='loading'>Loading. Please wait...</div>");$("#buyingFooter").show();$("#buyingHeader").show();if(isCustom){l=$("#custom_station").val().split(",")}$("#dataTable").append("<thead><tr><th>Item</th><th>Buy Price</th><th>Sell Price</th><th>Profit Per Item</th><th>Margin</th></tr></thead>");$("#dataTable thead:last").after("<tbody id='tableBody'></tbody>");beginStation(l)}};