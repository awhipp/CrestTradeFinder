var JITA=[10000002,60003760];var AMARR=[10000043,60008494];var DODIXIE=[10000032,60011866];var RENS=[10000030,60004588];var HEK=[10000042,60005686];var IGNORE=[-1,-1];var NUMBER_RETURNED=3;var threshold_margin_lower=30;var threshold_margin_upper=45;var threshold_profit=100000;var threshold_roi=1;var threshold_cost=1000000000000000000;var itemIds=[];var jitaBuy=[];var jitaSell=[];var amarrBuy=[];var amarrSell=[];var dodixieBuy=[];var dodixieSell=[];var rensBuy=[];var rensSell=[];var hekBuy=[];var hekSell=[];var customBuy=[];var customSell=[];var start_location="";var isCustom=false;var customStart;var customEnd;var popup_table_buy;var popup_table_sell;var routeTrading=null;var page=1;var has_shown=false;var curr;var ENDPOINT="https://crest-tq.eveonline.com";function numberWithCommas(a){while(/(\d+)(\d{3})/.test(a.toString())){a=a.toString().replace(/(\d+)(\d{3})/,"$1,$2")}return a}function showAbout(){if(routeTrading==null){$("#howto").slideToggle()}else{if(routeTrading){$("#howto-route").slideToggle()}else{$("#howto-station").slideToggle()}}}function getMoreItems(){$.ajax({type:"get",dataType:"json",url:ENDPOINT+"/market/types/?page="+page,success:function(c){if(c&&c.items){var a=shuffle(c.items);for(var b=0;b<a.length;b++){itemIds.push(a[b].id)}page++;if(page==3){$("#loading").hide();$("#selection").show()}if(c.next){getMoreItems()}else{if(page<3){$("#loading").hide();$("#selection").show()}}}},error:function(b,a){getMoreItems()}})}function setup(a){routeTrading=a;$(".howto").toggle(false);if(routeTrading==true){$("#initial_choice").hide();$("#route_trade").slideToggle()}else{$("#initial_choice").hide();$("#station_trade").slideToggle()}}$(document).ready(function(){$("#loading").show();$("#selection").hide();popup_table_buy=$("#popup-table-buy").DataTable({order:[[0,"asc"]],lengthMenu:[[10],["10"]]});popup_table_sell=$("#popup-table-sell").DataTable({order:[[0,"desc"]],lengthMenu:[[10],["10"]]});getMoreItems();$(".start").on("click",function(){start_location=$(this).val();$(".start").removeClass("start-selected");$(this).addClass("start-selected");start_location=="Jita"?$("#add_jita").removeClass("end-selected"):"";start_location=="Amarr"?$("#add_amarr").removeClass("end-selected"):"";start_location=="Dodixie"?$("#add_dodixie").removeClass("end-selected"):"";start_location=="Rens"?$("#add_rens").removeClass("end-selected"):"";start_location=="Hek"?$("#add_hek").removeClass("end-selected"):""});$(".end").on("click",function(){if($(this).hasClass("end-selected")){$(this).removeClass("end-selected")}else{$(this).addClass("end-selected")}});$(".station-start").on("click",function(){$(".station-start").removeClass("station-selected");$(this).addClass("station-selected")});$("#numberInput").on("blur",updateNumber);$("#custom_route").on("click",function(){$(".standard").slideToggle();$(".custom").slideToggle();if($(this).val()==="Enable Custom Route (BETA)"){$(this).val("Disable Custom Route");isCustom=true}else{$(this).val("Enable Custom Route (BETA)");isCustom=false}});$("#custom_select").on("click",function(){$(".standard").slideToggle();$(".custom").slideToggle();if($(this).val()==="Enable Custom Selection (BETA)"){$(this).val("Disable Custom Selection");isCustom=true}else{$(this).val("Enable Custom Selection (BETA)");isCustom=false}});for(var a=0;a<station_ids.length;a++){$("#custom_route_start").append("<option value="+[station_ids[a][1],station_ids[a][0]]+">"+station_ids[a][2]+"</option>");$("#custom_route_end").append("<option value="+[station_ids[a][1],station_ids[a][0]]+">"+station_ids[a][2]+"</option>");$("#custom_station").append("<option value="+[station_ids[a][1],station_ids[a][0]]+">"+station_ids[a][2]+"</option>")}$("#custom_route_start").change(function(){start_location=$("#custom_route_start option[value='"+$("#custom_route_start").val()+"']").text()});$("#custom_station").change(function(){start_location=$("#custom_station option[value='"+$("#custom_station").val()+"']").text()})});function updateNumber(){NUMBER_RETURNED=parseInt($("#numberInput").val());if(NUMBER_RETURNED>10||NUMBER_RETURNED<1){NUMBER_RETURNED=1;$("#numberInput").val("1")}}function shuffle(d){var c=d.length,b,a;while(0!==c){a=Math.floor(Math.random()*c);c-=1;b=d[c];d[c]=d[a];d[a]=b}return d}function open_popup(f,b,a){popup_table_buy.clear();popup_table_sell.clear();$("#popup_itemName").text("Trade info for "+b);if(isCustom){$("#buyLocation").text("Buy at "+customStart);$("#sellLocation").text("Sell at "+customEnd)}else{$("#buyLocation").text("Buy at "+start_location);$("#sellLocation").text("Sell at "+a)}var e;var d;if(start_location=="Jita"){e=jitaBuy[f]}else{if(start_location=="Amarr"){e=amarrBuy[f]}else{if(start_location=="Dodixie"){e=dodixieBuy[f]}else{if(start_location=="Rens"){e=rensBuy[f]}else{if(start_location=="Hek"){e=hekBuy[f]}else{e=customBuy[f]}}}}}for(var c=0;c<e.length;c++){if(e[c]){$("#popup-table-buy").dataTable().fnAddData([numberWithCommas(e[c][0].toFixed(2)),numberWithCommas(e[c][1].toFixed())])}}if(a=="Jita"){d=jitaSell[f]}else{if(a=="Amarr"){d=amarrSell[f]}else{if(a=="Dodixie"){d=dodixieSell[f]}else{if(a=="Rens"){d=rensSell[f]}else{if(a=="Hek"){d=hekSell[f]}else{d=customSell[f]}}}}}for(var c=0;c<d.length;c++){if(d[c]){$("#popup-table-sell").dataTable().fnAddData([numberWithCommas(d[c][0].toFixed(2)),numberWithCommas(d[c][1].toFixed())])}}$("#popup").modal("show");popup_table_buy.draw();popup_table_sell.draw()}function unreachable(){if(!has_shown&&$("#unreachable").is(":hidden")){$("#unreachable").hide();$("#unreachable").slideToggle();has_shown=true}}function init(){var l=start_location;var i=[];if(routeTrading==false){if(isCustom){i.push($("#custom_station option[value='"+$("#custom_station").val()+"']").text());start_location="Nil";customStart=l;customEnd=i[0]}else{$.each($(".station-selected"),function(){start_location="Nil";l=$(this).val();i.push($(this).val())})}if($("#lower-margin-threshold").val().length>0&&!isNaN($("#lower-margin-threshold").val())){threshold_margin_lower=parseInt($("#lower-margin-threshold").val())}if($("#upper-margin-threshold").val().length>0&&!isNaN($("#upper-margin-threshold").val())){threshold_margin_upper=parseInt($("#upper-margin-threshold").val())}}else{if(isCustom){i.push($("#custom_route_end option[value='"+$("#custom_route_end").val()+"']").text());customStart=l;customEnd=i[0]}else{$.each($(".end-selected"),function(){i.push($(this).val())})}if($("#profit-threshold").val().length>0&&!isNaN($("#profit-threshold").val())){threshold_profit=parseInt($("#profit-threshold").val())}if($("#roi-threshold").val().length>0&&!isNaN($("#roi-threshold").val())){threshold_roi=parseInt($("#roi-threshold").val())}if($("#buy-threshold").val().length>0&&!isNaN($("#buy-threshold").val())){threshold_cost=parseInt($("#buy-threshold").val())}}var m=i.indexOf("Jita")>-1?true:false;var a=i.indexOf("Amarr")>-1?true:false;var c=i.indexOf("Dodixie")>-1?true:false;var b=i.indexOf("Rens")>-1?true:false;var j=i.indexOf("Hek")>-1?true:false;if((i.indexOf(start_location)>-1&&i.length==1)||(i.length==0||start_location==="")){$(".error").show();return}else{$(".error").hide();$("#selection").hide();$("#stop").show()}if(isCustom&&(i[0]==="None"||start_location==="None")){$(".error").show();$("#selection").show();$("#stop").hide();return}else{$(".error").hide();$("#selection").hide();$("#stop").show()}if(!isCustom){var m=i.indexOf("Jita")>-1?true:false;var a=i.indexOf("Amarr")>-1?true:false;var c=i.indexOf("Dodixie")>-1?true:false;var b=i.indexOf("Rens")>-1?true:false;var j=i.indexOf("Hek")>-1?true:false;var k,h,g,f,d;if(l==="Jita"){k=JITA;h=a?AMARR:IGNORE;g=c?DODIXIE:IGNORE;f=b?RENS:IGNORE;d=j?HEK:IGNORE}else{if(l==="Amarr"){k=AMARR;h=m?JITA:IGNORE;g=c?DODIXIE:IGNORE;f=b?RENS:IGNORE;d=j?HEK:IGNORE}else{if(l==="Dodixie"){k=DODIXIE;h=a?AMARR:IGNORE;g=m?JITA:IGNORE;f=b?RENS:IGNORE;d=j?HEK:IGNORE}else{if(l==="Rens"){k=RENS;h=a?AMARR:IGNORE;g=c?DODIXIE:IGNORE;f=m?JITA:IGNORE;d=j?HEK:IGNORE}else{k=HEK;h=a?AMARR:IGNORE;g=c?DODIXIE:IGNORE;f=b?RENS:IGNORE;d=m?JITA:IGNORE}}}}}else{k=$("#custom_route_start").val().split(",");h=$("#custom_route_end").val().split(",");g=[-1,-1];f=[-1,-1];d=[-1,-1]}$("#title-banner").slideToggle();if(routeTrading){$("#dataTable").append("<thead><tr><th>Item</th><th>Buy Price</th><th>Total Cost</th><th>Buy Quantity</th><th>Sell At</th><th>Sell Quantity</th><th>Total Profit</th><th>R.O.I.</th><th>Sell Price</th><th>Profit Per Item</th></tr></thead>");$("#dataTable thead:last").after("<tbody id='tableBody'></tbody>");$("#buyingHeader").text("Buying from "+l);var e="";if(isCustom){e+=i[0]+", "}else{if(m&&l!=="Jita"){e+="Jita, "}if(a&&l!=="Amarr"){e+="Amarr, "}if(c&&l!=="Dodixie"){e+="Dodixie, "}if(b&&l!=="Rens"){e+="Rens, "}if(j&&l!=="Hek"){e+="Hek, "}}if(e.length>0){e="( routes to "+e.substring(0,e.length-2)+" )<br/>"}e+="ROI Greater Than "+threshold_roi+"% | Profits Greater Than "+numberWithCommas(threshold_profit)+" ISK";if(threshold_cost!==1000000000000000000){e+=" | Buy Costs Less Than "+numberWithCommas(threshold_cost)+" ISK"}$("#buyingFooter").html(e+"<br/>*Profit is not guaranteed. <span class='avoidwrap'>Use at your own risk. <span class='avoidwrap'>Verify in game that prices are accurate.</span></span><div class='loading'>Loading. Please wait...</div>");$("#buyingFooter").show();$("#buyingHeader").show();beginRoute(k,h,g,f,d)}else{$("#buyingHeader").text("Station Trading at "+l);$("#buyingFooter").html("Margins between "+threshold_margin_lower+"% and "+threshold_margin_upper+"%<div class='loading'>Loading. Please wait...</div>");$("#buyingFooter").show();$("#buyingHeader").show();if(isCustom){k=$("#custom_station").val().split(",")}$("#dataTable").append("<thead><tr><th>Item</th><th>Buy Price</th><th>Sell Price</th><th>Profit Per Item</th><th>Margin</th></tr></thead>");$("#dataTable thead:last").after("<tbody id='tableBody'></tbody>");beginStation(k)}};